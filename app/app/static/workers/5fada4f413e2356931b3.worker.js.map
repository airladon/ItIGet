{"version":3,"sources":["webpack://Fig/webpack/bootstrap","webpack://Fig/./src/js/diagram/recorder.worker.js","webpack://Fig/./src/js/tools/FunctionMap.js","webpack://Fig/./src/js/tools/math.js","webpack://Fig/./src/js/tools/tools.js"],"names":["GeneralFunctionMap","map","id","fn","idOrFn","args","length","mapsIn","maps","i","GlobalFunctionMap","instance","FunctionMap","global","execOnMaps","roundNum","value","precision","multiplier","result","Math","round","objectIsPolyfill","x","y","arrayOrValue","Array","isArray","elem","clipMag","zeroThreshold","maxValue","zeroT","maxV","clipValue","minValue","clipped","decelerate","getPositionVelocityFromDecAndTime","position","velocity","magDeceleration","time","decel","v","p","d","sign","abs","newVelocity","newSign","t","z","zSign","newPosition","linear","percentTime","invert","triangle","deltaTime","frequency","bias","mag","phaseOffset","PI","asin","sin","easeinout","a","sqrt","percentDistance","easeout","b","power","easein","sinusoid","range","start","stop","step","out","push","randSign","random","randInt","minOrMax","max","plusOrMinus","r","min","floor","rand","randElement","inputArray","index","removeRandElement","splice","randElements","num","possibleIndeces","elements","rand2D","minX","minY","maxX","maxY","Console","text","console","log","classify","key","nonEmpty","withKey","startsWith","joinStr","split","join","ObjectKeyPointer","object","apply","undefined","extractFrom","objectToExtractFrom","keyValues","keyPrefix","keyHeirarchy","keys","filter","k","slice","forEach","kv","Object","obj","getElement","collection","addToObject","nameToAdd","valueToAdd","splitStr","levels","currentLevel","level","prototype","hasOwnProperty","call","duplicate","NaN","_dup","arrayDup","arrayElement","objectDup","assignObjectFromTo","fromObject","toObject","exceptIn","duplicateValues","parentPath","except","keyPath","indexOf","_assignAsLinkOnly","toValue","joinObjectsWithOptions","options","dup","o","joinObjects","objects","duplicateFromTo","exceptKeys","generateUniqueId","seed","randomString","s","seedToUse","idExists","newId","element","document","getElementById","isTouchDevice","prefixes","mq","query","window","matchMedia","matches","DocumentTouch","loadRemote","scriptId","url","callback","existingScript","script","createElement","type","src","body","appendChild","onload","loadRemoteCSS","link","rel","href","cleanUIDs","objectToClean","genericUID","uid","deleteKeys","copyKeysFromTo","source","destination","generateRandomString","toString","UniqueMap","inverseMap","letters","undefinedCode","pathStr","unique","getNextUniqueString","order","remainder","factor","uniqueStr","compressObject","strValues","uncompress","get","add","objKeys","obj2","uncompressObject","minify","objectOrArray","minified","unminify","minObjectOrArray","uMap","makeInverseMap","objectToPaths","path","pathObj","getObjectDiff","obj1In","diffs","debug","obj1","refAndDiffToObject","paths1","paths2","added","diff","removed","key1","key2","updateObjFromPath","remainingPath","remove","fullP","arrayStringIndeces","match","replace","arrayIndeces","e","parseInt","currentArray","j","pathsToObj","paths","referenceIn","ref","processPaths","diffsIn","diffIn","diffPathsToObj","diffObjToPaths","ObjectTracker","reset","references","refName","basedOn","baseReference","lastReferenceName","setBaseReference","getDiffToReference","name","chain","getReferenceChain","referenceChain","s1","performance","now","s2","timeCount","startWorker","worker","postMessage","Worker","addEventListener","event","data","getObjFromDiffAndReference","Subscriber","fnMap","subscribers","nextId","numberOfSubscriptions","payload","subscribersToRemove","triggerOk","exec","unsubscribe","idIn","SubscriptionManager","subscriptions","subscriptionName","subscribe","trigger","subscription","download","filename","setAttribute","encodeURIComponent","style","display","click","removeChild"],"mappings":"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","file":"5fada4f413e2356931b3.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/diagram/recorder.worker.js\");\n","// @flow\nimport {\n  ObjectTracker,\n} from '../tools/tools';\n\n// declare var self: DedicatedWorkerGlobalScope;\n\nlet cache = new ObjectTracker();\n\n// onmessage = (event: MessageEvent) => {\naddEventListener(\"message\", (event) => {\n  const { message, payload } = event.data;\n  if (message === 'reset') {\n    // resetCache(payload.baseReference, payload.references)\n    cache = new ObjectTracker();\n    cache.baseReference = payload.baseReference;\n    cache.references = payload.references;\n  } else if (message === 'get') {\n    postMessage({\n      message: 'cache',\n      payload: {\n        baseReferece: cache.baseReference,\n        references: cache.references,\n        diffs: cache.diffs,\n      },\n    });\n  } else if (message === 'add') {\n    // add(payload.now, payload.state, payload.reference, payload.lastRecordTimeCount);\n    cache.add(payload.now, payload.state, payload.reference, payload.lastRecordTimeCount);\n    // postMessage({\n    //   message: 'cacheDuration',\n    //   duration: cache.diffs[cache.diffs.length - 1],\n    // });\n  } else if (message === 'addReferece') {\n    cache.addReference(payload.state, payload.refName, payload.basedOn);\n  }\n  // console.log('worker', event.data);\n  // postMessage(`From Worker: ${event.data[0] + 2 * event.data[1]}`)\n});\n\n// function resetCache(baseReference: Object, references: Object) {\n//   cache = new ObjectTracker();\n//   cache.baseReference = baseReference;\n//   cache.references = references;\n// }\n\n// function add(now: number, state: Object, reference: string, lastRecordTimeCount: number) {\n//   cache.add(now, state, reference, lastRecordTimeCount);\n//   postMessage({\n//     message: 'cacheDuration',\n//     duration: cache.diffs[cache.diffs.length - 1],\n//   })\n// }\n","// @flow\n// import type { Transform } from '../tools/g2';\n// import { Point, getTransform, Transform } from '../tools/g2';\n// import { round } from '../tools/math';\n// import type { DiagramElement } from './Element';\n// import GlobalAnimation from './webgl/GlobalAnimation';\n\n// Singleton class that contains projects global functions\n\nclass GeneralFunctionMap {\n  map: { [id: string]: {\n    fn: Function,\n  }}\n\n  constructor() {\n    this.map = {};\n  }\n\n  add(id: string, fn: Function) {\n    if (this.map == null) {\n      this.map = {};\n    }\n    this.map[id] = {\n      fn,\n    };\n  }\n\n  exec(idOrFn: string | Function | null, ...args: any) {\n    if (idOrFn == null) {\n      return null;\n    }\n    if (typeof idOrFn === 'string') {\n      // return this.fnMap.exec(fn, ...args);\n      if (this.map[idOrFn] != null) {\n        if (args.length === 0) {\n          return this.map[idOrFn].fn();\n        }\n        return this.map[idOrFn].fn(...args);\n      }\n    }\n    if (typeof idOrFn === 'function') {\n      return idOrFn(...args);\n    }\n    return null;\n  }\n\n  execOnMaps(idOrFn: string | Function | null, mapsIn: Array<Object>, ...args: any) {\n    if (idOrFn == null) {\n      return null;\n    }\n    if (typeof idOrFn === 'string') {\n      const maps = [this.map, ...mapsIn];\n      for (let i = 0; i < maps.length; i += 1) {\n        const map = maps[i];\n        if (map[idOrFn] != null) {\n          if (args.length === 0) {\n            return map[idOrFn].fn();\n          }\n          return map[idOrFn].fn(...args);\n        }\n      }\n    }\n    if (typeof idOrFn === 'function') {\n      return idOrFn(...args);\n    }\n    return null;\n  }\n}\n\n\nclass GlobalFunctionMap extends GeneralFunctionMap {\n  static instance: Object;\n  constructor() {\n    // If the instance alread exists, then don't create a new instance.\n    // If it doesn't, then setup some default values.\n    if (!GlobalFunctionMap.instance) {\n      super();\n      GlobalFunctionMap.instance = this;\n      this.map = {};\n    }\n    return GlobalFunctionMap.instance;\n  }\n}\n\nclass FunctionMap extends GeneralFunctionMap {\n  map: { [id: string]: {\n    fn: Function,\n  }}\n\n  global: GlobalFunctionMap;\n\n  constructor() {\n    super();\n    this.global = new GlobalFunctionMap();\n  }\n\n  exec(idOrFn: string | Function | null, ...args: any) {\n    // const result = super.exec(idOrFn, ...args);\n    // if (result === null) {\n    //   return this.global.exec(idOrFn, ...args);\n    // }\n    // return result;\n    return this.execOnMaps(idOrFn, [this.global.map], ...args);\n  }\n\n  execOnMaps(idOrFn: string | Function | null, mapsIn: Array<Object>, ...args: any) {\n    return super.execOnMaps(idOrFn, [...mapsIn, this.global.map], ...args);\n  }\n}\n\nexport { FunctionMap, GlobalFunctionMap };\n","// @flow\n\nconst roundNum = (value: number, precision: number = 5): number => {\n  const multiplier = 10 ** precision;\n  let result = Math.round(value * multiplier) / multiplier;\n  // if (Object.is(result, -0)) {\n  // if (result === -0) {\n  //   result = 0;\n  // }\n  const objectIsPolyfill = (x, y) => {\n    if (x === y) {\n      // 0 === -0, but they are not identical\n      return x !== 0 || 1 / x === 1 / y;\n    }\n    // NaN !== NaN, but they are identical.\n    // NaNs are the only non-reflexive value, i.e., if x !== x,\n    // then x is a NaN.\n    // isNaN is broken: it converts its argument to number, so\n    // isNaN(\"foo\") => true\n    // eslint-disable-next-line no-self-compare\n    return x !== x && y !== y;\n  };\n  if (objectIsPolyfill(result, -0)) {\n    result = 0;\n  }\n  // if (result === -0) {\n  //   // 0 === -0, but they are not identical\n  //   return result !== 0 || 1 / x === 1 / y;\n  // }\n\n  return result;\n};\n\ntype TypeRoundObject = {\n  round?: (number) => TypeRoundObject;\n} & Object;\n/**\n * Rounds a number or numbers in an array\n * @method\n * @param {number | Array<number>} arrayOrValue - Value or array of values to be rounded\n * @param {number} precision - Number of decimal places to round to\n * @returns {number | Array<number>} Rounded value or array of values\n */\nfunction round<T: number | TypeRoundObject | Array<number | TypeRoundObject>>(\n  arrayOrValue: T,\n  precision: number = 5,\n): T {\n  let result = 0;\n  if (Array.isArray(arrayOrValue)) {\n    return arrayOrValue.map(elem => round(elem, precision));\n  }\n  if (typeof arrayOrValue === 'number') {\n    result = roundNum(arrayOrValue, precision);\n  } else if (arrayOrValue != null && arrayOrValue.round != null) {\n    result = arrayOrValue.round(precision);\n  }\n  // $FlowFixMe\n  return result;\n}\n\n\n// // clipValue clips a value to either 0 if it's small enough, or to a max value\n// // Value, and maxValue are sign independent. e.g.\n// //    * value, maxValue = 2, 1 => clips to 1\n// //    * value, maxValue = -2, -1 => clips to -1\n// //    * value, maxValue = -2, 1 => clips to -1\n// //    * value, maxValue = 2, -1 => clips to 1\n// function clipValue(\n//   value: number,\n//   zeroThreshold: number,\n//   maxValue: number = 0,\n// ) {\n//   let result = value;\n//   let zero = zeroThreshold;\n//   if (zero < 0) {\n//     zero = -zero;\n//   }\n//   if (value > -zero && value < zero) {\n//     return 0;\n//   }\n//   let max = maxValue;\n//   if (max < 0) {\n//     max = -max;\n//   }\n\n//   if (value > max) {\n//     result = max;\n//   }\n//   if (value < -max) {\n//     result = -max;\n//   }\n//   return result;\n// }\n\n\n// Clip a value to either max velocity, or 0 once under the minimum\n// threashold.\n//  * velocity: can be positive or negative\n//  * maxVelocity will clip velocity to:\n//      * |maxVelocity| if velocity > 0\n//      * -|maxVelocity| if velcity < 0\n//  * zeroThreshold will clip velocity to:\n//       * 0 if velocity is larger than -|zeroThreshold| and smaller than\n//         |zeroThreshold|.\nfunction clipMag(\n  value: number,\n  zeroThreshold: number | null,\n  maxValue: number | null,\n): number {\n  let result = value;\n  let zeroT = zeroThreshold;\n  let maxV = maxValue;\n\n  if (zeroT === null) {\n    zeroT = 0;\n  }\n  if (zeroT < 0) {\n    zeroT = -zeroT;\n  }\n  if (maxV === null) {\n    return result;\n  }\n  if (maxV < 0) {\n    maxV = -maxV;\n  }\n  if (value >= -zeroT && value <= zeroT) {\n    result = 0;\n  }\n  if (value > maxV) {\n    result = maxV;\n  }\n  if (value < -maxV) {\n    result = -maxV;\n  }\n  return result;\n}\n\nfunction clipValue(\n  value: number,\n  minValue: number | null,\n  maxValue: number | null,\n): number {\n  let clipped = value;\n  if (minValue !== null) {\n    if (value < minValue) {\n      clipped = minValue;\n    }\n  }\n\n  if (maxValue !== null) {\n    if (value > maxValue) {\n      clipped = maxValue;\n    }\n  }\n  return clipped;\n}\n\nconst decelerate = function getPositionVelocityFromDecAndTime(\n  position: number,\n  velocity: number,\n  magDeceleration: number | null,\n  time: number,\n  zeroThreshold: number | null,\n) {\n  let zeroT: number = 0;\n  if (zeroThreshold !== null) {\n    zeroT = zeroThreshold;\n  }\n  let decel: number = 0;\n  if (magDeceleration !== null) {\n    decel = magDeceleration;\n  }\n  // If the velocity is currently 0, then no further deceleration can occur, so\n  // return the current velocity and position\n  const v = clipMag(velocity, zeroT, velocity);\n  if (v === 0) {\n    return {\n      p: position,\n      v: 0,\n    };\n  }\n\n  let d = decel;\n  if (decel < 0) {\n    d = -d;\n  }\n  // If there is some initial velocity, then calc its sign and\n  const sign = velocity / Math.abs(velocity);\n  let newVelocity = velocity - sign * d * time;\n\n  // if the new velocity changes sign, then it should go to 0. If it doesn't\n  // change sign, then clip incase it should go to 0 because it is below\n  // the zero velocity threshold.\n  const newSign = newVelocity / Math.abs(newVelocity);\n  if (newSign !== sign) {\n    newVelocity = 0;\n  } else {\n    newVelocity = clipMag(newVelocity, zeroT, newVelocity);\n  }\n\n  // If the new velocity is clipped, then we need to use the time to where the\n  // velocity crosses the clipping point.\n  // v_new = v_init + a*t\n  // Therefore, if v_new = zeroT: t = (zeroT - vi)/a\n  let t = time;\n  if (newVelocity === 0) {\n    let z = zeroT;\n    const zSign = z / Math.abs(z);\n    if (zSign !== sign) {\n      z = -z;\n    }\n    t = Math.abs((z - velocity) / d);\n  }\n  // Now can calculate the new position\n  const newPosition = position + velocity * t - sign * 0.5 * d * t * t;\n\n  return {\n    p: newPosition,\n    v: newVelocity,\n  };\n};\n\n\nconst linear = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    return percentTime;\n  }\n  return percentTime;\n};\n\nfunction triangle(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + 2 * mag / Math.PI * Math.asin(Math.sin(2 * Math.PI * frequency * deltaTime + phaseOffset));\n  // return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\nconst easeinout = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    if (percentTime === 0.5) {\n      return  0.5;\n    }\n    const a = percentTime;\n    return (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n  }\n  const x = percentTime;\n  const percentDistance = (x ** 2) / ((x ** 2) + ((1 - x) ** 2));\n  return percentDistance;\n};\n\nfunction easeout(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 0) {\n      return 0;\n    }\n    const a = percentTime / 2 + 0.5;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return (b - 0.5) * 2;\n  }\n  const x = 0.5 + percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return (percentDistance - 0.5) * 2;\n}\n\nfunction easein(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 1) {\n      return 1;\n    }\n    const a = percentTime / 2;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return b * 2;\n  }\n  const x = percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return percentDistance * 2;\n}\n\nfunction sinusoid(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\n// const animationPhase = (transform, time, rotDirection = 0, animationStyle = easeinout) => {\n//     return {\n//         transform: transform._dup(),\n//         time: time,\n//         rotDirection: rotDirection,\n//         animationStyle: animationStyle,\n//     }\n// }\n\n/**\n * Creates an array with a range of number\n * @method\n * @memberof tools\n * @param start - Range start\n * @param stop - Range stop\n * @param step - Range step\n * @returns {Array<number>} Range of numbers in an array\n */\nfunction range(start: number, stop: number, step: number = 1) {\n  const out = [];\n  for (let i = start; i <= stop + step * 0.5; i += step) {\n    out.push(i);\n  }\n  return out;\n}\n\nfunction randSign() {\n  return Math.random() > 0.5 ? 1 : -1;\n}\n\nfunction randInt(minOrMax: number, max: ?number = null, plusOrMinus: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.floor(Math.random() * Math.floor((max - min)) + Math.floor(min));\n  } else {\n    r = Math.floor(Math.random() * Math.floor(minOrMax));\n  }\n  if (plusOrMinus) {\n    r *= randSign();\n  }\n  return r;\n}\n\nfunction rand(minOrMax: number, max: ?number = null, plusOrMinus: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.random() * (max - min) + min;\n  } else {\n    r = Math.random() * minOrMax;\n  }\n  if (plusOrMinus) {\n    r *= randSign();\n  }\n  return r;\n}\n\nfunction randElement<T>(inputArray: Array<T>): T {\n  const index = randInt(inputArray.length);\n  return inputArray[index];\n}\n\nfunction removeRandElement<T>(inputArray: Array<T>): T {\n  const index = rand(inputArray.length);\n  return inputArray.splice(index, 1)[0];\n}\n\nfunction randElements<T>(num: number, inputArray: Array<T>): Array<T> {\n  const possibleIndeces = range(0, inputArray.length - 1, 1);\n  const elements = [];\n  for (let i = 0; i < num; i += 1) {\n    const index = removeRandElement(possibleIndeces);\n    elements.push(inputArray[index]);\n  }\n  return elements;\n}\n\nfunction rand2D(minX: number, minY: number, maxX: number, maxY: number) {\n  return {\n    x: rand(minX, maxX),\n    y: rand(minY, maxY),\n  };\n}\n\nexport {\n  round,\n  roundNum,\n  decelerate,\n  easeinout,\n  easeout,\n  easein,\n  sinusoid,\n  linear,\n  triangle,\n  clipMag,\n  clipValue,\n  range,\n  randInt,\n  rand,\n  randElement,\n  removeRandElement,\n  randElements,\n  rand2D,\n  randSign,\n};\n\n","// @flow\nimport { roundNum } from './math';\nimport { FunctionMap } from './FunctionMap';\n// import Worker from '../diagram/recorder.worker.js';\n\nconst Console = (text: string) => {\n  console.log(text); // eslint-disable-line no-console\n};\n\n// function add(a: number, b: number): number {\n//   return a + b;\n// }\n\n// function mulToString(a: number, b: number): string {\n//   return (a * b).toString();\n// }\n\n// const divide = (a: number, b: number): number => a / b;\n\nconst classify = (key: string, value: string) => {\n  const nonEmpty = value || key;\n  const withKey = nonEmpty[0] === '-' || nonEmpty.startsWith(`${key}-`)\n    ? `${key} ${nonEmpty}` : nonEmpty;\n  const joinStr = ` ${key}-`;\n  return `${withKey.split(' -').join(joinStr)}`;\n};\n\n\nclass ObjectKeyPointer {\n  object: Object;\n  key: string;\n  constructor(object: Object, key: string) {\n    this.object = object;\n    this.key = '';\n    if (key in object) {\n      this.key = key;\n    }\n  }\n\n  setValue(value: mixed) {\n    if (this.key) {\n      this.object[this.key] = value;\n    }\n  }\n\n  execute(...args: mixed) {\n    if (this.key) {\n      return this.object[this.key].apply(null, args);\n    }\n    return undefined;\n  }\n\n  value() {\n    if (this.key) {\n      return this.object[this.key];\n    }\n    return undefined;\n  }\n}\n//\nfunction extractFrom(\n  objectToExtractFrom: Object,\n  keyValues: Object | Array<any> | string,\n  keyPrefix: string = '',\n) {\n  const out = [];\n  if (typeof keyValues === 'string') {\n    if (keyPrefix + keyValues in objectToExtractFrom) {\n      return new ObjectKeyPointer(objectToExtractFrom, keyPrefix + keyValues);\n    }\n    const keyHeirarchy = keyValues.split('_');\n    const keys = keyHeirarchy.filter(k => k.length > 0);\n    if (keys.length > 1) {\n      if (keyPrefix + keys[0] in objectToExtractFrom) {\n        return extractFrom(objectToExtractFrom[keyPrefix + keys[0]], keys.slice(1).join('_'), keyPrefix);\n      }\n    } else if (keys.length === 1) {\n      if (keyPrefix + keys[0] in objectToExtractFrom) {\n        return new ObjectKeyPointer(objectToExtractFrom, keyPrefix + keys[0]);\n      }\n    }\n    return undefined;\n  }\n\n  if (Array.isArray(keyValues)) {\n    keyValues.forEach((kv) => {\n      const result = extractFrom(objectToExtractFrom, kv, keyPrefix);\n      if (result !== undefined) {\n        out.push(result);\n      }\n    });\n  } else {\n    Object.keys(keyValues).forEach((key) => {\n      if (keyPrefix + key in objectToExtractFrom) {\n        out.push({\n          obj: new ObjectKeyPointer(objectToExtractFrom, keyPrefix + key),\n          // $FlowFixMe\n          value: keyValues[key],\n        });\n      }\n    });\n  }\n  return out;\n}\n\nfunction getElement(\n  collection: Object,\n  keyValues: Object | Array<any> | string,\n) {\n  return extractFrom(collection, keyValues, '_');\n}\n\n\nfunction addToObject(\n  obj: Object,\n  nameToAdd: string,\n  valueToAdd: mixed,\n  splitStr: string = '-',\n) {\n  const levels = nameToAdd.split(splitStr);\n  let currentLevel: Object = obj;\n  levels.forEach((level, index) => {\n    if (index === levels.length - 1) {\n      currentLevel[level] = valueToAdd;\n      return;\n    }\n    if (!Object.prototype.hasOwnProperty.call(currentLevel, level)) {\n      currentLevel[level] = {};\n    }\n    currentLevel = currentLevel[level];\n  });\n}\n\n// function duplicateFromTo(\n//   fromObject: Object,\n//   toObject: Object,\n//   exceptKeys: Array<string> = [],\n// ) {\n//   const copyValue = (value) => {\n//     if (typeof value === 'number'\n//         || typeof value === 'boolean'\n//         || typeof value === 'string'\n//         || value == null\n//         || typeof value === 'function') {\n//       return value;\n//     }\n//     if (typeof value._dup === 'function') {\n//       return value._dup();\n//     }\n//     if (Array.isArray(value)) {\n//       const arrayCopy = [];\n//       value.forEach(arrayElement => arrayCopy.push(copyValue(arrayElement)));\n//       return arrayCopy;\n//     }\n//     if (typeof value === 'object') {\n//       const objectCopy = {};\n//       Object.keys(value).forEach((key) => {\n//         const v = copyValue(value[key]);\n//         objectCopy[key] = v;\n//       });\n//       return objectCopy;\n//     }\n//     return value;\n//   };\n\n//   Object.keys(fromObject).forEach((key) => {\n//     if (exceptKeys.indexOf(key) === -1) {\n//       // eslint-disable-next-line no-param-reassign\n//       toObject[key] = copyValue(fromObject[key]);\n//     }\n//   });\n// }\n\nfunction duplicate(value: ?(number | boolean | string | Object)) {\n  if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || value === NaN\n      || typeof value === 'function') {\n    return value;\n  }\n  if (typeof value._dup === 'function') {\n    return value._dup();\n  }\n  if (Array.isArray(value)) {\n    const arrayDup = [];\n    value.forEach(arrayElement => arrayDup.push(duplicate(arrayElement)));\n    return arrayDup;\n  }\n  // if (typeof value === 'object') {\n  const objectDup = {};\n  Object.keys(value).forEach((key) => {\n    const v = duplicate(value[key]);\n    objectDup[key] = v;\n  });\n  return objectDup;\n  // }\n  // return value;\n}\n\nfunction assignObjectFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptIn: Array<string> | string = [],\n  duplicateValues: boolean = false,\n  parentPath: string = '',\n) {\n  const except = typeof exceptIn === 'string' ? [exceptIn] : exceptIn;\n  Object.keys(fromObject).forEach((key) => {\n    const keyPath = parentPath !== '' ? `${parentPath}.${key}` : key;\n    if (except.indexOf(keyPath) !== -1) {\n      return;\n    }\n    const value = fromObject[key];\n    if (typeof value === 'object' && value != null && value._assignAsLinkOnly) {\n      // eslint-disable-next-line no-param-reassign\n      toObject[key] = fromObject[key];\n      return;\n    }\n    if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || typeof value === 'function'\n      || typeof value._dup === 'function'\n      || Array.isArray(value)\n    ) {\n      // Only assign the value if:\n      //    * Value is not undefined OR\n      //    * Value is undefined and toObject[key] is undefined\n      if (value !== undefined || toObject[key] === undefined) {\n        if (duplicateValues) {     // eslint-disable-next-line no-param-reassign\n          toObject[key] = duplicate(value);\n        } else {                   // eslint-disable-next-line no-param-reassign\n          toObject[key] = value;\n        }\n      }\n    } else {\n      // If the fromObject[key] value is an object, but the toObject[key] value\n      // is not an object, but then make toObject[key] an empty object\n      const toValue = toObject[key];\n      if (typeof toValue === 'number'\n        || typeof toValue === 'boolean'\n        || typeof toValue === 'string'\n        || toValue == null\n        || typeof toValue === 'function'\n        || Array.isArray(toValue)\n      ) {\n        // eslint-disable-next-line no-param-reassign\n        toObject[key] = {};\n      }\n      assignObjectFromTo(value, toObject[key], except, duplicateValues, keyPath);\n    }\n  });\n}\n\nfunction joinObjectsWithOptions(options: {\n  duplicate?: boolean,\n  except?: Array<string> | string,\n}, ...objects: Array<Object>): Object {\n  let { except } = options;\n  let dup = options.duplicate;\n  if (except == null) {\n    except = [];\n  }\n  if (dup == null) {\n    dup = false;\n  }\n\n  const num = objects.length;\n  const out = objects[0];\n  for (let i = 1; i < num; i += 1) {\n    const o = objects[i];\n    if (o != null) {\n      assignObjectFromTo(o, out, except, dup, '');\n    }\n  }\n  return out;\n}\n\n// joins objects like object.assign but goes as many levels deep as the object\n// is. Objects later in the arrawy overwrite objects earlier.\nfunction joinObjects(...objects: Array<Object>): Object {\n  return joinObjectsWithOptions({}, ...objects);\n}\n\nfunction duplicateFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptKeys: Array<string> = [],\n) {\n  joinObjectsWithOptions({ except: exceptKeys, duplicate: true }, toObject, fromObject);\n}\n\nfunction generateUniqueId(seed: string = '') {\n  const randomString = s => `${s}${Math.floor(Math.random() * 1000000)}`;\n  let seedToUse = seed;\n  if (seedToUse.length === 0) {\n    seedToUse = 'id_random_';\n  }\n  let idExists = true;\n  let newId = randomString(seedToUse);\n  while (idExists) {\n    newId = randomString(seedToUse);\n    const element = document.getElementById(newId);\n    if (element == null) {\n      idExists = false;\n    }\n  }\n  return newId;\n}\n\nfunction isTouchDevice() {\n  const prefixes = ' -webkit- -moz- -o- -ms- '.split(' ');\n  const mq = query => window.matchMedia(query).matches;\n\n  /* eslint-disable no-undef, no-mixed-operators */\n  // $FlowFixMe\n  if (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n    return true;\n  }\n  /* eslint-enable no-undef, no-mixed-operators */\n\n  // include the 'heartz' as a way to have a non matching MQ to help terminate the join\n  // https://git.io/vznFH\n  const query = ['(', prefixes.join('touch-enabled),('), 'heartz', ')'].join('');\n  return mq(query);\n}\n\nfunction loadRemote(\n  scriptId: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(scriptId);\n  if (!existingScript) {\n    const script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = url;\n    script.id = scriptId; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(script);\n    }\n    script.onload = () => {\n      if (callback != null) {\n        callback(scriptId, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(scriptId, url);\n  }\n}\n\nfunction loadRemoteCSS(\n  id: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(id);\n  if (!existingScript) {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    link.href = url;\n    link.id = id; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(link);\n    }\n    link.onload = () => {\n      if (callback != null) {\n        callback(id, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(id, url);\n  }\n}\n\n// function remoteLoadToObject(\n//   scriptId: string,\n//   url: string,\n//   toObject: {},\n//   callback: null | (string, string) => void = null,\n// ) {\n//   loadRemote(scriptId, url, callback);\n\n// }\n\nconst cleanUIDs = (objectToClean: Object) => {\n  const genericUID = '0000000000';\n  if (objectToClean == null) {\n    return;\n  }\n  if ('uid' in objectToClean) {\n    if (objectToClean.uid === genericUID) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    objectToClean.uid = genericUID;\n  }\n  const keys = Object.keys(objectToClean);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    const value = objectToClean[key];\n    if (\n      typeof value === 'object'\n      && !Array.isArray(value)\n      && value != null\n      && typeof value !== 'function'\n      && typeof value !== 'number'\n      && typeof value !== 'boolean'\n      && typeof value !== 'string'\n    ) {\n      cleanUIDs(value);\n    }\n  }\n};\n\nfunction deleteKeys(obj: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (obj[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      delete obj[key];\n    }\n  });\n}\n\nfunction copyKeysFromTo(source: Object, destination: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (source[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      destination[key] = source[key];\n    }\n  });\n}\n\nfunction generateRandomString() {\n  return (Math.random() * 1e18).toString(36);\n}\n\nclass UniqueMap {\n  map: Object;\n  index: number;\n  letters: string;\n\n  constructor() {\n    this.map = {};\n    this.index = 1;\n    this.inverseMap = {};\n    this.letters = '0abcdefghijklmnopqrstuvwxz';\n    this.undefinedCode = '.a';\n  }\n\n  reset() {\n    this.index = 1;\n    this.map = {};\n  }\n\n  add(pathStr: string) {\n    if (this.map[pathStr] != null) {\n      return this.map[pathStr];\n    }\n    const unique = this.getNextUniqueString();\n    this.map[pathStr] = unique;\n    return unique;\n  }\n\n  getNextUniqueString() {\n    if (this.index === 0) {\n      return 'a';\n    }\n    const order = Math.floor(Math.log(this.index) / Math.log(this.letters.length));\n    let remainder = this.index;\n    let out = '';\n    for (let i = order; i >= 0; i -= 1) {\n      const factor = Math.floor(remainder / this.letters.length ** i);\n      remainder -= factor * this.letters.length ** i;\n      out = `${out}${this.letters[factor]}`;\n    }\n    this.index += 1;\n    return out;\n  }\n\n  makeInverseMap() {\n    this.inverseMap = {};\n    Object.keys(this.map).forEach((key) => {\n      const uniqueStr = this.map[key];\n      this.inverseMap[uniqueStr] = key;\n    });\n  }\n\n  get(uniqueStr: string) {\n    if (uniqueStr === this.undefinedCode) {\n      return undefined;\n    }\n    if (this.inverseMap[uniqueStr] != null) {\n      return this.inverseMap[uniqueStr];\n    }\n    return uniqueStr;\n  }\n}\n\nfunction compressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n  precision: ?number = null,\n  uncompress: boolean = false,\n) {\n  if (typeof obj === 'string') {\n    // if (obj === 'do') {\n    //   console.log(obj, strValues, uncompress, map.get(obj))\n    // }\n    if (strValues && uncompress) {\n      return map.get(obj);\n    }\n    if (strValues) {\n      return map.add(obj);\n    }\n    return obj;\n  }\n  if (typeof obj === 'number') {\n    if (precision === null || uncompress) {\n      return obj;\n    }\n    return roundNum(obj, precision);\n  }\n  if (\n    typeof obj === 'boolean'\n    || typeof obj === 'function'\n    || obj === null\n  ) {\n    return obj;\n  }\n\n  if (obj === undefined) {\n    return map.undefinedCode;\n  }\n\n  if (Array.isArray(obj)) {\n    for (let i = 0; i < obj.length; i += 1) {\n      obj[i] = compressObject(obj[i], map, keys, strValues, precision, uncompress);\n    }\n    return obj;\n  }\n\n  if (typeof obj === 'object') {\n    const objKeys = Object.keys(obj);\n    const obj2 = {};\n    for (let i = 0; i < objKeys.length; i += 1) {\n      const k = objKeys[i];\n      obj[k] = compressObject(obj[k], map, keys, strValues, precision, uncompress);\n      if (keys && uncompress) {\n        obj2[map.get(k)] = obj[k];\n      } else if (keys) {\n        obj2[map.add(k)] = obj[k];\n      } else {\n        obj2[k] = obj[k];\n      }\n    }\n    if (keys) {\n      return obj2;\n    }\n    return obj2;\n  }\n  return obj;\n}\n\nfunction uncompressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n) {\n  return compressObject(obj, map, keys, strValues, null, true);\n}\n\nfunction minify(objectOrArray: any, precision: ?number = 4) {\n  const map = new UniqueMap();\n  return {\n    minified: compressObject(objectOrArray, map, true, true, precision),\n    map,\n  };\n}\n\nfunction unminify(minObjectOrArray: {\n  map: Object | UniqueMap,\n  minified: Object,\n}) {\n  let { map } = minObjectOrArray;\n  if (!(map instanceof UniqueMap)) {\n    const uMap = new UniqueMap();\n    uMap.map = map.map;\n    uMap.index = map.index;\n    uMap.letters = map.letters;\n    map = uMap;\n  }\n  map.makeInverseMap();\n  return uncompressObject(minObjectOrArray.minified, map, true, true);\n}\n\nfunction objectToPaths(obj: any, path: string = '', pathObj = {}, precision: ?number = null) {\n  if (\n    typeof obj === 'string'\n    // || typeof obj === 'number'\n    || typeof obj === 'boolean'\n    || typeof obj === 'function'\n  ) {\n    pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (typeof obj === 'number') {\n    if (precision != null) {\n      pathObj[`${path}`] = roundNum(obj, precision); // eslint-disable-line no-param-reassign\n    } else {\n      pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    }\n    return pathObj;\n  }\n  if (obj === null) {\n    pathObj[`${path}`] = null; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (obj === undefined) {\n    // pathObj[`${path}`] = undefined; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (Array.isArray(obj)) {\n    obj.forEach((o, index) => {\n      objectToPaths(o, `${path}[${index}]`, pathObj, precision);\n    });\n    return pathObj;\n  }\n  Object.keys(obj).forEach((key) => {\n    objectToPaths(obj[key], `${path}.${key}`, pathObj, precision);\n  });\n  return pathObj;\n}\n\nfunction getObjectDiff(\n  obj1In: Object,\n  diffs: Array<Object>,\n  obj2: Object,\n  precision: ?number = null,\n  debug: boolean = false,\n) {\n  // const pathMap = {};\n  let obj1 = obj1In;\n  if (diffs.length > 0) { // eslint-disable-next-line no-use-before-define\n    obj1 = refAndDiffToObject(obj1In, ...diffs);\n  }\n  const paths1 = objectToPaths(obj1, '', {}, precision);\n  const paths2 = objectToPaths(obj2, '', {}, precision);\n  const added = {};\n  const diff = {};\n  const removed = {};\n  Object.keys(paths1).forEach((key1) => {\n    if (paths2[key1] === undefined) {\n      removed[key1] = paths1[key1];\n      return;\n    }\n    if (paths1[key1] !== paths2[key1]) {\n      if (debug) {\n        diff[key1] = [paths1[key1], paths2[key1]];\n      } else {\n        diff[key1] = paths2[key1];\n      }\n    }\n  });\n  Object.keys(paths2).forEach((key2) => {\n    if (paths1[key2] === undefined) {\n      added[key2] = paths2[key2];\n    }\n  });\n  const out = {};\n  if (Object.keys(diff).length > 0) {\n    out.diff = diff;\n  }\n  if (Object.keys(added).length > 0) {\n    out.added = added;\n  }\n  if (Object.keys(removed).length > 0) {\n    out.removed = removed;\n  }\n  return out;\n}\n\nfunction updateObjFromPath(\n  remainingPath: Array<string>,\n  obj: Object,\n  value: any,\n  remove: boolean = false,\n) {\n  // console.log(remainingPath)\n  const fullP = remainingPath[0];\n  if (fullP.length === 0) {\n    return;\n  } \n  const arrayStringIndeces = fullP.match(/\\[[^\\]]*\\]/g);\n  const p = fullP.replace(/\\[.*/, '');\n  if (remainingPath.length === 1 && remove && !arrayStringIndeces) {\n    delete obj[p];\n    return;\n  }\n  if (arrayStringIndeces) {\n    const arrayIndeces = arrayStringIndeces.map(e => parseInt(e.replace(/\\[|\\]/g, ''), 10));\n    // console.log(arrayIndeces)\n    // return;\n    if (obj[p] == null || !Array.isArray(obj[p])) {\n      obj[p] = [];\n    }\n    // console.log(obj)\n    // return\n    let currentArray = obj[p];\n    let index = 0;\n    for (let i = 0; i < arrayIndeces.length; i += 1) {\n      index = arrayIndeces[i];\n      if (currentArray.length <= index) {\n        for (let j = currentArray.length; j < index - currentArray.length + 1; j += 1) {\n          currentArray.push(undefined);\n        }\n      }\n      if (i < arrayIndeces.length - 1) {\n        // currentArray[index] = currentArray[index][i];\n        if (!Array.isArray(currentArray[index])) {\n          currentArray[index] = [];\n        }\n        currentArray = currentArray[index];\n      }\n    }\n    if (remainingPath.length === 1 && remove) {\n      currentArray[index] = undefined;\n      return;\n    }\n    if (remainingPath.length === 1) {\n      currentArray[index] = value;\n      return;\n    }\n    if (currentArray[index] == null || typeof currentArray[index] !== 'object') {\n      currentArray[index] = {};\n    }\n    updateObjFromPath(remainingPath.slice(1), currentArray[index], value, remove);\n    return;\n  }\n\n  // if (remainingPath.length === 1 && remove) {\n  //   console.log('asdf')\n  //   obj[p] = undefined;\n  // }\n  if (remainingPath.length === 1) {\n    obj[p] = value;\n    return;\n  }\n  if (obj[p] == null) {\n    obj[p] = {};\n  }\n  updateObjFromPath(remainingPath.slice(1), obj[p], value, remove);\n}\n\nfunction pathsToObj(paths: Object) {\n  const obj = {};\n  Object.keys(paths).forEach((key) => {\n    const path = key.split('.').filter(p => p.length > 0);\n    const value = paths[key];\n    if (Array.isArray(value)) {\n      updateObjFromPath(path, obj, value.slice(-1)[0]);\n    } else {\n      updateObjFromPath(path, obj, value);\n    }\n  });\n  return obj;\n}\n\nfunction refAndDiffToObject(\n  referenceIn: Object,\n  ...diffsIn: Array<{\n    added: Object,\n    diff: Object,\n    removed: Object,\n  }>\n) {\n  const ref = duplicate(referenceIn);\n  const processPaths = (paths: Object, remove: boolean = false) => {\n    // console.log(paths)\n    Object.keys(paths).forEach((pathStr) => {\n      // console.log(pathStr)\n      const path = pathStr.split('.').filter(p => p.length > 0);\n      const value = paths[pathStr];\n      if (Array.isArray(value)) {\n        updateObjFromPath(path, ref, value.slice(-1)[0], remove);\n      } else {\n        updateObjFromPath(path, ref, value, remove);\n      }\n    });\n  };\n  // console.log(diffsIn)\n  diffsIn.forEach((diffIn) => {\n    // console.log(diffIn)\n    const { added, removed, diff } = diffIn;\n    // console.log(1, removed)\n    if (removed != null) {\n      processPaths(removed, true);\n    }\n    // console.log(2)\n    if (added != null) {\n      processPaths(added);\n    }\n    // console.log(3)\n    if (diff != null) {\n      processPaths(diff);\n    }\n  });\n  return ref;\n}\n\nfunction diffPathsToObj(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = pathsToObj(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = pathsToObj(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = pathsToObj(diff.removed);\n  }\n  return out;\n}\n\nfunction diffObjToPaths(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = objectToPaths(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = objectToPaths(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = objectToPaths(diff.removed);\n  }\n  return out;\n}\n\n// Class that can track an object's differences over time\nclass ObjectTracker {\n  baseReference: ?Object;\n  references: {\n    [refName: string]: {\n      basedOn: string,\n      diff: Object,\n    },\n  };\n\n  precision: number;\n\n  //             time   refName  diff\n  diffs: Array<[number, string, Object, number]>\n\n  lastReferenceName: string;\n\n  constructor(precision: number = 8) {\n    this.precision = precision;\n    this.reset();\n  }\n\n  toObj() {\n    const references = {};\n    Object.keys(this.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: this.references[refName].basedOn,\n        diff: diffPathsToObj(this.references[refName].diff),\n      };\n    });\n    const diffs = this.diffs.map(d => [d[0], d[1], diffPathsToObj(d[2]), d[3]]);\n    return {\n      baseReference: duplicate(this.baseReference),\n      diffs,\n      references,\n      precision: this.precision,\n      lastReferenceName: this.lastReferenceName,\n    };\n  }\n\n  setFromObj(obj: Object) {\n    const references = {};\n    Object.keys(obj.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: obj.references[refName].basedOn,\n        diff: diffObjToPaths(obj.references[refName].diff),\n      };\n    });\n    this.references = references;\n    this.baseReference = duplicate(obj.baseReference);\n    this.precision = obj.precision;\n    this.diffs = obj.diffs.map(d => [d[0], d[1], diffObjToPaths(d[2]), d[3]]);\n    this.lastReferenceName = obj.lastReferenceName;\n  }\n\n  reset() {\n    this.baseReference = null;\n    this.references = {};\n    this.diffs = [];\n    this.lastReferenceName = '__base';\n  }\n\n  setBaseReference(obj: Object) {\n    this.baseReference = duplicate(obj);\n    this.lastReferenceName = '__base';\n  }\n\n  addReference(\n    obj: Object,\n    refName: string,\n    basedOn: string = '__base',\n  ) {\n    if (this.baseReference == null || refName === '__base') {\n      this.setBaseReference(obj);\n    }\n    if (refName !== '__base') {\n      this.references[refName] = {\n        diff: this.getDiffToReference(obj, basedOn),\n        basedOn,\n      };\n      this.lastReferenceName = refName;\n    }\n  }\n\n  getReferenceChain(name: string, chain: Array<Object>) {\n    if (name === '__base') {\n      return chain;\n    }\n    if (this.references[name] == null) {\n      return chain;\n    }\n    return this.getReferenceChain(\n      this.references[name].basedOn, [this.references[name].diff, ...chain],\n    );\n  }\n\n  getReference(refName: string) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    return refAndDiffToObject(this.baseReference, ...referenceChain);\n  }\n\n  getDiffToReference(\n    obj: Object,\n    refName: string,\n  ) {\n    const s1 = performance.now()\n    const referenceChain = this.getReferenceChain(refName, []);\n    // console.log('ref Chain', performance.now() - s1);\n    const s2 = performance.now()\n    const diff = getObjectDiff(this.baseReference, referenceChain, obj, this.precision);\n    // console.log('s2', performance.now() - s2);\n    return diff;\n  }\n\n  getObjFromDiffAndReference(\n    diff: Object,\n    refName: string,\n  ) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    const diffs = [...referenceChain, diff];\n    return refAndDiffToObject(this.baseReference, ...diffs);\n  }\n\n  add(time: number, obj: Object, refName: string = this.lastReferenceName, timeCount: number = 0) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    const diff = this.getDiffToReference(obj, refName);\n    this.diffs.push([time, refName, diff, timeCount]);\n  }\n\n  addWithWorker(time: number, obj: Object, refName: string = this.lastReferenceName, timeCount: number = 0) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    this.startWorker();\n    if (this.worker != null) {\n      this.worker.postMessage([time, refName, obj, timeCount]);\n    }\n  }\n\n  startWorker() {\n    if (this.worker != null) {\n      return;\n    }\n    this.worker = new Worker();\n\n    this.worker.addEventListener(\"message\", function (event) {\n      console.log(event.data)\n    });\n  }\n\n  getFromIndex(index: number) {\n    if (index > this.diffs.length) {\n      return null;\n    }\n    const [, basedOn, diff] = this.diffs[index];\n    return this.getObjFromDiffAndReference(diff, basedOn);\n  }\n}\n\nclass Subscriber {\n  fnMap: FunctionMap;\n  subscribers: {\n    [id: string]: {\n      callback: () => void;\n      num: number;\n    }\n  };\n\n  order: Array<number>;\n\n  nextId: number;\n\n  constructor(fnMap: FunctionMap = new FunctionMap()) {\n    this.fnMap = fnMap;\n    this.subscribers = {};\n    this.nextId = 0;\n    this.order = [];\n  }\n\n  subscribe(callback: () => void, numberOfSubscriptions: number = -1) {\n    this.subscribers[`${this.nextId}`] = {\n      callback,\n      num: numberOfSubscriptions,\n    };\n    this.order.push(`${this.nextId}`);\n    this.nextId += 1;\n    return this.nextId - 1;\n  }\n\n  trigger(payload: any) {\n    const subscribersToRemove = [];\n    for (let i = 0; i < this.order.length; i += 1) {\n      const id = this.order[i];\n      const { callback, num } = this.subscribers[`${id}`];\n      // if (callback != null) {\n      //   callback(payload);\n      // }\n      if (num === 1) {\n        subscribersToRemove.push(id);\n      }\n      let triggerOk = false;\n      if (num !== 0) {\n        triggerOk = true;\n        // subscribersToRemove.push(id);\n      }\n      if (num > 0) {\n        this.subscribers[`${id}`].num = num - 1;\n      }\n\n      // if (num > 0) {\n      // }\n      // else if (num > 1) {\n      //   triggerOk = true;\n      //   this.subscribers[`${id}`].num = num - 1;\n      // }\n      // if (this.subscribers[`${id}`].num > 0) {\n      if (triggerOk) {\n        this.fnMap.exec(callback, payload);\n      }\n    }\n    subscribersToRemove.forEach((id) => { this.unsubscribe(id); });\n  }\n\n  unsubscribe(idIn: string | number) {\n    const id = `${idIn}`;\n    if (this.subscribers[id] != null) {\n      delete this.subscribers[id];\n    }\n    const index = this.order.indexOf(id);\n    if (index > -1) {\n      this.order.splice(index, 1);\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _excludeStateKeys() {\n    return ['fnMap'];\n  }\n}\n\nclass SubscriptionManager {\n  fnMap: FunctionMap;\n  subscriptions: {\n    [subscriptionName: string]: Subscriber;\n  }\n\n  constructor(fnMap: FunctionMap = new FunctionMap()) {\n    this.subscriptions = {};\n    this.fnMap = fnMap;\n  }\n\n  subscribe(\n    subscriptionName: string,\n    callback: () => void,\n    numberOfSubscriptions: number = -1,\n  ) {\n    if (this.subscriptions[subscriptionName] == null) {\n      this.subscriptions[subscriptionName] = new Subscriber(this.fnMap);\n    }\n    return this.subscriptions[subscriptionName].subscribe(callback, numberOfSubscriptions);\n  }\n\n  trigger(subscriptionName: string, payload: any) {\n    if (this.subscriptions[subscriptionName] != null) {\n      this.subscriptions[subscriptionName].trigger(payload);\n    }\n  }\n\n  unsubscribe(subscriptionName: string, id: string | number) {\n    if (this.subscriptions[subscriptionName] != null) {\n      const subscription = this.subscriptions[subscriptionName];\n      subscription.unsubscribe(id);\n      if (subscription.order.length === 0) {\n        delete this.subscriptions[subscriptionName];\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  _excludeStateKeys() {\n    return ['fnMap'];\n  }\n}\n\nfunction download(filename: string, text: string) {\n  const element = document.createElement('a');\n  element.setAttribute(\n    'href',\n    `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`,\n  );\n  element.setAttribute('download', filename);\n  element.style.display = 'none';\n  const { body } = document;\n  if (body != null) {\n    body.appendChild(element);\n    element.click();\n    body.removeChild(element);\n  }\n}\n\nexport {\n  diffPathsToObj, diffObjToPaths,\n  Console,\n  classify, extractFrom, ObjectKeyPointer, getElement,\n  addToObject, duplicateFromTo, isTouchDevice,\n  generateUniqueId, joinObjects, cleanUIDs, loadRemote, loadRemoteCSS,\n  deleteKeys, copyKeysFromTo, generateRandomString,\n  duplicate, assignObjectFromTo, joinObjectsWithOptions,\n  objectToPaths, getObjectDiff, updateObjFromPath, pathsToObj,\n  UniqueMap, compressObject, refAndDiffToObject, uncompressObject,\n  unminify, minify, ObjectTracker,\n  download,\n  Subscriber,\n  SubscriptionManager,\n};\n\n"],"sourceRoot":""}