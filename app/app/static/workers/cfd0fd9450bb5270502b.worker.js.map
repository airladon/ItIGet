{"version":3,"sources":["webpack://Fig/webpack/bootstrap","webpack://Fig/./src/js/diagram/recorder.worker.js","webpack://Fig/./src/js/tools/math.js","webpack://Fig/./src/js/tools/tools.js"],"names":["roundNum","value","precision","multiplier","result","Math","round","objectIsPolyfill","x","y","arrayOrValue","Array","isArray","map","elem","clipMag","zeroThreshold","maxValue","zeroT","maxV","clipValue","minValue","clipped","decelerate","getPositionVelocityFromDecAndTime","position","velocity","magDeceleration","time","decel","v","p","d","sign","abs","newVelocity","newSign","t","z","zSign","newPosition","linear","percentTime","invert","easeinout","a","sqrt","percentDistance","easeout","b","power","easein","sinusoid","deltaTime","frequency","bias","mag","phaseOffset","sin","PI","range","start","stop","step","out","i","push","randSign","random","randInt","minOrMax","max","plusOrMinus","r","min","floor","rand","randElement","inputArray","index","length","removeRandElement","splice","randElements","num","possibleIndeces","elements","rand2D","minX","minY","maxX","maxY","Console","text","console","log","classify","key","nonEmpty","withKey","startsWith","joinStr","split","join","ObjectKeyPointer","object","args","apply","undefined","extractFrom","objectToExtractFrom","keyValues","keyPrefix","keyHeirarchy","keys","filter","k","slice","forEach","kv","Object","obj","getElement","collection","addToObject","nameToAdd","valueToAdd","splitStr","levels","currentLevel","level","prototype","hasOwnProperty","call","duplicate","NaN","_dup","arrayDup","arrayElement","objectDup","assignObjectFromTo","fromObject","toObject","exceptIn","duplicateValues","parentPath","except","keyPath","indexOf","_assignAsLinkOnly","toValue","joinObjectsWithOptions","options","dup","o","joinObjects","objects","duplicateFromTo","exceptKeys","generateUniqueId","seed","randomString","s","seedToUse","idExists","newId","element","document","getElementById","isTouchDevice","prefixes","mq","query","window","matchMedia","matches","DocumentTouch","loadRemote","scriptId","url","callback","existingScript","script","createElement","type","src","id","body","appendChild","onload","loadRemoteCSS","link","rel","href","cleanUIDs","objectToClean","genericUID","uid","deleteKeys","copyKeysFromTo","source","destination","generateRandomString","toString","UniqueMap","inverseMap","letters","undefinedCode","pathStr","unique","getNextUniqueString","order","remainder","factor","uniqueStr","compressObject","strValues","uncompress","get","add","objKeys","obj2","uncompressObject","minify","objectOrArray","minified","unminify","minObjectOrArray","uMap","makeInverseMap","objectToPaths","path","pathObj","getObjectDiff","obj1In","diffs","debug","obj1","refAndDiffToObject","paths1","paths2","added","diff","removed","key1","key2","updateObjFromPath","remainingPath","remove","fullP","arrayStringIndeces","match","replace","arrayIndeces","e","parseInt","currentArray","j","pathsToObj","paths","referenceIn","ref","processPaths","diffsIn","diffIn","diffPathsToObj","diffObjToPaths","ObjectTracker","reset","references","refName","basedOn","baseReference","lastReferenceName","setBaseReference","getDiffToReference","name","chain","getReferenceChain","referenceChain","s1","performance","now","s2","timeCount","startWorker","worker","postMessage","Worker","addEventListener","event","data","getObjFromDiffAndReference","download","filename","setAttribute","encodeURIComponent","style","display","click","removeChild"],"mappings":"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","file":"cfd0fd9450bb5270502b.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/diagram/recorder.worker.js\");\n","// @flow\nimport {\n  ObjectTracker,\n} from '../tools/tools';\n\n// declare var self: DedicatedWorkerGlobalScope;\n\nlet cache = new ObjectTracker();\n\n// onmessage = (event: MessageEvent) => {\naddEventListener(\"message\", (event) => {\n  const { message, payload } = event.data;\n  if (message === 'reset') {\n    // resetCache(payload.baseReference, payload.references)\n    cache = new ObjectTracker();\n    cache.baseReference = payload.baseReference;\n    cache.references = payload.references;\n  } else if (message === 'get') {\n    postMessage({\n      message: 'cache',\n      payload: {\n        baseReferece: cache.baseReference,\n        references: cache.references,\n        diffs: cache.diffs,\n      },\n    });\n  } else if (message === 'add') {\n    // add(payload.now, payload.state, payload.reference, payload.lastRecordTimeCount);\n    cache.add(payload.now, payload.state, payload.reference, payload.lastRecordTimeCount);\n    // postMessage({\n    //   message: 'cacheDuration',\n    //   duration: cache.diffs[cache.diffs.length - 1],\n    // });\n  } else if (message === 'addReferece') {\n    cache.addReference(payload.state, payload.refName, payload.basedOn);\n  }\n  // console.log('worker', event.data);\n  // postMessage(`From Worker: ${event.data[0] + 2 * event.data[1]}`)\n});\n\n// function resetCache(baseReference: Object, references: Object) {\n//   cache = new ObjectTracker();\n//   cache.baseReference = baseReference;\n//   cache.references = references;\n// }\n\n// function add(now: number, state: Object, reference: string, lastRecordTimeCount: number) {\n//   cache.add(now, state, reference, lastRecordTimeCount);\n//   postMessage({\n//     message: 'cacheDuration',\n//     duration: cache.diffs[cache.diffs.length - 1],\n//   })\n// }\n","// @flow\n\nconst roundNum = (value: number, precision: number = 5): number => {\n  const multiplier = 10 ** precision;\n  let result = Math.round(value * multiplier) / multiplier;\n  // if (Object.is(result, -0)) {\n  // if (result === -0) {\n  //   result = 0;\n  // }\n  const objectIsPolyfill = (x, y) => {\n    if (x === y) {\n      // 0 === -0, but they are not identical\n      return x !== 0 || 1 / x === 1 / y;\n    }\n    // NaN !== NaN, but they are identical.\n    // NaNs are the only non-reflexive value, i.e., if x !== x,\n    // then x is a NaN.\n    // isNaN is broken: it converts its argument to number, so\n    // isNaN(\"foo\") => true\n    // eslint-disable-next-line no-self-compare\n    return x !== x && y !== y;\n  };\n  if (objectIsPolyfill(result, -0)) {\n    result = 0;\n  }\n  // if (result === -0) {\n  //   // 0 === -0, but they are not identical\n  //   return result !== 0 || 1 / x === 1 / y;\n  // }\n\n  return result;\n};\n\ntype TypeRoundObject = {\n  round?: (number) => TypeRoundObject;\n} & Object;\n/**\n * Rounds a number or numbers in an array\n * @method\n * @param {number | Array<number>} arrayOrValue - Value or array of values to be rounded\n * @param {number} precision - Number of decimal places to round to\n * @returns {number | Array<number>} Rounded value or array of values\n */\nfunction round<T: number | TypeRoundObject | Array<number | TypeRoundObject>>(\n  arrayOrValue: T,\n  precision: number = 5,\n): T {\n  let result = 0;\n  if (Array.isArray(arrayOrValue)) {\n    return arrayOrValue.map(elem => round(elem, precision));\n  }\n  if (typeof arrayOrValue === 'number') {\n    result = roundNum(arrayOrValue, precision);\n  } else if (arrayOrValue != null && arrayOrValue.round != null) {\n    result = arrayOrValue.round(precision);\n  }\n  // $FlowFixMe\n  return result;\n}\n\n\n// // clipValue clips a value to either 0 if it's small enough, or to a max value\n// // Value, and maxValue are sign independent. e.g.\n// //    * value, maxValue = 2, 1 => clips to 1\n// //    * value, maxValue = -2, -1 => clips to -1\n// //    * value, maxValue = -2, 1 => clips to -1\n// //    * value, maxValue = 2, -1 => clips to 1\n// function clipValue(\n//   value: number,\n//   zeroThreshold: number,\n//   maxValue: number = 0,\n// ) {\n//   let result = value;\n//   let zero = zeroThreshold;\n//   if (zero < 0) {\n//     zero = -zero;\n//   }\n//   if (value > -zero && value < zero) {\n//     return 0;\n//   }\n//   let max = maxValue;\n//   if (max < 0) {\n//     max = -max;\n//   }\n\n//   if (value > max) {\n//     result = max;\n//   }\n//   if (value < -max) {\n//     result = -max;\n//   }\n//   return result;\n// }\n\n\n// Clip a value to either max velocity, or 0 once under the minimum\n// threashold.\n//  * velocity: can be positive or negative\n//  * maxVelocity will clip velocity to:\n//      * |maxVelocity| if velocity > 0\n//      * -|maxVelocity| if velcity < 0\n//  * zeroThreshold will clip velocity to:\n//       * 0 if velocity is larger than -|zeroThreshold| and smaller than\n//         |zeroThreshold|.\nfunction clipMag(\n  value: number,\n  zeroThreshold: number | null,\n  maxValue: number | null,\n): number {\n  let result = value;\n  let zeroT = zeroThreshold;\n  let maxV = maxValue;\n\n  if (zeroT === null) {\n    zeroT = 0;\n  }\n  if (zeroT < 0) {\n    zeroT = -zeroT;\n  }\n  if (maxV === null) {\n    return result;\n  }\n  if (maxV < 0) {\n    maxV = -maxV;\n  }\n  if (value >= -zeroT && value <= zeroT) {\n    result = 0;\n  }\n  if (value > maxV) {\n    result = maxV;\n  }\n  if (value < -maxV) {\n    result = -maxV;\n  }\n  return result;\n}\n\nfunction clipValue(\n  value: number,\n  minValue: number | null,\n  maxValue: number | null,\n): number {\n  let clipped = value;\n  if (minValue !== null) {\n    if (value < minValue) {\n      clipped = minValue;\n    }\n  }\n\n  if (maxValue !== null) {\n    if (value > maxValue) {\n      clipped = maxValue;\n    }\n  }\n  return clipped;\n}\n\nconst decelerate = function getPositionVelocityFromDecAndTime(\n  position: number,\n  velocity: number,\n  magDeceleration: number | null,\n  time: number,\n  zeroThreshold: number | null,\n) {\n  let zeroT: number = 0;\n  if (zeroThreshold !== null) {\n    zeroT = zeroThreshold;\n  }\n  let decel: number = 0;\n  if (magDeceleration !== null) {\n    decel = magDeceleration;\n  }\n  // If the velocity is currently 0, then no further deceleration can occur, so\n  // return the current velocity and position\n  const v = clipMag(velocity, zeroT, velocity);\n  if (v === 0) {\n    return {\n      p: position,\n      v: 0,\n    };\n  }\n\n  let d = decel;\n  if (decel < 0) {\n    d = -d;\n  }\n  // If there is some initial velocity, then calc its sign and\n  const sign = velocity / Math.abs(velocity);\n  let newVelocity = velocity - sign * d * time;\n\n  // if the new velocity changes sign, then it should go to 0. If it doesn't\n  // change sign, then clip incase it should go to 0 because it is below\n  // the zero velocity threshold.\n  const newSign = newVelocity / Math.abs(newVelocity);\n  if (newSign !== sign) {\n    newVelocity = 0;\n  } else {\n    newVelocity = clipMag(newVelocity, zeroT, newVelocity);\n  }\n\n  // If the new velocity is clipped, then we need to use the time to where the\n  // velocity crosses the clipping point.\n  // v_new = v_init + a*t\n  // Therefore, if v_new = zeroT: t = (zeroT - vi)/a\n  let t = time;\n  if (newVelocity === 0) {\n    let z = zeroT;\n    const zSign = z / Math.abs(z);\n    if (zSign !== sign) {\n      z = -z;\n    }\n    t = Math.abs((z - velocity) / d);\n  }\n  // Now can calculate the new position\n  const newPosition = position + velocity * t - sign * 0.5 * d * t * t;\n\n  return {\n    p: newPosition,\n    v: newVelocity,\n  };\n};\n\n\nconst linear = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    return percentTime;\n  }\n  return percentTime;\n};\n\nconst easeinout = (percentTime: number, invert: ?boolean = false) => {\n  if (invert) {\n    if (percentTime === 0.5) {\n      return  0.5;\n    }\n    const a = percentTime;\n    return (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n  }\n  const x = percentTime;\n  const percentDistance = (x ** 2) / ((x ** 2) + ((1 - x) ** 2));\n  return percentDistance;\n};\n\nfunction easeout(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 0) {\n      return 0;\n    }\n    const a = percentTime / 2 + 0.5;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return (b - 0.5) * 2;\n  }\n  const x = 0.5 + percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return (percentDistance - 0.5) * 2;\n}\n\nfunction easein(percentTime: number, invert: ?boolean = false) {\n  if (invert) {\n    if (percentTime === 1) {\n      return 1;\n    }\n    const a = percentTime / 2;\n    const b = (2 * a - Math.sqrt(-4 * a * a + 4 * a)) / (4 * a - 2);\n    return b * 2;\n  }\n  const x = percentTime / 2;\n  const power = 2;\n  const percentDistance = (x ** power) / ((x ** power) + ((1 - x) ** power));\n  return percentDistance * 2;\n}\n\nfunction sinusoid(\n  deltaTime: number = 1,\n  frequency: number = 1,\n  bias: number = 0,\n  mag: number = 1,\n  phaseOffset: number = 0,\n) {\n  return bias + mag * Math.sin(deltaTime * frequency * 2.0 * Math.PI + phaseOffset);\n}\n\n// const animationPhase = (transform, time, rotDirection = 0, animationStyle = easeinout) => {\n//     return {\n//         transform: transform._dup(),\n//         time: time,\n//         rotDirection: rotDirection,\n//         animationStyle: animationStyle,\n//     }\n// }\n\n/**\n * Creates an array with a range of number\n * @method\n * @memberof tools\n * @param start - Range start\n * @param stop - Range stop\n * @param step - Range step\n * @returns {Array<number>} Range of numbers in an array\n */\nfunction range(start: number, stop: number, step: number = 1) {\n  const out = [];\n  for (let i = start; i <= stop + step * 0.5; i += step) {\n    out.push(i);\n  }\n  return out;\n}\n\nfunction randSign() {\n  return Math.random() > 0.5 ? 1 : -1;\n}\n\nfunction randInt(minOrMax: number, max: ?number = null, plusOrMinus: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.floor(Math.random() * Math.floor((max - min)) + Math.floor(min));\n  } else {\n    r = Math.floor(Math.random() * Math.floor(minOrMax));\n  }\n  if (plusOrMinus) {\n    r *= randSign();\n  }\n  return r;\n}\n\nfunction rand(minOrMax: number, max: ?number = null, plusOrMinus: boolean = false) {\n  let r = 0;\n  if (max != null) {\n    const min = minOrMax;\n    r = Math.random() * (max - min) + min;\n  } else {\n    r = Math.random() * minOrMax;\n  }\n  if (plusOrMinus) {\n    r *= randSign();\n  }\n  return r;\n}\n\nfunction randElement<T>(inputArray: Array<T>): T {\n  const index = randInt(inputArray.length);\n  return inputArray[index];\n}\n\nfunction removeRandElement<T>(inputArray: Array<T>): T {\n  const index = rand(inputArray.length);\n  return inputArray.splice(index, 1)[0];\n}\n\nfunction randElements<T>(num: number, inputArray: Array<T>): Array<T> {\n  const possibleIndeces = range(0, inputArray.length - 1, 1);\n  const elements = [];\n  for (let i = 0; i < num; i += 1) {\n    const index = removeRandElement(possibleIndeces);\n    elements.push(inputArray[index]);\n  }\n  return elements;\n}\n\nfunction rand2D(minX: number, minY: number, maxX: number, maxY: number) {\n  return {\n    x: rand(minX, maxX),\n    y: rand(minY, maxY),\n  };\n}\n\nexport {\n  round,\n  roundNum,\n  decelerate,\n  easeinout,\n  easeout,\n  easein,\n  sinusoid,\n  linear,\n  clipMag,\n  clipValue,\n  range,\n  randInt,\n  rand,\n  randElement,\n  removeRandElement,\n  randElements,\n  rand2D,\n  randSign,\n};\n\n","// @flow\nimport { roundNum } from './math';\n// import Worker from '../diagram/recorder.worker.js';\n\nconst Console = (text: string) => {\n  console.log(text); // eslint-disable-line no-console\n};\n\n// function add(a: number, b: number): number {\n//   return a + b;\n// }\n\n// function mulToString(a: number, b: number): string {\n//   return (a * b).toString();\n// }\n\n// const divide = (a: number, b: number): number => a / b;\n\nconst classify = (key: string, value: string) => {\n  const nonEmpty = value || key;\n  const withKey = nonEmpty[0] === '-' || nonEmpty.startsWith(`${key}-`)\n    ? `${key} ${nonEmpty}` : nonEmpty;\n  const joinStr = ` ${key}-`;\n  return `${withKey.split(' -').join(joinStr)}`;\n};\n\n\nclass ObjectKeyPointer {\n  object: Object;\n  key: string;\n  constructor(object: Object, key: string) {\n    this.object = object;\n    this.key = '';\n    if (key in object) {\n      this.key = key;\n    }\n  }\n\n  setValue(value: mixed) {\n    if (this.key) {\n      this.object[this.key] = value;\n    }\n  }\n\n  execute(...args: mixed) {\n    if (this.key) {\n      return this.object[this.key].apply(null, args);\n    }\n    return undefined;\n  }\n\n  value() {\n    if (this.key) {\n      return this.object[this.key];\n    }\n    return undefined;\n  }\n}\n//\nfunction extractFrom(\n  objectToExtractFrom: Object,\n  keyValues: Object | Array<any> | string,\n  keyPrefix: string = '',\n) {\n  const out = [];\n  if (typeof keyValues === 'string') {\n    if (keyPrefix + keyValues in objectToExtractFrom) {\n      return new ObjectKeyPointer(objectToExtractFrom, keyPrefix + keyValues);\n    }\n    const keyHeirarchy = keyValues.split('_');\n    const keys = keyHeirarchy.filter(k => k.length > 0);\n    if (keys.length > 1) {\n      if (keyPrefix + keys[0] in objectToExtractFrom) {\n        return extractFrom(objectToExtractFrom[keyPrefix + keys[0]], keys.slice(1).join('_'), keyPrefix);\n      }\n    } else if (keys.length === 1) {\n      if (keyPrefix + keys[0] in objectToExtractFrom) {\n        return new ObjectKeyPointer(objectToExtractFrom, keyPrefix + keys[0]);\n      }\n    }\n    return undefined;\n  }\n\n  if (Array.isArray(keyValues)) {\n    keyValues.forEach((kv) => {\n      const result = extractFrom(objectToExtractFrom, kv, keyPrefix);\n      if (result !== undefined) {\n        out.push(result);\n      }\n    });\n  } else {\n    Object.keys(keyValues).forEach((key) => {\n      if (keyPrefix + key in objectToExtractFrom) {\n        out.push({\n          obj: new ObjectKeyPointer(objectToExtractFrom, keyPrefix + key),\n          // $FlowFixMe\n          value: keyValues[key],\n        });\n      }\n    });\n  }\n  return out;\n}\n\nfunction getElement(\n  collection: Object,\n  keyValues: Object | Array<any> | string,\n) {\n  return extractFrom(collection, keyValues, '_');\n}\n\n\nfunction addToObject(\n  obj: Object,\n  nameToAdd: string,\n  valueToAdd: mixed,\n  splitStr: string = '-',\n) {\n  const levels = nameToAdd.split(splitStr);\n  let currentLevel: Object = obj;\n  levels.forEach((level, index) => {\n    if (index === levels.length - 1) {\n      currentLevel[level] = valueToAdd;\n      return;\n    }\n    if (!Object.prototype.hasOwnProperty.call(currentLevel, level)) {\n      currentLevel[level] = {};\n    }\n    currentLevel = currentLevel[level];\n  });\n}\n\n// function duplicateFromTo(\n//   fromObject: Object,\n//   toObject: Object,\n//   exceptKeys: Array<string> = [],\n// ) {\n//   const copyValue = (value) => {\n//     if (typeof value === 'number'\n//         || typeof value === 'boolean'\n//         || typeof value === 'string'\n//         || value == null\n//         || typeof value === 'function') {\n//       return value;\n//     }\n//     if (typeof value._dup === 'function') {\n//       return value._dup();\n//     }\n//     if (Array.isArray(value)) {\n//       const arrayCopy = [];\n//       value.forEach(arrayElement => arrayCopy.push(copyValue(arrayElement)));\n//       return arrayCopy;\n//     }\n//     if (typeof value === 'object') {\n//       const objectCopy = {};\n//       Object.keys(value).forEach((key) => {\n//         const v = copyValue(value[key]);\n//         objectCopy[key] = v;\n//       });\n//       return objectCopy;\n//     }\n//     return value;\n//   };\n\n//   Object.keys(fromObject).forEach((key) => {\n//     if (exceptKeys.indexOf(key) === -1) {\n//       // eslint-disable-next-line no-param-reassign\n//       toObject[key] = copyValue(fromObject[key]);\n//     }\n//   });\n// }\n\nfunction duplicate(value: ?(number | boolean | string | Object)) {\n  if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || value === NaN\n      || typeof value === 'function') {\n    return value;\n  }\n  if (typeof value._dup === 'function') {\n    return value._dup();\n  }\n  if (Array.isArray(value)) {\n    const arrayDup = [];\n    value.forEach(arrayElement => arrayDup.push(duplicate(arrayElement)));\n    return arrayDup;\n  }\n  // if (typeof value === 'object') {\n  const objectDup = {};\n  Object.keys(value).forEach((key) => {\n    const v = duplicate(value[key]);\n    objectDup[key] = v;\n  });\n  return objectDup;\n  // }\n  // return value;\n}\n\nfunction assignObjectFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptIn: Array<string> | string = [],\n  duplicateValues: boolean = false,\n  parentPath: string = '',\n) {\n  const except = typeof exceptIn === 'string' ? [exceptIn] : exceptIn;\n  Object.keys(fromObject).forEach((key) => {\n    const keyPath = parentPath !== '' ? `${parentPath}.${key}` : key;\n    if (except.indexOf(keyPath) !== -1) {\n      return;\n    }\n    const value = fromObject[key];\n    if (typeof value === 'object' && value != null && value._assignAsLinkOnly) {\n      // eslint-disable-next-line no-param-reassign\n      toObject[key] = fromObject[key];\n      return;\n    }\n    if (typeof value === 'number'\n      || typeof value === 'boolean'\n      || typeof value === 'string'\n      || value == null\n      || typeof value === 'function'\n      || typeof value._dup === 'function'\n      || Array.isArray(value)\n    ) {\n      // Only assign the value if:\n      //    * Value is not undefined OR\n      //    * Value is undefined and toObject[key] is undefined\n      if (value !== undefined || toObject[key] === undefined) {\n        if (duplicateValues) {     // eslint-disable-next-line no-param-reassign\n          toObject[key] = duplicate(value);\n        } else {                   // eslint-disable-next-line no-param-reassign\n          toObject[key] = value;\n        }\n      }\n    } else {\n      // If the fromObject[key] value is an object, but the toObject[key] value\n      // is not an object, but then make toObject[key] an empty object\n      const toValue = toObject[key];\n      if (typeof toValue === 'number'\n        || typeof toValue === 'boolean'\n        || typeof toValue === 'string'\n        || toValue == null\n        || typeof toValue === 'function'\n        || Array.isArray(toValue)\n      ) {\n        // eslint-disable-next-line no-param-reassign\n        toObject[key] = {};\n      }\n      assignObjectFromTo(value, toObject[key], except, duplicateValues, keyPath);\n    }\n  });\n}\n\nfunction joinObjectsWithOptions(options: {\n  duplicate?: boolean,\n  except?: Array<string> | string,\n}, ...objects: Array<Object>): Object {\n  let { except } = options;\n  let dup = options.duplicate;\n  if (except == null) {\n    except = [];\n  }\n  if (dup == null) {\n    dup = false;\n  }\n\n  const num = objects.length;\n  const out = objects[0];\n  for (let i = 1; i < num; i += 1) {\n    const o = objects[i];\n    if (o != null) {\n      assignObjectFromTo(o, out, except, dup, '');\n    }\n  }\n  return out;\n}\n\n// joins objects like object.assign but goes as many levels deep as the object\n// is. Objects later in the arrawy overwrite objects earlier.\nfunction joinObjects(...objects: Array<Object>): Object {\n  return joinObjectsWithOptions({}, ...objects);\n}\n\nfunction duplicateFromTo(\n  fromObject: Object,\n  toObject: Object,\n  exceptKeys: Array<string> = [],\n) {\n  joinObjectsWithOptions({ except: exceptKeys, duplicate: true }, toObject, fromObject);\n}\n\nfunction generateUniqueId(seed: string = '') {\n  const randomString = s => `${s}${Math.floor(Math.random() * 1000000)}`;\n  let seedToUse = seed;\n  if (seedToUse.length === 0) {\n    seedToUse = 'id_random_';\n  }\n  let idExists = true;\n  let newId = randomString(seedToUse);\n  while (idExists) {\n    newId = randomString(seedToUse);\n    const element = document.getElementById(newId);\n    if (element == null) {\n      idExists = false;\n    }\n  }\n  return newId;\n}\n\nfunction isTouchDevice() {\n  const prefixes = ' -webkit- -moz- -o- -ms- '.split(' ');\n  const mq = query => window.matchMedia(query).matches;\n\n  /* eslint-disable no-undef, no-mixed-operators */\n  // $FlowFixMe\n  if (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\n    return true;\n  }\n  /* eslint-enable no-undef, no-mixed-operators */\n\n  // include the 'heartz' as a way to have a non matching MQ to help terminate the join\n  // https://git.io/vznFH\n  const query = ['(', prefixes.join('touch-enabled),('), 'heartz', ')'].join('');\n  return mq(query);\n}\n\nfunction loadRemote(\n  scriptId: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(scriptId);\n  if (!existingScript) {\n    const script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = url;\n    script.id = scriptId; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(script);\n    }\n    script.onload = () => {\n      if (callback != null) {\n        callback(scriptId, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(scriptId, url);\n  }\n}\n\nfunction loadRemoteCSS(\n  id: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(id);\n  if (!existingScript) {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    link.href = url;\n    link.id = id; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(link);\n    }\n    link.onload = () => {\n      if (callback != null) {\n        callback(id, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(id, url);\n  }\n}\n\n// function remoteLoadToObject(\n//   scriptId: string,\n//   url: string,\n//   toObject: {},\n//   callback: null | (string, string) => void = null,\n// ) {\n//   loadRemote(scriptId, url, callback);\n\n// }\n\nconst cleanUIDs = (objectToClean: Object) => {\n  const genericUID = '0000000000';\n  if (objectToClean == null) {\n    return;\n  }\n  if ('uid' in objectToClean) {\n    if (objectToClean.uid === genericUID) {\n      return;\n    }\n    // eslint-disable-next-line no-param-reassign\n    objectToClean.uid = genericUID;\n  }\n  const keys = Object.keys(objectToClean);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    const value = objectToClean[key];\n    if (\n      typeof value === 'object'\n      && !Array.isArray(value)\n      && value != null\n      && typeof value !== 'function'\n      && typeof value !== 'number'\n      && typeof value !== 'boolean'\n      && typeof value !== 'string'\n    ) {\n      cleanUIDs(value);\n    }\n  }\n};\n\nfunction deleteKeys(obj: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (obj[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      delete obj[key];\n    }\n  });\n}\n\nfunction copyKeysFromTo(source: Object, destination: Object, keys: Array<string>) {\n  keys.forEach((key) => {\n    if (source[key] !== undefined) {\n      // eslint-disable-next-line no-param-reassign\n      destination[key] = source[key];\n    }\n  });\n}\n\nfunction generateRandomString() {\n  return (Math.random() * 1e18).toString(36);\n}\n\nclass UniqueMap {\n  map: Object;\n  index: number;\n  letters: string;\n\n  constructor() {\n    this.map = {};\n    this.index = 1;\n    this.inverseMap = {};\n    this.letters = '0abcdefghijklmnopqrstuvwxz';\n    this.undefinedCode = '.a';\n  }\n\n  reset() {\n    this.index = 1;\n    this.map = {};\n  }\n\n  add(pathStr: string) {\n    if (this.map[pathStr] != null) {\n      return this.map[pathStr];\n    }\n    const unique = this.getNextUniqueString();\n    this.map[pathStr] = unique;\n    return unique;\n  }\n\n  getNextUniqueString() {\n    if (this.index === 0) {\n      return 'a';\n    }\n    const order = Math.floor(Math.log(this.index) / Math.log(this.letters.length));\n    let remainder = this.index;\n    let out = '';\n    for (let i = order; i >= 0; i -= 1) {\n      const factor = Math.floor(remainder / this.letters.length ** i);\n      remainder -= factor * this.letters.length ** i;\n      out = `${out}${this.letters[factor]}`;\n    }\n    this.index += 1;\n    return out;\n  }\n\n  makeInverseMap() {\n    this.inverseMap = {};\n    Object.keys(this.map).forEach((key) => {\n      const uniqueStr = this.map[key];\n      this.inverseMap[uniqueStr] = key;\n    });\n  }\n\n  get(uniqueStr: string) {\n    if (uniqueStr === this.undefinedCode) {\n      return undefined;\n    }\n    if (this.inverseMap[uniqueStr] != null) {\n      return this.inverseMap[uniqueStr];\n    }\n    return uniqueStr;\n  }\n}\n\nfunction compressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n  precision: ?number = null,\n  uncompress: boolean = false,\n) {\n  if (typeof obj === 'string') {\n    // if (obj === 'do') {\n    //   console.log(obj, strValues, uncompress, map.get(obj))\n    // }\n    if (strValues && uncompress) {\n      return map.get(obj);\n    }\n    if (strValues) {\n      return map.add(obj);\n    }\n    return obj;\n  }\n  if (typeof obj === 'number') {\n    if (precision === null || uncompress) {\n      return obj;\n    }\n    return roundNum(obj, precision);\n  }\n  if (\n    typeof obj === 'boolean'\n    || typeof obj === 'function'\n    || obj === null\n  ) {\n    return obj;\n  }\n\n  if (obj === undefined) {\n    return map.undefinedCode;\n  }\n\n  if (Array.isArray(obj)) {\n    for (let i = 0; i < obj.length; i += 1) {\n      obj[i] = compressObject(obj[i], map, keys, strValues, precision, uncompress);\n    }\n    return obj;\n  }\n\n  if (typeof obj === 'object') {\n    const objKeys = Object.keys(obj);\n    const obj2 = {};\n    for (let i = 0; i < objKeys.length; i += 1) {\n      const k = objKeys[i];\n      obj[k] = compressObject(obj[k], map, keys, strValues, precision, uncompress);\n      if (keys && uncompress) {\n        obj2[map.get(k)] = obj[k];\n      } else if (keys) {\n        obj2[map.add(k)] = obj[k];\n      } else {\n        obj2[k] = obj[k];\n      }\n    }\n    if (keys) {\n      return obj2;\n    }\n    return obj2;\n  }\n  return obj;\n}\n\nfunction uncompressObject(\n  obj: any,\n  map: UniqueMap,\n  keys: boolean = true,\n  strValues: boolean = true,\n) {\n  return compressObject(obj, map, keys, strValues, null, true);\n}\n\nfunction minify(objectOrArray: any, precision: ?number = 4) {\n  const map = new UniqueMap();\n  return {\n    minified: compressObject(objectOrArray, map, true, true, precision),\n    map,\n  };\n}\n\nfunction unminify(minObjectOrArray: {\n  map: Object | UniqueMap,\n  minified: Object,\n}) {\n  let { map } = minObjectOrArray;\n  if (!(map instanceof UniqueMap)) {\n    const uMap = new UniqueMap();\n    uMap.map = map.map;\n    uMap.index = map.index;\n    uMap.letters = map.letters;\n    map = uMap;\n  }\n  map.makeInverseMap();\n  return uncompressObject(minObjectOrArray.minified, map, true, true);\n}\n\nfunction objectToPaths(obj: any, path: string = '', pathObj = {}, precision: ?number = null) {\n  if (\n    typeof obj === 'string'\n    // || typeof obj === 'number'\n    || typeof obj === 'boolean'\n    || typeof obj === 'function'\n  ) {\n    pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (typeof obj === 'number') {\n    if (precision != null) {\n      pathObj[`${path}`] = roundNum(obj, precision); // eslint-disable-line no-param-reassign\n    } else {\n      pathObj[`${path}`] = obj; // eslint-disable-line no-param-reassign\n    }\n    return pathObj;\n  }\n  if (obj === null) {\n    pathObj[`${path}`] = null; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (obj === undefined) {\n    // pathObj[`${path}`] = undefined; // eslint-disable-line no-param-reassign\n    return pathObj;\n  }\n  if (Array.isArray(obj)) {\n    obj.forEach((o, index) => {\n      objectToPaths(o, `${path}[${index}]`, pathObj, precision);\n    });\n    return pathObj;\n  }\n  Object.keys(obj).forEach((key) => {\n    objectToPaths(obj[key], `${path}.${key}`, pathObj, precision);\n  });\n  return pathObj;\n}\n\nfunction getObjectDiff(\n  obj1In: Object,\n  diffs: Array<Object>,\n  obj2: Object,\n  precision: ?number = null,\n  debug: boolean = false,\n) {\n  // const pathMap = {};\n  let obj1 = obj1In;\n  if (diffs.length > 0) { // eslint-disable-next-line no-use-before-define\n    obj1 = refAndDiffToObject(obj1In, ...diffs);\n  }\n  const paths1 = objectToPaths(obj1, '', {}, precision);\n  const paths2 = objectToPaths(obj2, '', {}, precision);\n  const added = {};\n  const diff = {};\n  const removed = {};\n  Object.keys(paths1).forEach((key1) => {\n    if (paths2[key1] === undefined) {\n      removed[key1] = paths1[key1];\n      return;\n    }\n    if (paths1[key1] !== paths2[key1]) {\n      if (debug) {\n        diff[key1] = [paths1[key1], paths2[key1]];\n      } else {\n        diff[key1] = paths2[key1];\n      }\n    }\n  });\n  Object.keys(paths2).forEach((key2) => {\n    if (paths1[key2] === undefined) {\n      added[key2] = paths2[key2];\n    }\n  });\n  const out = {};\n  if (Object.keys(diff).length > 0) {\n    out.diff = diff;\n  }\n  if (Object.keys(added).length > 0) {\n    out.added = added;\n  }\n  if (Object.keys(removed).length > 0) {\n    out.removed = removed;\n  }\n  return out;\n}\n\nfunction updateObjFromPath(\n  remainingPath: Array<string>,\n  obj: Object,\n  value: any,\n  remove: boolean = false,\n) {\n  // console.log(remainingPath)\n  const fullP = remainingPath[0];\n  if (fullP.length === 0) {\n    return;\n  } \n  const arrayStringIndeces = fullP.match(/\\[[^\\]]*\\]/g);\n  const p = fullP.replace(/\\[.*/, '');\n  if (remainingPath.length === 1 && remove && !arrayStringIndeces) {\n    delete obj[p];\n    return;\n  }\n  if (arrayStringIndeces) {\n    const arrayIndeces = arrayStringIndeces.map(e => parseInt(e.replace(/\\[|\\]/g, ''), 10));\n    // console.log(arrayIndeces)\n    // return;\n    if (obj[p] == null || !Array.isArray(obj[p])) {\n      obj[p] = [];\n    }\n    // console.log(obj)\n    // return\n    let currentArray = obj[p];\n    let index = 0;\n    for (let i = 0; i < arrayIndeces.length; i += 1) {\n      index = arrayIndeces[i];\n      if (currentArray.length <= index) {\n        for (let j = currentArray.length; j < index - currentArray.length + 1; j += 1) {\n          currentArray.push(undefined);\n        }\n      }\n      if (i < arrayIndeces.length - 1) {\n        // currentArray[index] = currentArray[index][i];\n        if (!Array.isArray(currentArray[index])) {\n          currentArray[index] = [];\n        }\n        currentArray = currentArray[index];\n      }\n    }\n    if (remainingPath.length === 1 && remove) {\n      currentArray[index] = undefined;\n      return;\n    }\n    if (remainingPath.length === 1) {\n      currentArray[index] = value;\n      return;\n    }\n    if (currentArray[index] == null || typeof currentArray[index] !== 'object') {\n      currentArray[index] = {};\n    }\n    updateObjFromPath(remainingPath.slice(1), currentArray[index], value, remove);\n    return;\n  }\n\n  // if (remainingPath.length === 1 && remove) {\n  //   console.log('asdf')\n  //   obj[p] = undefined;\n  // }\n  if (remainingPath.length === 1) {\n    obj[p] = value;\n    return;\n  }\n  if (obj[p] == null) {\n    obj[p] = {};\n  }\n  updateObjFromPath(remainingPath.slice(1), obj[p], value, remove);\n}\n\nfunction pathsToObj(paths: Object) {\n  const obj = {};\n  Object.keys(paths).forEach((key) => {\n    const path = key.split('.').filter(p => p.length > 0);\n    const value = paths[key];\n    if (Array.isArray(value)) {\n      updateObjFromPath(path, obj, value.slice(-1)[0]);\n    } else {\n      updateObjFromPath(path, obj, value);\n    }\n  });\n  return obj;\n}\n\nfunction refAndDiffToObject(\n  referenceIn: Object,\n  ...diffsIn: Array<{\n    added: Object,\n    diff: Object,\n    removed: Object,\n  }>\n) {\n  const ref = duplicate(referenceIn);\n  const processPaths = (paths: Object, remove: boolean = false) => {\n    // console.log(paths)\n    Object.keys(paths).forEach((pathStr) => {\n      // console.log(pathStr)\n      const path = pathStr.split('.').filter(p => p.length > 0);\n      const value = paths[pathStr];\n      if (Array.isArray(value)) {\n        updateObjFromPath(path, ref, value.slice(-1)[0], remove);\n      } else {\n        updateObjFromPath(path, ref, value, remove);\n      }\n    });\n  };\n  // console.log(diffsIn)\n  diffsIn.forEach((diffIn) => {\n    // console.log(diffIn)\n    const { added, removed, diff } = diffIn;\n    // console.log(1, removed)\n    if (removed != null) {\n      processPaths(removed, true);\n    }\n    // console.log(2)\n    if (added != null) {\n      processPaths(added);\n    }\n    // console.log(3)\n    if (diff != null) {\n      processPaths(diff);\n    }\n  });\n  return ref;\n}\n\nfunction diffPathsToObj(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = pathsToObj(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = pathsToObj(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = pathsToObj(diff.removed);\n  }\n  return out;\n}\n\nfunction diffObjToPaths(diff: { added: Object, removed: Object, diff: Object }) {\n  const out = {};\n  if (diff.diff && Object.keys(diff.diff).length > 0) {\n    out.diff = objectToPaths(diff.diff);\n  }\n  if (diff.added && Object.keys(diff.added).length > 0) {\n    out.added = objectToPaths(diff.added);\n  }\n  if (diff.removed && Object.keys(diff.removed).length > 0) {\n    out.removed = objectToPaths(diff.removed);\n  }\n  return out;\n}\n\n// Class that can track an object's differences over time\nclass ObjectTracker {\n  baseReference: ?Object;\n  references: {\n    [refName: string]: {\n      basedOn: string,\n      diff: Object,\n    },\n  };\n\n  precision: number;\n\n  //             time   refName  diff\n  diffs: Array<[number, string, Object, number]>\n\n  lastReferenceName: string;\n\n  constructor(precision: number = 8) {\n    this.precision = precision;\n    this.reset();\n  }\n\n  toObj() {\n    const references = {};\n    Object.keys(this.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: this.references[refName].basedOn,\n        diff: diffPathsToObj(this.references[refName].diff),\n      };\n    });\n    const diffs = this.diffs.map(d => [d[0], d[1], diffPathsToObj(d[2]), d[3]]);\n    return {\n      baseReference: duplicate(this.baseReference),\n      diffs,\n      references,\n      precision: this.precision,\n      lastReferenceName: this.lastReferenceName,\n    };\n  }\n\n  setFromObj(obj: Object) {\n    const references = {};\n    Object.keys(obj.references).forEach((refName) => {\n      references[refName] = {\n        basedOn: obj.references[refName].basedOn,\n        diff: diffObjToPaths(obj.references[refName].diff),\n      };\n    });\n    this.references = references;\n    this.baseReference = duplicate(obj.baseReference);\n    this.precision = obj.precision;\n    this.diffs = obj.diffs.map(d => [d[0], d[1], diffObjToPaths(d[2]), d[3]]);\n    this.lastReferenceName = obj.lastReferenceName;\n  }\n\n  reset() {\n    this.baseReference = null;\n    this.references = {};\n    this.diffs = [];\n    this.lastReferenceName = '__base';\n  }\n\n  setBaseReference(obj: Object) {\n    this.baseReference = duplicate(obj);\n    this.lastReferenceName = '__base';\n  }\n\n  addReference(\n    obj: Object,\n    refName: string,\n    basedOn: string = '__base',\n  ) {\n    if (this.baseReference == null || refName === '__base') {\n      this.setBaseReference(obj);\n    }\n    if (refName !== '__base') {\n      this.references[refName] = {\n        diff: this.getDiffToReference(obj, basedOn),\n        basedOn,\n      };\n      this.lastReferenceName = refName;\n    }\n  }\n\n  getReferenceChain(name: string, chain: Array<Object>) {\n    if (name === '__base') {\n      return chain;\n    }\n    if (this.references[name] == null) {\n      return chain;\n    }\n    return this.getReferenceChain(\n      this.references[name].basedOn, [this.references[name].diff, ...chain],\n    );\n  }\n\n  getReference(refName: string) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    return refAndDiffToObject(this.baseReference, ...referenceChain);\n  }\n\n  getDiffToReference(\n    obj: Object,\n    refName: string,\n  ) {\n    const s1 = performance.now()\n    const referenceChain = this.getReferenceChain(refName, []);\n    // console.log('ref Chain', performance.now() - s1);\n    const s2 = performance.now()\n    const diff = getObjectDiff(this.baseReference, referenceChain, obj, this.precision);\n    // console.log('s2', performance.now() - s2);\n    return diff;\n  }\n\n  getObjFromDiffAndReference(\n    diff: Object,\n    refName: string,\n  ) {\n    const referenceChain = this.getReferenceChain(refName, []);\n    const diffs = [...referenceChain, diff];\n    return refAndDiffToObject(this.baseReference, ...diffs);\n  }\n\n  add(time: number, obj: Object, refName: string = this.lastReferenceName, timeCount: number = 0) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    const diff = this.getDiffToReference(obj, refName);\n    this.diffs.push([time, refName, diff, timeCount]);\n  }\n\n  addWithWorker(time: number, obj: Object, refName: string = this.lastReferenceName, timeCount: number = 0) {\n    if (this.baseReference == null) {\n      this.setBaseReference(obj);\n    }\n    this.startWorker();\n    if (this.worker != null) {\n      this.worker.postMessage([time, refName, obj, timeCount]);\n    }\n  }\n\n  startWorker() {\n    if (this.worker != null) {\n      return;\n    }\n    this.worker = new Worker();\n\n    this.worker.addEventListener(\"message\", function (event) {\n      console.log(event.data)\n    });\n  }\n\n  getFromIndex(index: number) {\n    if (index > this.diffs.length) {\n      return null;\n    }\n    const [, basedOn, diff] = this.diffs[index];\n    return this.getObjFromDiffAndReference(diff, basedOn);\n  }\n}\n\nfunction download(filename: string, text: string) {\n  const element = document.createElement('a');\n  element.setAttribute(\n    'href',\n    `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`,\n  );\n  element.setAttribute('download', filename);\n  element.style.display = 'none';\n  const { body } = document;\n  if (body != null) {\n    body.appendChild(element);\n    element.click();\n    body.removeChild(element);\n  }\n}\n\nexport {\n  diffPathsToObj, diffObjToPaths,\n  Console,\n  classify, extractFrom, ObjectKeyPointer, getElement,\n  addToObject, duplicateFromTo, isTouchDevice,\n  generateUniqueId, joinObjects, cleanUIDs, loadRemote, loadRemoteCSS,\n  deleteKeys, copyKeysFromTo, generateRandomString,\n  duplicate, assignObjectFromTo, joinObjectsWithOptions,\n  objectToPaths, getObjectDiff, updateObjFromPath, pathsToObj,\n  UniqueMap, compressObject, refAndDiffToObject, uncompressObject,\n  unminify, minify, ObjectTracker,\n  download,\n};\n\n"],"sourceRoot":""}