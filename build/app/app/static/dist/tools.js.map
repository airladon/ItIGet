{"version":3,"sources":["webpack:///./src/js/Lesson/LinksLesson.js","webpack:///./src/js/Lesson/PresentationLesson.js","webpack:///./src/js/Lesson/PresentationLessonContent.js","webpack:///./src/js/Lesson/SimpleLesson.js","webpack:///./src/js/Lesson/SimpleLessonContent.js","webpack:///./src/js/Lesson/lessonDescription.js","webpack:///./src/js/Lesson/lessonTree.js","webpack:///./src/js/components/button.js","webpack:///./src/js/components/dropDownButton.js","webpack:///./src/js/components/dropDownButtonBase.js","webpack:///./src/js/components/footer.js","webpack:///./src/js/components/lesson.js","webpack:///./src/js/components/lessonNavigator.js","webpack:///./src/js/components/lessonTile.js","webpack:///./src/js/components/lessonTitle.js","webpack:///./src/js/components/linksLesson.js","webpack:///./src/js/components/linksTable.js","webpack:///./src/js/components/navbar.js","webpack:///./src/js/components/navbarSpacer.js","webpack:///./src/js/components/presentationLesson.js","webpack:///./src/js/components/presentationQR.js","webpack:///./src/js/components/quickReferencePopup.js","webpack:///./src/js/components/rating.js","webpack:///./src/js/components/simpleLesson.js","webpack:///./src/js/components/singlePageLesson.js","webpack:///./src/js/components/star.js","webpack:///./src/js/components/staticQR.js","webpack:///./src/js/components/topicButton.js","webpack:///./src/js/components/view.js","webpack:///./src/js/components/viewLesson.js","webpack:///./src/js/tools/misc.js"],"names":["LinksLesson","content","type","SimpleLesson","Diagram","Fig","hideInfoButton","infoButton","document","getElementById","HTMLElement","classList","add","hideInteractiveHighlightButton","interactiveHighlightButton","PresentationLesson","diagram","currentSectionIndex","firstPageShown","state","inTransition","window","presentationLessonTransitionStatus","refresh","comingFrom","transitionCancelled","goToSectionIndex","htmlText","section","sections","getContent","length","stopTransition","stopDiagrams","currentSection","blankTransition","toNext","toggleInfo","transitionStart","transitionToNext","finishTransToNextOrPrev","bind","renderDiagrams","skipWhenComingFromNext","transitionToPrev","sectionId","sectionIndex","forEach","index","title","toGoto","transitionToAny","finishTransToAny","direction","goingTo","flag","setLeaveStateAndMoveToNextSection","possibleState","setLeaveState","undefined","setBlanks","contentHTML","getContentHtml","fromPrev","fromNext","fromGoto","setState","fadeInFromPrev","lastSection","thisContent","lastContent","element","setEnterState","currentInteractiveItem","setVisible","finishTransitionFromAny","transitionFromNext","finishTransFromNextOrPrev","fadeInTextFromPrev","transitionFromPrev","transitionFromAny","componentUpdateComplete","setOnClicks","setOnclicks","setSteadyState","setInfoButton","updateInteractiveItems","setInteractiveElements","setInteractiveElementsButton","stop","interactiveItem","getNextInteractiveItem","location","highlightInteractiveElement","animateNextFrame","destroy","closeDiagram","lesson","button","HTMLObject","Point","DiagramElementPrimative","DiagramElementCollection","DiagramElement","Rect","Equation","parsePoint","EqnNavigator","tools","misc","generateUniqueId","joinObjects","html","applyModifiers","click","initializeItemSelector","methodToExecute","bindingObject","elem","children","i","onclick","infoList","listItems","out","item","push","join","diagramCanvas","id","DiagramClass","classes","replacementText","Section","modifiers","infoModifiers","showOnly","blank","infoElements","toPrev","interactiveElementList","info","setInfo","Array","isArray","contentInBullets","line","startsWith","infoElement","infoHtml","getInfo","infoBox","remove","innerHTML","counter","elementIsVisible","rect","getBoundingClientRect","left","width","drawingObject","isShown","isMovable","isTouchable","isInteractive","elementIsTouchable","hasTouchableElements","contains","modify","setContent","contentInParagraphs","charAt","previousState","getInteractiveElementIndex","splice","replaced","replaceInteractiveElement","interactiveElementsOnly","replaceOrAddInteractiveElement","elements","getElementsByClassName","style","getComputedStyle","visibility","display","diagramElements","getAllPossiblyInteractiveElements","interactiveElements","interactiveElementsRemove","removeInteractiveElement","elementsOrMethod","hideOnly","show","showAll","hide","hideAll","done","temp","whichAnimationEvent","el","createElement","transitions","animation","OAnimation","MozAnimation","WebkitAnimation","Object","keys","key","PresentationLessonContent","htmlId","diagramHtmlId","animationEnd","quickReference","setDiagram","next","nextSection","prev","setElementContent","addSections","addInfoBox","addStar","setFirstTransform","toState","toggle","overlay","zIndex","gotoButton","interactive","container","appendChild","infoSymbol","close","titleText","text","htmlCanvas","star","removeEventListener","w","offsetWidth","cssPosition","diagramPosition","interactiveLocation","getCenterDiagramPosition","getDiagramPosition","getDiagramBoundingRect","top","right","borders","getVertexSpaceBoundaries","minXPoint","border","borderPoint","_dup","x","y","getVertexSpaceDiagramPosition","p","bottom","height","transformBy","spaceTransforms","diagramToPixel","matrix","fontSize","parseFloat","getPropertyValue","rectBase","addEventListener","color","layout","colors","action","link","colorOrOptions","defaultOptions","options","lessonFunctions","qr","img","setAttribute","alt","s","sectionObjects","assign","optionsIn","animate","duration","userSections","eqn","nav","table","fromForm","from","toForm","to","eqnSection","callback","showForm","goToForm","name","updateButtons","addSection","equations","defaultEqnOptions","dissolveInTime","dissolveOutTime","pulseDuration","pulseScale","opacity","countUp","eqOptions","form","moveFrom","t","setOpacity","o","setFinalForm","f","moveFromPosition","pulseMoveFrom","dullLastEqn","getPosition","pulseScaleNow","animations","position","target","trigger","pulse","scale","start","whenFinished","SimpleLessonContent","makeFig","borderDebug","leftMargin","topMargin","elementsToUse","tieToHTML","initialize","iconLink","iconLinkGrey","setTitle","path","fetchPolyfill","credentials","then","response","ok","Error","statusText","json","data","status","jsFile","js","cssFile","css","loadRemoteCSS","loadRemote","qrs","splitQR","replace","split","versionUID","slice","lessonUID","loadQR","qrPath","qrid","qrDiagram","limits","updateFontSize","prepareToShowQR","collection","resize","clearContext","setElementsToCollection","prepareToHideAll","prepareToHideQR","LessonDescription","uid","dependencies","imgLink","imgLinkSelected","imgLinkDisabled","topics","enabled","callbackCount","numVersions","topicName","topic","version","waitThenCallback","aveRating","numRatings","numHighRatings","userRating","splitIndexIntoLearningPaths","lessonIndex","pathDepth","learningPaths","fullPath","lessons","makeLessonTree","getLessonIndex","lessonLearningPaths","lessonTrees","learningPath","lessonTree","remainingUIDs","existingUIDs","allUIDs","max","lessonTreeNode","newExisting","canAddToExisting","dependency","indexOf","tree","Button","props","Tag","href","label","className","classify","React","DropDownButton","list","listElement","active","xAlign","selected","DropDownButtonBase","event","parent","parentElement","labelElement","itemList","buttonElement","listRect","windowWidth","innerWidth","documentElement","clientWidth","delta","body","offButtonEvent","keyCode","arrowDirectionClass","buttonClasses","listContent","listItem","separator","linkRedirect","closeThenRedirect","keyboardCloseThenRedirect","Footer","getLessonDescription","LessonComponent","pathname","lessonDescription","ratings","fillRatings","showNavigator","getRating","getRatings","gotRatings","rating","cookie","username","match","page","parseInt","getCookie","count","fullLesson","numReviews","description","output","getTopics","topicNames","fullLessonCount","filter","ver","partialLessonCount","vUIDs","sort","aKey","bKey","a","b","labelA","toUpperCase","labelB","vUID","singleItemClass","isLoggedIn","login","calcTitleHeight","addTopics","setUserRating","ratingLabel","renderLesson","lessonNavigator","getDefinedCSSVariables","LessonNavigator","learningPathPath","learningPathName","getVariables","layoutLessonTiles","asTitle","vars","tileWidth","tileHeight","tileVSpace","tileHSpace","lessonArray","vSpace","hSpace","maxParallel","yMiddle","len","totalHeight","yStart","parallelLesson","yLocation","getLessonTilesBounds","selectedLesson","linkToUse","topicsOrder","versionsOrder","getVersion","versions","createLessonJsx","centerLessons","scrollToSelected","navScroll","navigatorContainer","navRect","xMargin","Math","min","yMargin","lessonTilesBounds","scrollLeft","scrollTop","clientHeight","lessonsContainer","navHeight","xMax","yMax","yMin","xMin","firstElement","classStr","LessonTile","isTitle","classText","LessonTitle","LinksLessonComponent","links","renderSections","LinksTable","url","hash","author","publisher","userRatingIsHigh","hasDescription","getLinkRatings","gotLinkRatings","numLinks","endpoint","updateState","userRatingValue","r","typeClass","yourRatingTitle","useColon","colon","renderLinks","Navbar","logout","getLoginLabel","loginout","includeHome","renderHomeButton","getLoginButton","NavbarSpacer","PresentationLessonComponent","firstPage","numPages","listOfSections","presQR","refreshText","componentUpdateCallback","centerLessonFlag","updateHTMLElementTie","updateGoToButtonListHighlight","createCookie","nextButton","prevButton","prevSection","docElem","setProperty","elementId","containerRect","doc","diagramHTML","diagramFontSize","bodyFontSize","parameters","setCSSVariables","staticQR","showQR","showStaticQR","showPresQR","addListOfSections","goToSection","goToNext","goToPrevious","centerLessonPosition","setTimeout","scroll","pageYOffset","windowHeight","centerLesson","__html","highlightNextInteractiveItem","activeItems","call","activeSection","belongsTo","titleIndeces","map","listIndex","isActive","clickList","addPrevButton","renderContent","addGoToButton","addNextButton","addInfoButton","addInteractiveElementButton","PresentationQR","onClose","QuickReferencePopup","closeId","origin","Rating","stars","ratingCallback","align","containerId","linkId","linkRect","linkLeft","newRect","proposedLeft","overFlow","innerheight","linkTop","proposedTop","SimpleLessonComponent","afterUpdate","applyMDModifiers","inputText","outputText","trim","SinglePageLessonComponent","contentChange","enableScrolling","d","renderAllElementsToTiedCanvases","loadingElements","getLoadingElements","onLoad","unrender","Star","num","isFull","keydown","setRating","StaticQR","TopicButton","toLocaleString","renderTitle","renderListLabel","withLoginManager","loginManager","WrappedComponent","handleVisibilityChange","checkIsLoggedInFromCookie","setLogin","ViewLesson","value","nonEmpty","withKey","joinStr","scriptId","existingScript","script","src","onload","rel","re","RegExp","keyValue","minutes","expires","date","Date","setTime","getTime","toUTCString","logInOut","logText","activator","inputOptions","points","method","mods","touchInBoundingRect","attachQuickReference","lessonPath"],"mappings":"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","file":"tools.js","sourcesContent":["// @flow\nimport SimpleLesson from './SimpleLesson';\n// import Fig from 'figureone';\n// import SimpleLessonContent from './SimpleLessonContent';\n// import { PresentationLessonContent } from './PresentationLessonContent';\n// import Diagram from '../diagram/Diagram';\n\n// const { Diagram } = Fig;\n\nclass LinksLesson extends SimpleLesson {\n  constructor(content: Object) {\n    super(content);\n    this.type = 'links';\n  }\n}\n\nexport default LinksLesson;\n","// @flow\nimport Fig from 'figureone';\nimport { PresentationLessonContent } from './PresentationLessonContent';\nimport SimpleLesson from './SimpleLesson';\n// import Diagram from '../diagram/Diagram';\n\nconst { Diagram } = Fig;\n\nfunction hideInfoButton() {\n  const infoButton = document.getElementById('id_lesson__info_button');\n  if (infoButton instanceof HTMLElement) {\n    infoButton.classList.add('lesson__info_hide');\n  }\n}\n\nfunction hideInteractiveHighlightButton() {\n  const interactiveHighlightButton = document\n    .getElementById('id_lesson__interactive_element_button');\n  if (interactiveHighlightButton instanceof HTMLElement) {\n    interactiveHighlightButton.classList.add('lesson__interactive_element_button__hide');\n  }\n}\n\n// Flow:\n//\n//  Coming from any section\n//    - setEnterState               Guaranteed\n//    - showOnly                    Guaranteed\n//    - hideOnly                    Guaranteed\n//    - show                        Guaranteed\n//    - hide                        Guaranteed\n//    - transitionFromPrev/Next     Can be cancelled\n//    - transitionFromAny           Can be cancelled / skipped\n//    - setPlannedPositions?        Can be cancelled / skipped\n//    - setSteadyState              Can be skipped\n//\n//  Go to next, prev or goTo\n//    - transitionToPrev/Next       Can be cancelled / skipped\n//    - transitionToAny             Can be cancelled / skipped\n//    - saveState                   Guaranteed\n//    - setLeaveState               Guaranteed\n\n\n// Flow of when a page is first loaded\n// Rect Component finishes mounting\n//    gotoSection\n//    transitionToAny\n//    finishTransitionToAny\n//    setLeaveStateAndMoveToNextSection\n//    setLeaveState\n//    refresh -> lesson.refreshText called with setState callback\n//               callback is then called on lesson.component update complete\n//\n//  When lesson.component is finished updating\n//    setState\n//       setEnterState\n//    transitionFromAny\n//    finishTransitionFromAny\n//    refresh -> lesson.refreshText called with componentUpdateComplete\n//\n//  When lesson.component is finished updating\n//    componentUpdateComplete\n//      setOnclicks\n//      setSteadyState\n//      setInfoButton\n//      setInteractiveElements\n//\n//  Then ratings will be received asynchronously causing another react\n//  component state update, meaning the onclicks need to be set again.\n\nclass PresentationLesson extends SimpleLesson {\n  content: PresentationLessonContent;\n\n  currentSectionIndex: number;\n  diagram: Diagram | null;\n  // overlayDiagram: Diagram | null;\n  state: Object;\n  inTransition: boolean;\n  transitionCancelled: boolean;\n  comingFrom: 'next' | 'prev' | 'goto' | '' ;\n  goingTo: 'next' | 'prev' | 'goto' | '' ;\n  refresh: (string, number, ?() => void) => void;\n  goToSectionIndex: number;\n  firstPageShown: boolean;\n  // type: string;\n\n  constructor(content: Object) {\n    super(content);\n    // this.content = content;\n    this.diagram = null;\n    // this.overlayDiagram = null;\n    this.currentSectionIndex = 0;\n    this.firstPageShown = true;\n    this.state = {};\n    this.inTransition = false;\n    window.presentationLessonTransitionStatus = 'noSteady';\n    this.refresh = function () {}; // eslint-disable-line func-names\n    this.comingFrom = '';\n    this.transitionCancelled = false;\n    this.goToSectionIndex = 0;\n    this.type = 'presentation';\n  }\n\n  getContentHtml(): string {\n    let htmlText = '';\n    const section = this.content.sections[this.currentSectionIndex];\n    htmlText = section.getContent();\n    return htmlText;\n  }\n\n  nextSection() {\n    const { diagram } = this;\n    window.presentationLessonTransitionStatus = 'notSteady';\n    if (this.currentSectionIndex < this.content.sections.length - 1 && diagram) {\n      // If in transition, then cancel the transition.\n      if (this.inTransition) {\n        const { firstPageShown } = this;\n        const { comingFrom } = this;\n        this.stopTransition();\n        if (comingFrom === 'prev' || firstPageShown) {\n          return;\n        }\n      } else {\n        // Stop diagrams if not in transition to stop any animations.\n        this.stopDiagrams();\n      }\n      this.firstPageShown = false;\n      if (this.currentSection().blankTransition.toNext) {\n        this.refresh('', this.currentSectionIndex);\n      }\n      this.content.toggleInfo(false);\n      // this.currentSection().goingTo = 'next';\n      // this.sections.[this.currentSectionIndex + 1].comingFrom = 'prev';\n      this.transitionStart('prev');\n      this.goToSectionIndex = this.currentSectionIndex + 1;\n      this.currentSection().transitionToNext(this.finishTransToNextOrPrev.bind(this));\n    }\n    this.renderDiagrams();\n  }\n\n  prevSection() {\n    const { diagram } = this;\n    window.presentationLessonTransitionStatus = 'notSteady';\n    if (this.currentSectionIndex > 0 && diagram) {\n      if (this.inTransition) {\n        const { comingFrom } = this;\n        const { firstPageShown } = this;\n        this.stopTransition();\n        if (comingFrom === 'next' || firstPageShown) {\n          return;\n        }\n      } else {\n        this.stopDiagrams();\n      }\n      this.firstPageShown = false;\n      if (this.currentSection().blankTransition.toNext) {\n        this.refresh('', this.currentSectionIndex);\n      }\n      // this.currentSection().goingTo = 'prev';\n      // this.sections.[this.currentSectionIndex + 1].comingFrom = 'next';\n      this.content.toggleInfo(false);\n      this.transitionStart('next');\n      this.goToSectionIndex = this.currentSectionIndex - 1;\n      if (this.content.sections[this.currentSectionIndex - 1].skipWhenComingFromNext) {\n        if (this.currentSectionIndex - 1 > 0) {\n          this.goToSectionIndex = this.currentSectionIndex - 2;\n        }\n      }\n      this.currentSection().transitionToPrev(this.finishTransToNextOrPrev.bind(this));\n    }\n    this.renderDiagrams();\n  }\n\n  goToSection(sectionId: number | string) {\n    window.presentationLessonTransitionStatus = 'notSteady';\n    // console.log('goToSection')\n    let sectionIndex = 0;\n    if (typeof sectionId === 'number') {\n      sectionIndex = sectionId;\n    } else {\n      this.content.sections.forEach((section, index) => {\n        if (section.title === sectionId) {\n          sectionIndex = index;\n        }\n      });\n    }\n    // this.firstPageShown = false;\n    if (sectionIndex >= 0 && sectionIndex < this.content.sections.length) {\n      if (this.inTransition) {\n        this.stopTransition();\n        if (this.firstPageShown) {\n          this.firstPageShown = false;\n        }\n      } else {\n        this.stopDiagrams();\n      }\n      // this.currentSection().goingTo = 'goto';\n      // this.sections.[this.currentSectionIndex + 1].comingFrom = 'goto';\n      if (this.currentSection().blankTransition.toGoto) {\n        this.refresh('', this.currentSectionIndex);\n      }\n      this.content.toggleInfo(false);\n      this.transitionStart('goto');\n      this.goToSectionIndex = sectionIndex;\n      this.currentSection().transitionToAny(this.finishTransToAny.bind(this));\n    }\n    this.renderDiagrams();\n  }\n\n  transitionStart(direction: 'next' | 'prev' | 'goto' | '' = '') {\n    this.inTransition = true;\n    this.comingFrom = direction;\n    if (direction === 'prev') {\n      this.content.goingTo = 'next';\n      this.content.comingFrom = 'prev';\n    } else if (direction === 'next') {\n      this.content.goingTo = 'prev';\n      this.content.comingFrom = 'next';\n    } else {\n      this.content.goingTo = 'goto';\n      this.content.comingFrom = 'goto';\n    }\n    const { diagram } = this;\n    if (diagram) {\n      diagram.inTransition = true;\n    }\n  }\n\n  finishTransToNextOrPrev(flag: boolean = true) {\n    if (flag === false) {\n      this.finishTransToAny();\n    } else {\n      this.currentSection().transitionToAny(this.finishTransToAny.bind(this));\n    }\n  }\n\n  finishTransToAny() {\n    // console.log('finishTransToAny')\n    this.setLeaveStateAndMoveToNextSection();\n  }\n\n  setLeaveStateAndMoveToNextSection() {\n    // console.log('setLeaveStateAndMoveToNextSection')\n    hideInfoButton();\n    hideInteractiveHighlightButton();\n\n    const possibleState = this.currentSection().setLeaveState();\n    if (possibleState !== null && possibleState !== undefined) {\n      this.state = possibleState;\n    }\n\n    this.currentSectionIndex = this.goToSectionIndex;\n    this.currentSection().setBlanks();\n\n    let contentHTML = this.getContentHtml();\n    if ((this.comingFrom === 'prev' && this.currentSection().blankTransition.fromPrev)\n     || (this.comingFrom === 'next' && this.currentSection().blankTransition.fromNext)\n     || (this.comingFrom === 'goto' && this.currentSection().blankTransition.fromGoto)) {\n      contentHTML = '';\n    }\n    this.refresh(\n      contentHTML, this.currentSectionIndex,\n      this.setState.bind(this),\n    );\n  }\n\n  fadeInTextFromPrev() {\n    const section = this.content.sections[this.currentSectionIndex];\n    if (section.fadeInFromPrev) {\n      const lastSection = this.content.sections[this.currentSectionIndex - 1];\n      const thisContent = section.getContent(false);\n      const lastContent = lastSection.getContent(false);\n      if (thisContent !== lastContent) {\n        const element = document.getElementById('id_lesson__diagram_text');\n        if (element != null) {\n          element.classList.add('lesson__diagram_text_fade_in');\n        }\n      }\n    }\n  }\n\n  setState() {\n    // console.log('setState')\n    const { diagram } = this;\n    const section = this.content.sections[this.currentSectionIndex];\n    if (diagram) {\n      section.setEnterState(this.state);\n      section.currentInteractiveItem = -1;\n      // if (this.overlayDiagram) {\n      //   this.overlayDiagram.elements.hideAll();\n      // }\n      section.setVisible();\n      this.renderDiagrams();\n      if (this.transitionCancelled) {\n        this.finishTransitionFromAny();\n      }\n      if (this.comingFrom === 'next') {\n        section.transitionFromNext(this.finishTransFromNextOrPrev.bind(this));\n      } else if (this.comingFrom === 'prev') {\n        this.fadeInTextFromPrev();\n        section.transitionFromPrev(this.finishTransFromNextOrPrev.bind(this));\n      } else {\n        section.transitionFromAny(this.finishTransitionFromAny.bind(this));\n      }\n    }\n  }\n\n  finishTransFromNextOrPrev(flag: boolean = true) {\n    if (flag === false) {\n      this.finishTransitionFromAny();\n    } else {\n      const section = this.content.sections[this.currentSectionIndex];\n      section.transitionFromAny(this.finishTransitionFromAny.bind(this));\n    }\n  }\n\n  finishTransitionFromAny() {\n    // console.log('finishTransitionFromAny')\n    this.refresh(\n      this.getContentHtml(),\n      this.currentSectionIndex,\n      this.componentUpdateComplete.bind(this),\n    );\n  }\n\n  setOnclicks() {\n    // console.log('setting conclicks')\n    const section = this.content.sections[this.currentSectionIndex];\n    section.setOnClicks();\n    if (section.refresh != null) {\n      section.refresh();\n    }\n  }\n\n  componentUpdateComplete() {\n    // console.log('componentUpdateComplete');\n    this.setOnclicks();\n    const section = this.content.sections[this.currentSectionIndex];\n    // section.setOnClicks();\n    section.setSteadyState(this.state);\n    this.firstPageShown = false;\n    this.inTransition = false;\n    const { diagram } = this;\n    if (diagram) {\n      diagram.inTransition = false;\n      // diagram.setFirstTransform();\n    }\n    section.setInfoButton();\n    // console.log('updateInteractiveItems')\n    this.updateInteractiveItems();\n    this.comingFrom = '';\n    this.transitionCancelled = false;\n    this.renderDiagrams();\n    window.presentationLessonTransitionStatus = 'steady';\n  }\n\n  updateInteractiveItems() {\n    const section = this.content.sections[this.currentSectionIndex];\n    section.setInteractiveElements();\n    section.setInteractiveElementsButton();\n  }\n\n  currentSection() {\n    return this.content.sections[this.currentSectionIndex];\n  }\n\n  stopDiagrams() {\n    const { diagram } = this;\n    if (diagram) {\n      diagram.stop(true, true);\n    }\n  }\n\n  highlightNextInteractiveItem() {\n    const section = this.content.sections[this.currentSectionIndex];\n    const interactiveItem = section.getNextInteractiveItem();\n    if (interactiveItem) {\n      const { element, location } = interactiveItem;\n      this.content.highlightInteractiveElement(element, location);\n    }\n  }\n\n  stopTransition() {\n    const { diagram } = this;\n    this.transitionCancelled = true;\n    if (diagram) {\n      diagram.inTransition = false;\n      // console.log('stopping')\n      diagram.stop(true, true);\n    }\n    this.inTransition = false;\n  }\n\n  renderDiagrams() {\n    const { diagram } = this;\n    if (diagram) {\n      diagram.animateNextFrame();\n    }\n  }\n\n  closeDiagram() {\n    const { diagram } = this;\n    if (diagram) {\n      diagram.destroy();\n    }\n    this.diagram = null;\n  }\n\n  initialize() {\n    this.closeDiagram();\n    super.initialize();\n    // this.content.initialize();\n    this.diagram = this.content.diagram;\n\n    // this.overlayDiagram = this.content.overlayDiagram;\n    this.diagram.lesson = this;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  disableInteractiveItems() {\n    const button = document.getElementById('id_lesson__interactive_element_button');\n    if (button != null) {\n      button.classList.add('lesson__interactive_element_button__hide');\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  enableInteractiveItems() {\n    this.updateInteractiveItems();\n  }\n}\n\nexport default PresentationLesson;\n","// @flow\nimport Fig from 'figureone';\nimport type { TypeParsablePoint } from 'figureone';\n// import LessonDescription from './lessonDescription';\n// import getLessonIndex from '../../Lessons/index';\n// import { loadRemote, loadRemoteCSS } from '../tools/misc';\nimport SimpleLessonContent from './SimpleLessonContent';\n// import PopupBoxCollection from '../../Lessons/LessonsCommon/DiagramCollectionPopup';\n\nconst {\n  Diagram, HTMLObject, Point,\n  DiagramElementPrimative, DiagramElementCollection,\n  DiagramElement, Rect, Equation, parsePoint,\n  EqnNavigator,\n} = Fig;\n\nconst { generateUniqueId, joinObjects } = Fig.tools.misc;\n\nconst { setOnClicks, applyModifiers, click } = Fig.tools.html;\n\nfunction initializeItemSelector(\n  methodToExecute: Function,\n  bindingObject: Object,\n  index: number = 0,\n) {\n  const elem = document\n    .getElementById(`id__lesson_item_selector_${index}`);\n  if (elem != null) {\n    if (elem.children.length > 0) {\n      for (let i = 0; i < elem.children.length; i += 1) {\n        elem.children[i].onclick = methodToExecute.bind(bindingObject, i);\n      }\n    }\n  }\n}\n\ntype TypeInteractiveElement = DiagramElementCollection\n                              | DiagramElementPrimative\n                              | string\n                              | HTMLElement;\ntype TypeInteractiveElementLocation = 'center' | 'zero' | ''\n                                      | 'topLeft' | 'topRight'\n                                      | 'topRightText'\n                                      | 'vertexLeft' | TypeParsablePoint;\ntype TypeInteractiveElements = Array<{\n    element: TypeInteractiveElement,\n    location: TypeInteractiveElementLocation,\n  }>;\n\ntype TypeInteractiveItem = {\n  element: TypeInteractiveElement;\n  location: TypeInteractiveElementLocation;\n};\n\nfunction interactiveItem(\n  element: TypeInteractiveElement,\n  location: TypeInteractiveElementLocation = '',\n) {\n  return {\n    element,\n    location,\n  };\n}\n\nfunction infoList(listItems: Array<string>) {\n  const out = ['<ul>'];\n  listItems.forEach((item) => {\n    out.push(`<li>${item}</li>`);\n  });\n  out.push(['</ul>']);\n  return out.join(' ');\n}\n\nfunction diagramCanvas(\n  id: string,\n  DiagramClass: Object,\n  classes: string = '',\n): Object {\n  return {\n    replacementText: () => `<div id=\"${id}\" class=\"canvas_container ${classes}\">\n        <canvas class=\"diagram__gl\"></canvas>\n        <div class=\"diagram__html\"></div>\n        <canvas class=\"diagram__text\"></canvas>\n      </div>`,\n    type: 'diagram',\n    DiagramClass,\n    id,\n  };\n}\n\nclass Section {\n  title: string;\n  modifiers: Object | Function;\n  infoModifiers: Object;\n  hint: Array<string> | string;\n  blank: Array<string>;\n  diagram: Diagram;\n  skipWhenComingFromNext: boolean;\n  infoElements: Array<DiagramElementCollection | DiagramElementPrimative>;\n  showOnly: Array<DiagramElementPrimative | DiagramElementCollection>\n           | () => {};\n\n  hideOnly: Array<DiagramElementPrimative | DiagramElementCollection>\n           | () => {};\n\n  show: Array<DiagramElementPrimative | DiagramElementCollection> | () => {};\n  hide: Array<DiagramElementPrimative | DiagramElementCollection> | () => {};\n  initialPositions: Object | () => {};\n  blankTransition: {\n    toNext: boolean;\n    toPrev: boolean;\n    fromNext: boolean;\n    fromPrev: boolean;\n    toGoto: boolean;\n    fromGoto: boolean;\n  };\n\n  fadeInFromPrev: boolean;\n\n  interactiveElementsOnly: TypeInteractiveElements;\n  interactiveElements: TypeInteractiveElements;\n  interactiveElementsRemove: Array<TypeInteractiveElement>;\n  interactiveElementList: TypeInteractiveElements;\n  currentInteractiveItem: number;\n  refresh: ?() => void;\n\n  constructor(diagram: Diagram) {\n    this.diagram = diagram;\n    this.title = '';\n    this.modifiers = {};\n    this.infoModifiers = {};\n    this.showOnly = [];\n    this.blank = [];\n    this.infoElements = [];\n    this.fadeInFromPrev = true;\n    this.blankTransition = {\n      toNext: false,\n      toPrev: false,\n      fromNext: false,\n      fromPrev: false,\n      toGoto: false,\n      fromGoto: false,\n    };\n    this.interactiveElementList = [];\n    this.currentInteractiveItem = -1;\n    this.skipWhenComingFromNext = false;\n    this.refresh = null;\n  }\n\n  setContent(): Array<string> | string {\n    return [];\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  setInfo(): Array<string> | string {\n    return [];\n  }\n\n  setOnClicks() {\n    setOnClicks(this.modifiers);\n    setOnClicks(this.infoModifiers);\n  }\n\n  getInfo(): string {\n    let htmlText = '';\n    let info = '';\n    if (typeof this.setInfo === 'string'\n        || Array.isArray(this.setInfo)) {\n      info = this.setInfo;\n    } else {\n      info = this.setInfo();\n    }\n    if (typeof info === 'string') {\n      info = [info];\n    }\n\n    let contentInBullets = [];\n    if (info.length > 1) {\n      info.forEach((line) => {\n        if (line.startsWith('<li>') || line.startsWith('<ul>') || line.startsWith('</ul>')) {\n          contentInBullets.push(line);\n        } else {\n          contentInBullets.push(`<li>${line}</li>`);\n        }\n      });\n      if (info[0] !== '<ul>') {\n        htmlText = '<ul>';\n      }\n    } else {\n      contentInBullets = info;\n    }\n\n    contentInBullets.forEach((element) => {\n      htmlText = `${htmlText}${element}`;\n    });\n\n    if (info.length > 1 && info[0] !== '<ul>') {\n      htmlText = `${htmlText}</ul>`;\n    }\n\n    // info.forEach((element) => {\n    //   htmlText = `${htmlText}${element}`;\n    // });\n    // htmlText += '\\n';\n    htmlText = applyModifiers(htmlText, this.infoModifiers);\n\n    // Go through all text, and replace all characters between | | with\n    // with default keywords\n    // const r = RegExp(/\\|([^|]*)\\|/, 'gi');\n    // return htmlText.replace(r, '<span class=\"highlight_word\">$1</span>');\n    return htmlText;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  hideInfoButton() {\n    const infoElement = document.getElementById('id_lesson__info_button');\n    if (infoElement instanceof HTMLElement) {\n      infoElement.classList.add('lesson__info_hide');\n    }\n  }\n\n  setInfoButton() {\n    const infoHtml = this.getInfo();\n    const infoElement = document.getElementById('id_lesson__info_button');\n    const infoBox = document.getElementById('id_lesson__info_box__text');\n    if (infoElement instanceof HTMLElement) {\n      if (infoHtml) {\n        infoElement.classList.remove('lesson__info_hide');\n        if (infoBox instanceof HTMLElement) {\n          infoBox.innerHTML = infoHtml;\n        }\n      } else {\n        infoElement.classList.add('lesson__info_hide');\n      }\n    }\n  }\n\n  setInteractiveElementsButton() {\n    // const infoHtml = this.getInfo();\n    const button = document\n      .getElementById('id_lesson__interactive_element_button');\n    // const infoBox = document.getElementById('id_lesson__info_box__text');\n    if (button instanceof HTMLElement) {\n      if (this.interactiveElementList.length > 0 && this.getNextInteractiveItem()) {\n        this.currentInteractiveItem = -1;\n        button.classList.remove('lesson__interactive_element_button__hide');\n      } else {\n        button.classList.add('lesson__interactive_element_button__hide');\n      }\n    }\n  }\n\n  getNextInteractiveItem(): null | TypeInteractiveItem {\n    if (this.interactiveElementList.length > 0) {\n      let index = this.currentInteractiveItem + 1;\n      let counter = 0;\n      while (counter < this.interactiveElementList.length) {\n        if (index > this.interactiveElementList.length - 1) {\n          index = 0;\n        }\n        let { element } = this.interactiveElementList[index];\n        let elementIsVisible = false;\n        if (typeof element === 'string') {\n          element = document.getElementById(element);\n        }\n        if (element instanceof HTMLElement) {\n          const rect = element.getBoundingClientRect();\n          if (rect.left > 0 && rect.width > 0) {\n            elementIsVisible = true;\n          }\n        } else if (element instanceof DiagramElementPrimative\n                   && element.drawingObject instanceof HTMLObject) {\n          if (element.isShown) {\n            elementIsVisible = true;\n          }\n        } else if ((element instanceof DiagramElementPrimative\n          || element instanceof DiagramElementCollection)\n          && element.isShown) {\n          if (element.isMovable || element.isTouchable || element.isInteractive) {\n            elementIsVisible = true;\n          }\n        }\n        let elementIsTouchable = false;\n        if (element instanceof DiagramElementCollection) {\n          if (element.isTouchable || element.isMovable\n            || element.hasTouchableElements || element.isInteractive) {\n            elementIsTouchable = true;\n          }\n        } else if (element instanceof DiagramElementPrimative) {\n          if (element.isTouchable || element.isMovable || element.isInteractive) {\n            elementIsTouchable = true;\n          }\n        } else if (element instanceof HTMLElement) {\n          elementIsTouchable = true;\n          if (element.classList.contains('not_interactive_word')) {\n            elementIsVisible = false;\n          } else {\n            elementIsVisible = true;\n          }\n        }\n        if (elementIsVisible && elementIsTouchable\n          && element != null && element.isInteractive !== false) {\n          this.currentInteractiveItem = index;\n          return {\n            element,\n            location: this.interactiveElementList[index].location,\n          };\n        }\n        index += 1;\n        if (index > this.interactiveElementList.length - 1) {\n          index = 0;\n        }\n        counter += 1;\n      }\n    }\n    return null;\n  }\n\n  getContent(modify: boolean = true): string {\n    if (typeof this.modifiers === 'function') {\n      this.modifiers = this.modifiers();\n    }\n    let htmlText = '';\n    let content = '';\n    if (typeof this.setContent === 'string'\n        || Array.isArray(this.setContent)) {\n      content = this.setContent;\n    } else {\n      content = this.setContent();\n    }\n    if (typeof content === 'string') {\n      content = [content];\n    }\n    const contentInParagraphs = [];\n    content.forEach((line) => {\n      if (line.charAt(0) !== '<') {\n        contentInParagraphs.push(`<p>${line}</p>`);\n      } else {\n        contentInParagraphs.push(line);\n      }\n    });\n    contentInParagraphs.forEach((element) => {\n      htmlText = `${htmlText}${element}`;\n    });\n    // htmlText += '\\n';\n    if (modify) {\n      htmlText = applyModifiers(htmlText, this.modifiers);\n    }\n    // Object.keys(this.modifiers).forEach((key) => {\n    //   const mod = this.modifiers[key];\n    //   htmlText = modifyText(htmlText, key, mod);\n    // });\n\n    // Go through all text, and replace all characters between | | with\n    // with default keywords\n    // const r = RegExp(/\\|([^|]*)\\|/, 'gi');\n    // return htmlText.replace(r, '<span class=\"highlight_word\">$1</span>');\n    return htmlText;\n  }\n\n  /* eslint-disable no-unused-vars */\n  setSteadyState(previousState: Object) {\n  }\n\n  /* eslint-disable no-unused-vars */\n  setEnterState(previousState: Object) {\n  }\n\n  /* eslint-disable no-unused-vars */\n  setLeaveState(): ?Object {\n  }\n\n  setBlanks() {\n    this.blank.forEach((element) => {\n      if (element in this.blankTransition) {\n        this.blankTransition[element] = true;\n      }\n    });\n    // if ('blank' in this) {\n    //   Object.keys(this.blank).forEach((key) => {\n    //     this.blankTransition[key] = this.blank[key];\n    //   });\n    // }\n  }\n\n  getInteractiveElementIndex(\n    element: TypeInteractiveElement,\n  ) {\n    let elem = element;\n    if (typeof element === 'string') {\n      elem = document.getElementById(element);\n    }\n    for (let i = 0; i < this.interactiveElementList.length; i += 1) {\n      const item = this.interactiveElementList[i];\n      if (item.element === elem || item.element === element) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  removeInteractiveElement(element: TypeInteractiveElement) {\n    const index = this.getInteractiveElementIndex(element);\n    if (index > -1) {\n      this.interactiveElementList.splice(index, 1);\n    }\n  }\n\n  replaceInteractiveElement(\n    element: TypeInteractiveElement,\n    location: TypeInteractiveElementLocation,\n  ) {\n    const index = this.getInteractiveElementIndex(element);\n    if (index > -1) {\n      this.interactiveElementList[index] = interactiveItem(element, location);\n      return true;\n    }\n    return false;\n  }\n\n  replaceOrAddInteractiveElement(\n    element: TypeInteractiveElement,\n    location: TypeInteractiveElementLocation,\n  ) {\n    const replaced = this.replaceInteractiveElement(element, location);\n    if (!replaced) {\n      this.interactiveElementList.push(interactiveItem(element, location));\n    }\n  }\n\n  setInteractiveElements() {\n    this.interactiveElementList = [];\n    if ('interactiveElementsOnly' in this) {\n      // this.interactiveElementList = this.interactiveElementsOnly;\n      this.interactiveElementsOnly.forEach((element) => {\n        if (element instanceof DiagramElementCollection\n          || element instanceof DiagramElementPrimative) {\n          this.replaceOrAddInteractiveElement(element, '');\n        } else if (typeof element === 'string') {\n          const elem = document.getElementById(element);\n          if (elem != null) {\n            this.replaceOrAddInteractiveElement(element, '');\n          }\n        } else {\n          this.replaceOrAddInteractiveElement(element.element, element.location);\n        }\n      });\n    } else {\n      // Get all action words\n      let elements = document.getElementsByClassName('interactive_word');\n      for (let i = 0; i < elements.length; i += 1) {\n        const element = elements[i];\n        if (element.id != null) {\n          this.interactiveElementList.push({\n            element: element.id,\n            location: 'topRightText',\n          });\n        } else {\n          this.interactiveElementList.push({\n            element,\n            location: 'topRightText',\n          });\n        }\n      }\n\n      elements = document.getElementsByClassName('interactive_top_right');\n      for (let i = 0; i < elements.length; i += 1) {\n        const element = elements[i];\n        const style = window.getComputedStyle(element);\n        // const style = {visibility: '', display: ''}\n        if (style.visibility !== 'hidden'\n          && style.display !== 'none'\n        ) {\n          if (element.id != null && element.id !== '') {\n            this.interactiveElementList.push({\n              element: element.id,\n              location: 'topRightText',\n            });\n          } else {\n            this.interactiveElementList.push({\n              element,\n              location: 'topRightText',\n            });\n          }\n        }\n      }\n\n      // Get all movable diagram elements\n      const diagramElements = this.diagram.elements.getAllPossiblyInteractiveElements();\n      // console.log(this.diagram.elements)\n      // debugger;\n      diagramElements.forEach((element) => {\n        this.interactiveElementList.push({\n          element,\n          location: '',\n        });\n      });\n    }\n\n    // Overwrite or add single elements\n    if ('interactiveElements' in this) {\n      this.interactiveElements.forEach((element) => {\n        if (element instanceof DiagramElementCollection\n          || element instanceof DiagramElementPrimative) {\n          this.replaceOrAddInteractiveElement(element, '');\n        } else {\n          this.replaceOrAddInteractiveElement(element.element, element.location);\n        }\n      });\n    }\n    // Remove elements\n    if ('interactiveElementsRemove' in this) {\n      this.interactiveElementsRemove.forEach((element) => {\n        this.removeInteractiveElement(element);\n      });\n    }\n  }\n\n  setVisible() {\n    if ('showOnly' in this) {\n      const elementsOrMethod = this.showOnly;\n      if (Array.isArray(elementsOrMethod)) {\n        this.diagram.elements.showOnly(elementsOrMethod);\n      } else {\n        elementsOrMethod();\n      }\n    }\n    if ('hideOnly' in this) {\n      const elementsOrMethod = this.hideOnly;\n      if (Array.isArray(elementsOrMethod)) {\n        this.diagram.elements.hideOnly(elementsOrMethod);\n      } else {\n        elementsOrMethod();\n      }\n    }\n    if ('show' in this) {\n      const elementsOrMethod = this.show;\n      if (Array.isArray(elementsOrMethod)) {\n        elementsOrMethod.forEach((element) => {\n          if (element instanceof DiagramElementCollection) {\n            element.showAll();\n          } else {\n            element.show();\n          }\n        });\n      } else {\n        elementsOrMethod();\n      }\n    }\n    if ('hide' in this) {\n      const elementsOrMethod = this.hide;\n      if (Array.isArray(elementsOrMethod)) {\n        elementsOrMethod.forEach((element) => {\n          if (element instanceof DiagramElementCollection) {\n            element.hideAll();\n          } else {\n            element.hide();\n          }\n        });\n      } else {\n        elementsOrMethod();\n      }\n    }\n  }\n\n  getState(diagram: Diagram): Object {\n    return {};\n  }\n\n  transitionToNext(done: () => void = function temp() {}): void {\n    done();\n  }\n\n  transitionFromNext(done: () => void = function temp() {}): void {\n    done();\n  }\n\n  transitionToPrev(done: () => void = function temp() {}): void {\n    done();\n  }\n\n  transitionFromPrev(done: () => void = function temp() {}): void {\n    done();\n  }\n\n  transitionFromAny(done: () => void = function temp() {}): void {\n    done();\n  }\n\n  transitionToAny(done: () => void = function temp() {}): void {\n    done();\n  }\n  /* eslint-enable no-unused-vars */\n}\n\n// class diagramClass {\n// }\nconst whichAnimationEvent = () => {\n  // let t;\n  const el = document.createElement('fakeelement');\n\n  const transitions = {\n    animation: 'animationend',\n    OAnimation: 'oAnimationEnd',\n    MozAnimation: 'animationend',\n    WebkitAnimation: 'webkitAnimationEnd',\n  };\n  // for (t in transitions) {\n  //   console.log(t)\n  //   if (el.style[t] !== undefined) {\n  //     return transitions[t];\n  //   }\n  // }\n  for (let i = 0; i < Object.keys(transitions).length; i += 1) {\n    const key = Object.keys(transitions)[i];\n    if (key in el.style) {\n      return transitions[key];\n    }\n  }\n  return '';\n};\n\nclass PresentationLessonContent extends SimpleLessonContent {\n  title: string;\n  sections: Array<Section>;\n  // diagram: Object;\n  // overlayDiagram: Object;\n  diagramHtmlId: string;\n  goingTo: 'next' | 'prev' | 'goto';\n  comingFrom: 'next' | 'prev' | 'goto';\n  // iconLink: string;\n  // iconLinkGrey: string;\n  toggleInfo: (?boolean) => void;\n  animationEnd: string;\n  next: () => void;\n  prev: () => void;\n  // questions\n\n  constructor(htmlId: string = 'lesson__content') {\n    super(htmlId);\n    this.diagramHtmlId = `${htmlId}_diagram`;\n    // this.qrDiagram = null;\n    // this.sections = [];\n    // this.iconLink = '/';\n    // this.iconLinkGrey = '/';\n    // this.setTitle();\n\n    this.animationEnd = whichAnimationEvent();\n    if (window.quickReference == null) {\n      window.quickReference = {};\n    }\n  }\n\n  initialize() {\n    this.setDiagram(this.diagramHtmlId);\n    this.next = () => { this.diagram.lesson.nextSection(); };\n    this.prev = () => { this.diagram.lesson.nextSection(); };\n    this.setElementContent();\n    this.addSections();\n    this.addInfoBox();\n    this.addStar();\n    this.diagram.setFirstTransform();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  toggleInfo(toState: ?boolean = null) {\n    const infoButton = document.getElementById('id_lesson__info_button');\n    const infoBox = document.getElementById('id_lesson__info_box');\n    if (infoButton instanceof HTMLElement && infoBox instanceof HTMLElement) {\n      if (typeof toState === 'boolean' && toState === true) {\n        infoButton.classList.add('lesson__info_button_show');\n        infoBox.classList.remove('lesson__info_hide');\n      } else if (typeof toState === 'boolean' && toState === false) {\n        infoButton.classList.remove('lesson__info_button_show');\n        infoBox.classList.add('lesson__info_hide');\n      } else {\n        infoButton.classList.toggle('lesson__info_button_show');\n        infoBox.classList.toggle('lesson__info_hide');\n      }\n      if (infoBox.classList.contains('lesson__info_hide')) {\n        this.diagram.elements.hasTouchableElements = true;\n      } else {\n        this.diagram.elements.hasTouchableElements = false;\n      }\n    }\n    // if (infoBox instanceof HTMLElement) {\n    //   infoBox.classList.toggle('lesson__info_hide');\n    // }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  prepareToShowQR() {\n    // this.qrDiagram.container.style.zIndex = '10';\n    const overlay = document.getElementById('presentation_lesson__qr__overlay');\n    if (overlay != null) {\n      overlay.style.zIndex = '10';\n    }\n    const next = document.getElementById('lesson__button-next');\n    if (next) {\n      next.classList.add('lesson__button-next-disabled');\n    }\n    const prev = document.getElementById('lesson__button-previous');\n    if (prev) {\n      prev.classList.add('lesson__button-prev-disabled');\n    }\n    const gotoButton =\n      document.getElementById('id__lesson__button-goto_container');\n    if (gotoButton) {\n      gotoButton.classList.add('lesson__button-goto_container-disabled');\n    }\n    const interactive =\n      document.getElementById('id_lesson__interactive_element_button');\n    if (interactive) {\n      interactive.classList.add('lesson__interactive_element_button__disable');\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  prepareToHideQR() {\n    const overlay = document.getElementById('presentation_lesson__qr__overlay');\n    if (overlay != null) {\n      overlay.style.zIndex = '-1';\n    }\n    const next = document.getElementById('lesson__button-next');\n    if (next\n      && this.diagram.lesson.currentSectionIndex\n        < this.diagram.lesson.content.sections.length - 1\n    ) {\n      next.classList.remove('lesson__button-next-disabled');\n    }\n    const prev = document.getElementById('lesson__button-previous');\n    if (prev && this.diagram.lesson.currentSectionIndex > 0) {\n      prev.classList.remove('lesson__button-prev-disabled');\n    }\n    const gotoButton =\n      document.getElementById('id__lesson__button-goto_container');\n    if (gotoButton) {\n      gotoButton.classList.remove('lesson__button-goto_container-disabled');\n    }\n    const interactive =\n      document.getElementById('id_lesson__interactive_element_button');\n    if (interactive) {\n      interactive.classList.remove('lesson__interactive_element_button__disable');\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addInfoBox() {\n    const container = document.createElement('div');\n    container.classList.add('lesson__info_box');\n    container.classList.add('lesson__info_hide');\n    container.id = 'id_lesson__info_box';\n\n    const title = document.createElement('div');\n    title.classList.add('lesson__info_box__title');\n    container.appendChild(title);\n\n    const infoSymbol = document.createElement('div');\n    infoSymbol.classList.add('lesson__info_box__title_i');\n    infoSymbol.innerHTML = 'i';\n    title.appendChild(infoSymbol);\n\n    const close = document.createElement('div');\n    close.classList.add('lesson__info_box__close');\n    close.id = 'id_lesson__info_box__close';\n    close.innerHTML = 'X';\n    close.onclick = this.toggleInfo.bind(this);\n    title.appendChild(close);\n\n    const titleText = document.createElement('div');\n    titleText.classList.add('lesson__info_box__title_text');\n    titleText.innerHTML = 'What can you do on this page?';\n    title.appendChild(titleText);\n\n    const text = document.createElement('div');\n    text.classList.add('lesson__info_box__text');\n    text.id = ('id_lesson__info_box__text');\n    container.appendChild(text);\n\n    this.diagram.htmlCanvas.appendChild(container);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  pulseStar() {\n    const star = document.getElementById('id_lesson__star');\n    if (star instanceof HTMLElement) {\n      star.classList.toggle('lesson__info_star_pulse');\n    }\n  }\n\n  // starOnNextInteractiveItem() {\n  //   const index = this.\n  // }\n\n  highlightInteractiveElement(\n    element: TypeInteractiveElement,\n    location: TypeInteractiveElementLocation,\n  ) {\n    const star = document.getElementById('id_lesson__star');\n    if (star instanceof HTMLElement) {\n      const animationEnd = () => {\n        star.removeEventListener(this.animationEnd, animationEnd);\n        star.classList.remove('lesson__info_star_pulse');\n        // this next line triggers a relflow, making the class removal stick\n        // eslint-disable-next-line no-unused-vars\n        const w = star.offsetWidth;\n      };\n      animationEnd();\n\n      let cssPosition = new Point(0, 0);\n      if (element instanceof DiagramElementPrimative\n        || element instanceof DiagramElementCollection) {\n        let diagramPosition;\n        if (location === 'center'\n          || (location === '' && element.interactiveLocation === 'center')\n        ) {\n          diagramPosition = element.getCenterDiagramPosition();\n        } else if (location === 'zero'\n        || (location === '' && element.interactiveLocation === 'zero')) {\n          diagramPosition = element.getDiagramPosition();\n        } else if (location === 'topLeft'\n          || (location === '' && element.interactiveLocation === 'topLeft')\n        ) {\n          const rect = element.getDiagramBoundingRect();\n          diagramPosition = new Point(rect.left, rect.top);\n        } else if (location === 'topRight'\n          || (location === '' && element.interactiveLocation === 'topRight')\n        ) {\n          const rect = element.getDiagramBoundingRect();\n          diagramPosition = new Point(rect.right, rect.top);\n        } else if (location === 'vertexLeft'\n          || (location === '' && element.interactiveLocation === 'vertexLeft')\n        ) {\n          const borders = element.getVertexSpaceBoundaries();\n          let minXPoint;\n          borders.forEach((border) => {\n            border.forEach((borderPoint) => {\n              if (minXPoint == null) {\n                minXPoint = borderPoint._dup();\n              } else if (minXPoint.x > borderPoint.x) {\n                minXPoint = borderPoint._dup();\n              }\n            });\n          });\n          if (minXPoint) {\n            minXPoint.y = 0;\n            diagramPosition = element.getVertexSpaceDiagramPosition(minXPoint);\n          } else {\n            diagramPosition = new Point(0, 0);\n          }\n        } else if (location instanceof Point\n          || typeof location === 'number'\n          || Array.isArray(location)\n        ) {\n          const p = parsePoint(location);\n          const rect = element.getDiagramBoundingRect();\n          diagramPosition = new Point(\n            rect.left + p.x * rect.width,\n            rect.bottom + p.y * rect.height,\n          );\n        } else {\n          diagramPosition = element\n            .getVertexSpaceDiagramPosition(parsePoint(element.interactiveLocation));\n        }\n        cssPosition = diagramPosition\n          .transformBy(this.diagram.spaceTransforms.diagramToPixel.matrix());\n      } else {\n        let html = element;\n        if (typeof element === 'string') {\n          html = document.getElementById(element);\n        }\n        if (html instanceof HTMLElement) {\n          const rect = html.getBoundingClientRect();\n\n          const fontSize = parseFloat(\n            window.getComputedStyle(html, null).getPropertyValue('font-size'),\n          );\n          const rectBase = this.diagram.htmlCanvas.getBoundingClientRect();\n          if (location === 'topLeft') {\n            cssPosition = new Point(\n              rect.left - rectBase.left,\n              rect.top - rectBase.top,\n            );\n          } else if (location === 'topRight') {\n            cssPosition = new Point(\n              rect.left - rectBase.left + rect.width,\n              rect.top - rectBase.top,\n            );\n          } else if (location === 'topRightText') {\n            cssPosition = new Point(\n              rect.left - rectBase.left + rect.width,\n              rect.top - rectBase.top + fontSize * 0.3,\n            );\n          } else if (location === 'vertexLeft') {\n            cssPosition = new Point(\n              rect.left - rectBase.left + rect.width * 0.05,\n              rect.top - rectBase.top + rect.height * 0.5,\n            );\n          } else if (location instanceof Point\n            || typeof location === 'number'\n            || Array.isArray(location)\n          ) {\n            const p = parsePoint(location);\n            cssPosition = new Point(\n              rect.left - rectBase.left + rect.width * p.x,\n              rect.top - rectBase.top + rect.height * p.y,\n            );\n          } else {\n            cssPosition = new Point(\n              rect.left - rectBase.left + rect.width / 2,\n              rect.top - rectBase.top + rect.height / 2,\n            );\n          }\n        }\n      }\n      star.classList.add('lesson__info_star_pulse');\n      const rect = star.getBoundingClientRect();\n      star.style.left = `${cssPosition.x - rect.width / 2}px`;\n      star.style.top = `${cssPosition.y - rect.height / 2}px`;\n      star.addEventListener(this.animationEnd, animationEnd.bind(this));\n    }\n  }\n\n  bindNext(color: Array<number> = this.diagram.layout.colors.diagram.action) {\n    return click(this.next, [this], color);\n  }\n\n  // bindShowQR(\n  //   uid: string,\n  //   qrid: string,\n  //   colorOrOptions: Array<number> | {\n  //     color?: ?Array<number>,\n  //     interactive?: boolean,\n  //     id?: string,\n  //     classes?: string,\n  //     text?: ?string,\n  //   } = {},\n  //   // color: Array<number> = this.diagram.layout.colors.diagram.action,\n  // ) {\n  //   const defaultOptions = {\n  //     color: this.diagram.layout.colors.diagram.action,\n  //     classes: '',\n  //   };\n  //   let options = defaultOptions;\n  //   if (Array.isArray(colorOrOptions)) {\n  //     options.color = colorOrOptions;\n  //   } else {\n  //     options = joinObjects({}, defaultOptions, colorOrOptions);\n  //     options.classes = `lesson__qr_action_word ${options.classes}`;\n  //   }\n  //   return click(this.showQR, [this, uid, qrid], options);\n  // }\n\n  qr(\n    link: string,\n    colorOrOptions: Array<number> | {\n      color?: ?Array<number>,\n      interactive?: boolean,\n      id?: string,\n      classes?: string,\n      text?: ?string,\n    } = {},\n    // color: Array<number> = this.diagram.layout.colors.diagram.action,\n  ) {\n    const defaultOptions = {\n      color: this.diagram.layout.colors.diagram.action,\n      classes: 'lesson__qr_action_word',\n    };\n    let options = defaultOptions;\n    if (Array.isArray(colorOrOptions)) {\n      options.color = colorOrOptions;\n    } else {\n      options = joinObjects({}, defaultOptions, colorOrOptions);\n      options.classes = `lesson__qr_action_word ${options.classes}`;\n    }\n    return click(window.lessonFunctions.qr, [window.lessonFunctions, '', link], options);\n  }\n\n  addStar() {\n    const img = document.createElement('img');\n    img.setAttribute('src', '/static/assets/star.png');\n    img.id = 'id_lesson__star';\n    img.classList.add('lesson__info_star');\n    img.alt = 'active item';\n\n    this.diagram.htmlCanvas.appendChild(img);\n  }\n\n  setTitle() {\n    this.title = '';\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  setDiagram(htmlId: string = '') {\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  setElementContent() {\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addSections() {\n  }\n\n  addSection(...sectionObjects: Array<Object>) {\n    const s = new Section(this.diagram);\n    const section = Object.assign({}, ...sectionObjects);\n    Object.keys(section).forEach((key) => {\n      // $FlowFixMe\n      s[key] = section[key];\n    });\n    this.sections.push(s);\n  }\n\n  addSectionEqnStep(\n    optionsIn: {\n      eqn: { eqn: Equation } & Equation,  // or navigator\n      from: string,                       // From form\n      to: string,                         // To Form\n      duration?: number,                   // duration\n      animate?: 'dissolve' | 'move',\n    },\n    ...sectionObjects: Array<Object>\n  ) {\n    const defaultOptions = {\n      animate: 'move',\n      duration: 0.8,\n    };\n    const options = joinObjects({}, defaultOptions, optionsIn);\n    const userSections = Object.assign({}, ...sectionObjects);\n    let { eqn } = options;\n    const { animate, duration } = options;\n    let nav = null;\n    if (eqn.table != null) {\n      nav = eqn;\n      ({ eqn } = nav);\n    }\n    const fromForm = options.from;\n    const toForm = options.to;\n    const eqnSection = {\n      transitionFromPrev: (done) => {\n        let callback = done;\n        if (userSections.transitionFromPrev != null) {\n          callback = userSections.transitionFromPrev.bind(userSections, done);\n        }\n        eqn.showForm(fromForm);\n        if (fromForm === toForm) {\n          callback();\n          return;\n        }\n        eqn.goToForm({\n          name: toForm,\n          duration,\n          callback,\n          animate,\n        });\n        if (nav != null) {\n          nav.updateButtons();\n        }\n      },\n      setSteadyState: () => {\n        if (userSections.setSteadyState != null) {\n          userSections.setSteadyState();\n        }\n        eqn.showForm(toForm);\n        if (nav != null) {\n          nav.updateButtons();\n        }\n      },\n    };\n    const section = Object.assign({}, ...sectionObjects, eqnSection);\n    this.addSection(section);\n  }\n\n  addSectionEqnStory(\n    equations: Array<{\n      nav?: EqnNavigator,\n      eqn?: Equation,\n      form?: string,\n      toForm?: string,\n      moveFrom?: DiagramElementCollection | Point,\n      duration?: number,\n      dissolveInTime?: number,\n      dissolveOutTime?: number,\n      animate?: 'dissolve' | 'move',\n      pulseDuration?: number,\n      pulseScale?: number,\n      opacity?: number,\n    }>,\n    ...sectionObjects: Array<Object>\n  ) {\n    const defaultEqnOptions = {\n      animate: 'move',\n      duration: 1,\n      dissolveInTime: 1,\n      dissolveOutTime: 0.5,\n      pulseDuration: 1,\n      pulseScale: 1.1,\n      opacity: 0.6,\n    };\n    const userSections = Object.assign({}, ...sectionObjects);\n    const setFirstTransform = () => { this.diagram.setFirstTransform(); };\n    const eqnSection = {\n      transitionFromPrev: (done) => {\n        setFirstTransform();\n        let callback = done;\n        if (userSections.transitionFromPrev != null) {\n          callback = userSections.transitionFromPrev.bind(userSections, done);\n        }\n        let counter = 0;\n        const countUp = () => {\n          counter += 1;\n          if (counter === equations.length) {\n            callback();\n          }\n        };\n        equations.forEach((eqOptions, i) => {\n          if (eqOptions.nav == null && eqOptions.eqn == null) {\n            return;\n          }\n          const options = joinObjects({}, defaultEqnOptions, eqOptions);\n          const {\n            form, duration, toForm,\n            dissolveInTime, dissolveOutTime, pulseDuration, pulseScale,\n            animate, opacity,\n            moveFrom,\n          } = options;\n          let { eqn, nav } = options;\n          if (eqn == null) {\n            ({ eqn } = nav);\n          }\n          if (nav == null) {\n            nav = {\n              // eslint-disable-next-line no-unused-vars\n              showForm: (t) => {},\n              // eslint-disable-next-line no-unused-vars\n              setOpacity: (o) => {},\n            };\n          }\n\n          if (toForm == null && form == null) {\n            return;\n          }\n\n          function setFinalForm(f) {\n            nav.showForm(f);\n            eqn.showForm(f);\n            countUp();\n            if (i < equations.length - 1) {\n              eqn.setOpacity(opacity);\n              nav.setOpacity(opacity);\n            }\n          }\n\n          if (toForm == null && form != null) {\n            if (animate === 'dissolve') {\n              // nav.showForm(form);\n              eqn.hide();\n              eqn.goToForm({\n                name: form,\n                animate: 'dissolve',\n                duration,\n                dissolveInTime,\n                dissolveOutTime,\n                callback: setFinalForm.bind(this, form),\n              });\n              return;\n            }\n            setFinalForm(form);\n            return;\n          }\n\n          if (form == null && toForm != null) {\n            setFinalForm(toForm);\n            return;\n          }\n\n          if (form === toForm) {\n            setFinalForm(form);\n            return;\n          }\n\n          eqn.showForm(options.form);\n          if (options.moveFrom == null) {\n            nav.showForm(toForm);\n            eqn.showForm(form);\n            eqn.goToForm({\n              name: toForm,\n              animate,\n              duration,\n              dissolveInTime,\n              dissolveOutTime,\n              callback: setFinalForm.bind(this, toForm),\n            });\n            return;\n          }\n\n          let moveFromPosition = moveFrom;\n          let pulseMoveFrom = () => {};\n          let dullLastEqn = () => {};\n          if (options.moveFrom instanceof DiagramElementCollection) {\n            moveFromPosition = moveFrom.getPosition();\n            pulseMoveFrom = () => {\n              moveFrom.pulseScaleNow(pulseDuration, pulseScale);\n            };\n            if (moveFrom instanceof EqnNavigator\n              || moveFrom instanceof Equation\n            ) {\n              dullLastEqn = () => {\n                moveFrom.showForm(form);\n                moveFrom.setOpacity(0.5);\n              };\n            }\n          }\n          eqn.animations.new()\n            .position({ target: moveFromPosition })\n            .trigger({ callback: pulseMoveFrom })\n            .pulse({ duration: pulseDuration, scale: pulseScale })\n            .trigger({ callback: dullLastEqn })\n            .position({\n              start: moveFromPosition,\n              target: eqn.getPosition(),\n              duration,\n            })\n            // eslint-disable-next-line no-loop-func\n            .whenFinished(() => {\n              // if (equation instanceof EqnNavigator) {\n              //   equation.showForm(toForm);\n              // }\n              nav.showForm(toForm);\n              eqn.showForm(form);\n              eqn.goToForm({\n                name: toForm,\n                animate: 'move',\n                duration,\n                dissolveInTime,\n                dissolveOutTime,\n                callback: () => {\n                  nav.showForm(toForm);\n                  countUp();\n                },\n              });\n            })\n            .start();\n        });\n      },\n      setSteadyState: () => {\n        if (userSections.setSteadyState != null) {\n          userSections.setSteadyState();\n        }\n        equations.forEach((eqOptions, i) => {\n          if (eqOptions.nav == null && eqOptions.eqn == null) {\n            return;\n          }\n          const options = joinObjects({}, defaultEqnOptions, eqOptions);\n          const { form, toForm, opacity } = options;\n          let { eqn, nav } = options;\n          if (eqn == null) {\n            ({ eqn } = nav);\n          }\n          if (nav == null) {\n            nav = {\n              // eslint-disable-next-line no-unused-vars\n              showForm: (t) => {},\n              // eslint-disable-next-line no-unused-vars\n              setOpacity: (o) => {},\n            };\n          }\n          if (toForm == null && form != null) {\n            nav.showForm(form);\n            eqn.showForm(form);\n          } else if (toForm != null) {\n            nav.showForm(toForm);\n            eqn.showForm(toForm);\n          }\n          if (i < equations.length - 1) {\n            eqn.setOpacity(opacity);\n            nav.setOpacity(opacity);\n          }\n        });\n      },\n    };\n    const section = Object.assign({}, ...sectionObjects, eqnSection);\n    this.addSection(section);\n  }\n}\n\nfunction makeFig(\n  optionsIn: {\n    id?: string,\n    scale?: string,\n    window?: Array<number>,\n    left?: ?number,\n    top?: ?number,\n    width?: ?number,\n    height?: ?number,\n    borderDebug?: boolean,\n    element: DiagramElement | Array<DiagramElement>,\n    classes?: string,\n  },\n  // id: string = `id_figure__${generateUniqueId()}`,\n  // elements: DiagramElement | Array<DiagramElement>,\n  // scale: string = 'fit',\n  // limits: Rect | null | Array<number> = null,\n) {\n  const defaultOptions = {\n    id: `id_figure__${generateUniqueId()}`,\n    scale: 'fit',\n    window: [-1, -1, 2, 2],\n    left: null,\n    top: null,\n    width: null,\n    height: null,\n    borderDebug: false,\n    classes: '',\n  };\n  const options = joinObjects(defaultOptions, optionsIn);\n\n  let leftMargin = '';\n  let topMargin = '';\n  let width = '';\n  let height = '';\n  let border = '';\n  let classes = '';\n  if (options.left != null) {\n    leftMargin = `margin-left:${options.left}%;`;\n  }\n  if (options.top != null) {\n    topMargin = `margin-top:${options.top}%;`;\n  }\n  if (options.left != null) {\n    width = `width:${options.width}%;`;\n  }\n  if (options.left != null) {\n    height = `height:${options.height}%;`;\n  }\n  if (options.borderDebug) {\n    border = 'border-style:solid;border-width:1px;border-color:red;';\n  }\n  if (options.classes) {\n    classes = ` class=\"${options.classes}\"`;\n  }\n\n  let elementsToUse;\n  if (Array.isArray(options.element)) {\n    elementsToUse = options.element;\n  } else {\n    elementsToUse = [options.element];\n  }\n  elementsToUse.forEach((element) => {\n    // eslint-disable-next-line no-param-reassign\n    element.tieToHTML.element = options.id;\n    // eslint-disable-next-line no-param-reassign\n    element.tieToHTML.scale = options.scale;\n    if (options.window != null) {\n      if (Array.isArray(options.window)) {\n        // eslint-disable-next-line no-param-reassign\n        element.tieToHTML.window = new Rect(\n          options.window[0], options.window[1],\n          options.window[2], options.window[3],\n        );\n      } else {\n        // eslint-disable-next-line no-param-reassign\n        element.tieToHTML.window = options.window;\n      }\n    }\n  });\n  return `<div id=\"${options.id}\" style=\"${width}${height}${topMargin}${leftMargin}${border}\"${classes}></div>`;\n}\n\nexport {\n  Section, PresentationLessonContent, diagramCanvas, initializeItemSelector,\n  applyModifiers, interactiveItem, infoList, makeFig,\n};\n","// @flow\n// import Fig from 'figureone';\n// import SimpleLessonContent from './SimpleLessonContent';\n// import { PresentationLessonContent } from './PresentationLessonContent';\n// import Diagram from '../diagram/Diagram';\n\n// const { Diagram } = Fig;\n\nclass SimpleLesson {\n  content: Object;\n  type: 'simple' | 'singlePage' | 'presentation' | 'links';\n\n  constructor(content: Object) {\n    this.content = content;\n    this.type = 'simple';\n  }\n\n  initialize() {\n    this.content.initialize();\n  }\n}\n\nexport default SimpleLesson;\n","// @flow\nimport Fig from 'figureone';\nimport { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n// import getLessonIndex from '../../Lessons/LessonsCommon/lessonindex';\nimport { loadRemote, loadRemoteCSS } from '../tools/misc';\n\nconst {\n  Diagram,\n  // Transform,\n  Rect,\n} = Fig;\n\n\nclass SimpleLessonContent {\n  title: string;\n  sections: Array<Object>;\n  iconLink: string;\n  iconLinkGrey: string;\n  htmlId: string;\n  key: number;\n  qrDiagram: Object;\n  diagram: Object;\n\n  constructor(htmlId: string = 'lesson__content') {\n    this.htmlId = htmlId;\n    this.sections = [];\n    this.iconLink = '/';\n    this.iconLinkGrey = '/';\n    this.setTitle();\n    this.key = 0;\n  }\n\n  initialize() {\n    this.setContent();\n  }\n\n  setTitle() {\n    this.title = '';\n  }\n\n  // eslint-disable-next-line class-methods-use-this, no-unused-vars\n  setContent() {\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  loadQR(qr: string, path: string) {\n    const link = `/qr/${path}`;\n    fetchPolyfill(link, { credentials: 'same-origin' })\n      .then((response) => {\n        if (!response.ok) {\n          throw Error(response.statusText);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        if (data.status === 'ok') {\n          const jsFile = `/static/dist/${path}/${data.js}`;\n          const cssFile = `/static/dist/${path}/${data.css}`;\n          loadRemoteCSS(`${qr}CSS`, cssFile, () => {\n            loadRemote(`${qr}Script`, jsFile, () => {\n            });\n          });\n        }\n      })\n      .catch(() => {});\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  loadQRs(\n    qrs: Array<string>,\n  ) {\n    qrs.forEach((qr) => {\n      const splitQR = qr.replace(/^\\//, '').replace(/\\/$/, '').split('/');\n      const versionUID = splitQR.slice(-1)[0];\n      const lessonUID = splitQR.slice(-2, -1)[0];\n      const path = splitQR.slice(0, -2).join('/');\n      this.loadQR(qr, `Lessons/${path}/${lessonUID}/quickReference/${versionUID}`);\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  prepareToShowQR() {\n    // this.qrDiagram.container.style.zIndex = '10';\n    const overlay = document.getElementById('simple_lesson__qr__overlay');\n    if (overlay != null) {\n      overlay.style.zIndex = '10';\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  prepareToHideQR() {\n    const overlay = document.getElementById('simple_lesson__qr__overlay');\n    if (overlay != null) {\n      overlay.style.zIndex = '-1';\n    }\n  }\n\n\n  showQR(\n    qrPath: string,\n    qrid: string,\n  ) {\n    const qr = document.getElementById('id_lesson__qr__content_pres');\n    if (qr != null) {\n      qr.classList.remove('lesson__hide');\n    }\n    if (this.qrDiagram == null) {\n      this.qrDiagram = new Diagram({\n        htmlId: 'id_qr_diagram',\n        // limits: this.diagram.limits,\n        limits: new Rect(-3, -2, 6, 4),\n        updateFontSize: true,\n      });\n    }\n    // this.qrDiagram.updateFontSize = false;\n    this.prepareToShowQR();\n\n    // const [uid, versionUid] = combinedUid.split('/');\n    const collection = new window.quickReference[`${qrPath}/${qrid}`](this.qrDiagram);\n    if (collection != null) {\n      this.qrDiagram.elements.hide();\n      this.qrDiagram.resize();\n      this.qrDiagram.clearContext();\n      this.qrDiagram.setElementsToCollection(collection);\n      this.qrDiagram.elements.show();\n      this.qrDiagram.elements.prepareToHideAll = this.prepareToHideQR.bind(this);\n      this.qrDiagram.animateNextFrame();\n    }\n  }\n}\n\nexport default SimpleLessonContent;\n","// @flow\nimport Fig from 'figureone';\nimport { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n\nconst { Point } = Fig;\n\nexport type TypeLessonDescription = {\n  title: string;\n  path: string;\n  imgLink: string;\n  location: Point;\n  id: string;\n  uid: string;\n  dependencies: Array<string>;\n  enabled: boolean;\n  qr: Array<string>;\n  versions: {[vuid: string]: {\n    title: string;\n    description: string;\n    onPath: boolean;\n    topics: Array<string>;\n    qr: Array<string>;\n  }};\n  topics: {\n    [versionName: string]: {\n      title: string;\n      description: string;\n      onPath: boolean;\n      qr: Array<string>;\n      path: string,\n      aveRating: number;\n      numRatings: number;\n      numHighRatings: number;\n    };\n  };\n  numVersions: number;\n  callbackCount: number;\n  getRatings: (Function) => {};\n};\n\nexport default class LessonDescription {\n  title: string;\n  path: string;\n  imgLink: string;\n  imgLinkSelected: string;\n  imgLinkDisabled: string;\n  location: Point;\n  id: string;\n  uid: string;\n  dependencies: Array<string>;\n  topics: {\n    [topicName: string]: Array<{\n      title: string,\n      description: string,\n      uid: string,\n      fullLesson: boolean,\n      type: 'presentation' | 'singlePage' | 'video' | 'audio' | 'generic',\n      aveRating: number;\n      numRatings: number;\n      numHighRatings: number;\n    }>\n  };\n\n  // versions: {[vuid: string]: {\n  //   title: string;\n  //   description: string;\n  //   onPath: boolean;\n  //   topics: Array<string>;\n  //   qr: Array<string>;\n  //   path: string,\n  // }};\n\n  topics: Object;\n  // topics: {\n  //   [versionName: string]: {\n  //     title: string;\n  //     description: string;\n  //     onPath: boolean;\n  //     qr: Array<string>;\n  //     path: string;\n  //     aveRating: number;\n  //     numRatings: number;\n  //     numHighRatings: number;\n  //   };\n  // };\n\n  numVersions: number;\n  callbackCount: number;\n\n  enabled: boolean;\n  qr: Array<string>;\n\n  constructor(\n    lesson: {\n      title: string,\n      path: string,\n      uid: string,\n      topics: {\n        [topicName: string]: Array<{\n          title: string,\n          description: string,\n          uid: string,\n          fullLesson: boolean,\n          type: 'presentation' | 'singlePage' | 'video' | 'audio',\n        }>\n      },\n      dependencies: Array<string>,\n      enabled: boolean;\n    },\n    id: string = '',\n  ) {\n    this.title = lesson.title;\n    this.path = lesson.path;\n    this.uid = lesson.uid;\n    this.dependencies = lesson.dependencies;\n    this.location = new Point(0, 0);\n    this.id = id;\n    this.imgLink = `${this.path}/${this.uid}/tile.svg`;\n    this.imgLinkSelected = `${this.path}/${this.uid}/tile_ffffff.svg`;\n    this.imgLinkDisabled = `${this.path}/${this.uid}/tile_aaaaaa.svg`;\n    if (id === '') {\n      this.id = `id_lesson__navigator_tile_${lesson.uid}`;\n    }\n    // this.topics = {};\n    // Object.keys(lesson.topics).forEach((topic) => {\n    //   this.topics[topic] = lesson.topics[topic];\n    // });\n    this.topics = lesson.topics;\n\n    // this.versions = {};       // Deprecate\n    // Object.keys(lesson.versions).forEach((key) => {\n    //   const version = lesson.versions[key];\n    //   const {\n    //     title, description, onPath, topics, qr, path,\n    //   } = version;\n    //   this.versions[key] = {\n    //     title, description, onPath, topics, qr, path,\n    //   };\n    // });\n    this.enabled = lesson.enabled;\n\n    // this.topics = {};\n    // this.numVersions = 0;\n    // this.callbackCount = 0;\n    // Object.keys(lesson.versions).forEach((versionName) => {\n    //   const version = lesson.versions[versionName];\n    //   const {\n    //     title, description, onPath, topics, qr, path,\n    //   } = version;\n    //   topics.forEach((topicName) => {\n    //     const v = {\n    //       title,\n    //       description,\n    //       onPath,\n    //       qr,\n    //       path,\n    //       aveRating: 0,\n    //       numRatings: 0,\n    //       numHighRatings: 0,\n    //     };\n\n    //     if (this.topics[topicName] == null) {   // $FlowFixMe\n    //       this.topics[topicName] = {};\n    //     }\n    //     this.topics[topicName][versionName] = v;\n    //     this.numVersions += 1;\n    //   });\n    // });\n  }\n\n  waitThenCallback(callback: Function) {\n    this.callbackCount += 1;\n    if (this.callbackCount === this.numVersions) {\n      callback();\n    }\n  }\n\n  getRatings(callback: Function) {\n    this.callbackCount = 0;\n    this.numVersions = 0;\n    Object.keys(this.topics).forEach((topicName) => {\n      const topic = this.topics[topicName];\n      this.numVersions += Object.keys(topic).length;\n      Object.keys(topic).forEach((versionUID) => {\n        const version = topic[versionUID];\n        const link = `/rating/${this.uid}/${topicName}/${versionUID}`;\n        fetchPolyfill(link, { credentials: 'same-origin' })\n          .then((response) => {\n            if (!response.ok) {\n              this.waitThenCallback(callback);\n              throw Error(response.statusText);\n            }\n            return response.json();\n          })\n          .then((data: {\n            status: 'ok' | 'fail',\n            message?: string,\n            userRating?: number,\n            aveRating?: number,\n            numRatings?: number,\n            numHighRatings: number,\n          }) => {\n            if (data.status === 'ok') {\n              version.aveRating = data.aveRating;\n              version.numRatings = data.numRatings;\n              version.numHighRatings = data.numHighRatings;\n              version.userRating = data.userRating;\n            }\n            this.waitThenCallback(callback);\n          })\n          .catch(() => {\n            this.waitThenCallback(callback);\n          });\n      });\n    });\n  }\n}\n\n","// @flow\nimport getLessonIndex from '../../Lessons/LessonsCommon/lessonindex';\nimport type { TypeLessonDescription } from './lessonDescription';\n// first array of arrays: all uids with no dependencies\n// second array of arrays: all uids with dependencies alreay in the done list\n\nfunction splitIndexIntoLearningPaths(\n  lessonIndex: { [uid: string]: TypeLessonDescription },\n  pathDepth: number = 3,\n) {\n  const learningPaths = {};\n  Object.keys(lessonIndex).forEach((key) => {\n    const lesson = lessonIndex[key];\n    const fullPath = lesson.path.split('/');\n    const name = fullPath[pathDepth];\n    const path = fullPath.slice(0, pathDepth + 1).join('/');\n    if (!(name in learningPaths)) {\n      learningPaths[name] = {\n        path,\n        lessons: [],\n        name: name.replace(/_/, ' '),\n      };\n    }\n    learningPaths[name].lessons.push(lesson);\n  });\n  return learningPaths;\n}\n\nexport default function makeLessonTree() {\n  const lessonIndex = getLessonIndex();\n  const lessonLearningPaths = splitIndexIntoLearningPaths(lessonIndex);\n  const lessonTrees = {};\n  Object.keys(lessonLearningPaths).forEach((learningPath) => {\n    const { lessons } = lessonLearningPaths[learningPath];\n    const lessonTree = [];\n    const remainingUIDs = {};\n    let existingUIDs = {};\n    const allUIDs = [];\n    lessons.forEach((lesson) => {\n      remainingUIDs[lesson.uid] = lesson;\n      allUIDs.push(lesson.uid);\n    });\n    let index = 0;\n    const max = lessons.length;\n    while (Object.keys(remainingUIDs).length > 0 && index < max) {\n      const lessonTreeNode = [];\n      const newExisting = {};\n      // eslint-disable-next-line no-loop-func\n      Object.keys(remainingUIDs).forEach((uid) => {\n        const lesson = remainingUIDs[uid];\n        let canAddToExisting = true;\n        lesson.dependencies.forEach((dependency) => {\n          if (!(dependency in existingUIDs) && (allUIDs.indexOf(dependency) > -1)) {\n            canAddToExisting = false;\n          }\n        });\n        if (canAddToExisting) {\n          newExisting[uid] = uid;\n          lessonTreeNode.push(lesson);\n          delete remainingUIDs[uid];\n        }\n      });\n      existingUIDs = Object.assign(newExisting, existingUIDs);\n      lessonTree.push(lessonTreeNode);\n      index += 1;\n    }\n    lessonTrees[learningPath] = {\n      tree: lessonTree,\n      name: lessonLearningPaths[learningPath].name,\n      path: lessonLearningPaths[learningPath].path,\n    };\n  });\n  return lessonTrees;\n}\n","// @flow\nimport * as React from 'react';\nimport { classify } from '../tools/misc';\n\ntype Props = {\n  label?: string,\n  href?: string,\n  className?: string,\n  children?: React.Node,\n};\n\nexport default class Button extends React.Component\n                                    <Props> {\n  render() {\n    // const props = Object.assign({}, this.props);\n    const { props } = this;\n    const Tag = props.href ? 'a' : 'button';\n    const label = props.label || props.children || '';\n    const className = classify('btn', props.className || '');\n    // delete props.label;\n\n    return <Tag {...props} className={className}>\n      {label}\n    </Tag>;\n\n    //   if (props.href != null) {\n    //     return <a href={props.href} className={className}>\n    //       {label}\n    //     </a>;\n    //   }\n\n    //   return <button className={className}>\n    //     {label}\n    //   </button>;\n  }\n}\n","// @flow\n// import Fig from 'figureone';\nimport * as React from 'react';\nimport DropDownButtonBase from './dropDownButtonBase';\n\nexport type TypeDropDownListItem = {\n  label: string | React.Element<'div'>;\n  link?: Function | string;\n  active?: boolean;\n};\n\ntype Props = {\n  label?: string | React.Element<'div'>;\n  id?: string;\n  direction?: 'up' | 'down';\n  xAlign?: 'left' | 'right' | 'center';\n  list?: Array<TypeDropDownListItem>;\n  selected?: boolean;\n};\n\nexport default class DropDownButton extends React.Component <Props> {\n  render() {\n    // const props = Object.assign({}, this.props);\n    const { props } = this;\n    const listItems = [];\n    if (props.list != null) {\n      props.list.forEach((listElement) => {\n        listItems.push({\n          label: listElement.label,\n          link: listElement.link,\n          active: listElement.active,\n        });\n      });\n    }\n    return <DropDownButtonBase\n      label={props.label}\n      id={props.id}\n      direction={props.direction}\n      xAlign={props.xAlign}\n      list={listItems}\n      selected={props.selected}\n    />;\n    // const label = props.label || '';\n    // this.xAlign = props.xAlign || 'left';\n    // this.direction = props.direction || 'down';\n    // let arrowDirectionClass = ' dropdown_button_arrow_down';\n    // if (this.direction === 'up') {\n    //   arrowDirectionClass = ' dropdown_button_arrow_up';\n    // }\n    // let buttonClasses = 'dropdown_button_container';\n    // if (props.selected != null && props.selected === true) {\n    //   buttonClasses = `${buttonClasses} dropdown_button_selected`;\n    // }\n\n    // this.id = props.id || generateUniqueId('id__dropdown_button');\n    // const listContent = [];\n    // props.list.forEach((listItem, index) => {\n    //   let classes = '';\n    //   if (listItem.active) {\n    //     classes = `${classes} dropdown_button_list_item_active`;\n    //   }\n    //   if (listItem.separator) {\n    //     classes = `${classes} dropdown_button_list_item_separator`;\n    //   }\n    //   if (listItem.link == null) {\n    //     classes = `${classes} dropdown_button_list_item_disabled`;\n    //   }\n\n    //   let item;\n    //   if (listItem.link != null) {\n    //     let linkRedirect = listItem.link;\n    //     if (typeof listItem.link === 'string') {\n    //       linkRedirect = () => {\n    //         window.location = listItem.link;\n    //       };\n    //     }\n    //     const closeThenRedirect = () => {\n    //       this.close();\n    //       if (linkRedirect != null && typeof linkRedirect === 'function') {\n    //         linkRedirect();\n    //       }\n    //     };\n    //     item = <div onClick={closeThenRedirect}>\n    //       {this.renderListLabel(listItem)}\n    //       </div>;\n    //   } else {\n    //     item = <div>{this.renderListLabel(listItem)}</div>;\n    //   }\n    //   if (item != null) {\n    //     listContent.push(\n    //       <div className={`dropdown_button_list_item${classes}`}\n    //            key={index}>\n    //         {item}\n    //       </div>,\n    //     );\n    //   }\n    // });\n\n    // return <div className={buttonClasses}\n    //   id={`${this.id}`}>\n    //   <div className=\"dropdown_button_label_container\"\n    //        id={`${this.id}_label`}>\n    //     <div className=\"dropdown_button_label\">\n    //       {label}\n    //     </div>\n    //     <div className={`dropdown_button_arrow${arrowDirectionClass}`}>\n    //     </div>\n    //   </div>\n    //   <div className=\"dropdown_button_list dropdown_button_list_hide\"\n    //        id={`${this.id}_list`}>\n    //     {listContent}\n    //   </div>\n    // </div>;\n  }\n}\n","// @flow\nimport Fig from 'figureone';\nimport * as React from 'react';\n\nconst { generateUniqueId } = Fig.tools.misc;\n\ntype Props = {\n  label?: string | React.Element<'div'>;\n  id?: string;\n  direction?: 'up' | 'down';\n  xAlign?: 'left' | 'right' | 'center';\n  list?: Array<{\n    label: React.Element<'div'> | React.Element<'table'> | string,\n    active?: boolean,\n    link?: Function | string,\n    separator?: boolean,\n    }>;\n  selected?: boolean;\n  classes?: string;\n};\n\nexport default class DropDownButtonBase extends React.Component\n                                    <Props> {\n  id: string;\n  buttonElement: HTMLElement;\n  labelElement: HTMLElement;\n  // bodyElement: HTMLElement;\n  itemList: HTMLElement;\n  xAlign: 'left' | 'right' | 'center';\n  direction: 'up' | 'down';\n  constructor(props: Props) {\n    super(props);\n    this.id = '';\n  }\n\n  offButtonEvent(event: MouseEvent | TouchEvent | KeyboardEvent) {\n    if (event.target instanceof HTMLElement) {\n      const parent = event.target.parentElement;\n      if (parent instanceof HTMLElement) {\n        if (event.target !== this.labelElement) {\n          this.close();\n          if (event.target instanceof HTMLElement\n            && parent.parentElement === this.itemList) {\n            event.target.click();\n          }\n        }\n      }\n    }\n  }\n\n  close() {\n    this.itemList.classList.add('dropdown_button_list_hide');\n    this.itemList.style.left = '';\n    this.itemList.style.top = '';\n  }\n\n  toggle() {\n    if (this.itemList.classList.contains('dropdown_button_list_hide')) {\n      this.itemList.style.visibility = 'hidden';\n      // this.itemList.style.top = '-10000px';\n      this.itemList.classList.remove('dropdown_button_list_hide');\n      const rect = this.buttonElement.getBoundingClientRect();\n      const listRect = this.itemList.getBoundingClientRect();\n      // $FlowFixMe\n      const windowWidth = (window.innerWidth || document.documentElement.clientWidth);\n      let left = 0;\n      if (this.direction === 'down') {\n        this.itemList.style.top = `${rect.height}px`;\n      } else {\n        this.itemList.style.top = `${-listRect.height}px`;\n      }\n      if (this.xAlign === 'left') {\n        left = 0;\n      } else if (this.xAlign === 'right') {\n        left = rect.width - listRect.width;\n      } else if (this.xAlign === 'center') {\n        left = rect.width / 2 - listRect.width / 2;\n      }\n      if ((rect.left + left + listRect.width) > windowWidth) {\n        const delta = (rect.left + left + listRect.width) - windowWidth;\n        left -= delta + 5;\n      }\n      this.itemList.style.left = `${left}px`;\n      this.itemList.style.visibility = 'visible';\n    } else {\n      this.itemList.style.left = '';\n      this.itemList.style.top = '';\n      this.itemList.classList.add('dropdown_button_list_hide');\n    }\n  }\n\n  componentDidMount() {\n    const button = document.getElementById(this.id);\n    const label = document.getElementById(`${this.id}_label`);\n    const { body } = document;\n    const itemList = document.getElementById(`${this.id}_list`);\n    if (button != null && body != null && itemList != null && label != null) {\n      this.buttonElement = button;\n      this.labelElement = label;\n      // this.bodyElement = body;\n      this.itemList = itemList;\n      button.addEventListener('mousedown', this.toggle.bind(this));\n      body.addEventListener('mousedown', this.offButtonEvent.bind(this), true);\n      button.addEventListener('keydown', (event: KeyboardEvent) => {\n        if (event.keyCode === 13 || event.keyCode === 32) {\n          this.toggle();\n        }\n      });\n      // button.addEventListener('focusout', () => {\n      //   this.close();\n      // });\n    }\n    window.addEventListener('resize', this.close.bind(this));\n  }\n\n  render() {\n    // const props = Object.assign({}, this.props);\n    const { props } = this;\n    const label = props.label || '';\n    this.xAlign = props.xAlign || 'left';\n    this.direction = props.direction || 'down';\n    let arrowDirectionClass = ' dropdown_button_arrow_down';\n    if (this.direction === 'up') {\n      arrowDirectionClass = ' dropdown_button_arrow_up';\n    }\n    let buttonClasses = 'dropdown_button_container';\n    if (props.selected != null && props.selected === true) {\n      buttonClasses = `${buttonClasses} dropdown_button_selected`;\n    }\n    if (props.classes) {\n      buttonClasses = `${buttonClasses} ${props.classes}`;\n    }\n\n    this.id = props.id || generateUniqueId('id__dropdown_button');\n    const listContent = [];\n    if (props.list != null) {\n      props.list.forEach((listItem, index) => {\n        let classes = '';\n        if (listItem.active) {\n          classes = `${classes} dropdown_button_list_item_active`;\n        }\n        if (listItem.separator) {\n          classes = `${classes} dropdown_button_list_item_separator`;\n        }\n        if (listItem.link == null) {\n          classes = `${classes} dropdown_button_list_item_disabled`;\n        }\n\n        let item;\n        if (listItem.link != null) {\n          let linkRedirect = listItem.link;\n          if (typeof listItem.link === 'string') {\n            linkRedirect = () => {\n              window.location = listItem.link;\n            };\n          }\n          const closeThenRedirect = () => {\n            this.close();\n            if (linkRedirect != null && typeof linkRedirect === 'function') {\n              linkRedirect();\n            }\n          };\n          const keyboardCloseThenRedirect = (event) => {\n            if (event.keyCode === 13 || event.keyCode === 32) {\n              closeThenRedirect();\n            }\n          };\n          item = <div onClick={closeThenRedirect}\n                      tabIndex={0}\n                      role=\"button\"\n                      onKeyDown={keyboardCloseThenRedirect}\n                      className=\"dropdown_button_list_item_link\"\n                      >\n            {listItem.label}\n            </div>;\n        } else {\n          item = <div>{listItem.label}</div>;\n        }\n        if (item != null) {\n          listContent.push(\n            <div className={`dropdown_button_list_item${classes}`}\n                 key={index}>\n              {item}\n            </div>,\n          );\n        }\n      });\n    }\n    return <div className={buttonClasses} tabIndex={0} role=\"button\"\n      id={`${this.id}`}>\n      <div className=\"dropdown_button_label_container\"\n           id={`${this.id}_label`}>\n        <div className=\"dropdown_button_label\">\n          {label}\n        </div>\n        <div className={`dropdown_button_arrow${arrowDirectionClass}`}>\n        </div>\n      </div>\n      <div className=\"dropdown_button_list dropdown_button_list_hide\"\n           id={`${this.id}_list`}>\n        {listContent}\n      </div>\n    </div>;\n  }\n}\n","import * as React from 'react';\n\nexport default class Footer extends React.Component\n                                    <> {\n  // eslint-disable-next-line class-methods-use-this\n  render() {\n    return <div className=\"footer__container\">\n      <div className=\"footer_contact\">\n        <a\n          href=\"mailto:feedback@thisiget.com?Subject=Feedback\"\n          className=\"footer_email\"\n          >\n          feedback@thisiget.com\n        </a>\n      </div>\n    </div>;\n  }\n}\n","// @flow\n\nimport * as React from 'react';\nimport { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n// import '../../css/style.scss';\n// import Lesson from '../Lesson/Lesson';\n\n// import Button from './button';\nimport LessonNavigator from './lessonNavigator';\n// import LessonTilePath from './lessonPathTile';\nimport LessonTitle from './lessonTitle';\nimport getLessonIndex from '../../Lessons/LessonsCommon/lessonindex';\nimport LessonDescription from '../Lesson/lessonDescription';\n// import DropDownButton from './dropDownButton';\nimport TopicButton from './topicButton';\nimport Rating from './rating';\nimport { getCookie, login } from '../tools/misc';\nimport PresentationLessonComponent from './presentationLesson';\nimport SimpleLessonComponent from './simpleLesson';\nimport SinglePageLessonComponent from './singlePageLesson';\nimport LinksLessonComponent from './linksLesson';\n\ntype Props = {\n  lesson: Object;\n  // lessonUID: string,\n  // topicName: string,\n  // versionUID: string,\n  // lessonDetails: {\n  //   uid: string,\n  //   title: string,\n  //   dependencies: Array<string>,\n  //   enabled?: boolean,\n  // },\n  // versionDetails: {\n  //   uid: string,\n  //   topic: string,\n  //   title: string,\n  //   description: string,\n  //   fullLesson: boolean,\n  //   type: 'presentation' | 'singlePage' | 'generic',\n  // },\n  isLoggedIn: boolean;\n};\n\ntype State = {\n  userRating: number;\n  ratings: {\n    [topicName: string]: {\n      [versionName: string]: {\n        aveRating: number,\n        numRatings: number,\n        numHighRatings: number,\n        userRating: number,\n      },\n    }\n  },\n};\n\nfunction getLessonDescription(uid: string) {\n  const lessons = getLessonIndex();\n  return lessons[uid];\n}\n\nexport default class LessonComponent extends React.Component\n                                    <Props, State> {\n  lesson: Object;\n  lessonDetails: Object;\n  key: number;\n  state: State;\n  // diagrams: Object;\n  componentUpdateCallback: ?() => void;\n  centerLessonFlag: boolean;\n  lessonNavigator: ?LessonNavigator;\n  showNavigator: boolean;\n  lessonDescription: null | LessonDescription;\n  versionDetails: Object;\n  topic: string;\n  firstPage: number;\n  lessonUID: string;\n  versionUID: string;\n\n  constructor(props: Props) {\n    super(props);\n    this.lesson = props.lesson;\n    const path = window.location.pathname.replace(/\\/$/, '').split('/');\n    // const lessonUID = path.slice(-3, -2)[0];\n    // const topic = path.slice(-2, -1)[0];\n    // const versionUID = path.slice(-1)[0];\n    // this.lessonDetails = props.lessonDetails;\n    /* eslint-disable prefer-destructuring */\n    this.lessonUID = path.slice(-3, -2)[0];\n    this.versionUID = path.slice(-1)[0];\n    this.topic = path.slice(-2, -1)[0];\n    /* eslint-enable */\n    this.lessonDescription = getLessonDescription(this.lessonUID);\n    this.state = {\n      userRating: 0,\n      ratings: this.fillRatings(),\n    };\n    // this.versionDetails = props.versionDetails;\n    // const [topic] = window.location.pathname.split('/').slice(-2, -1);\n    // this.topic = topic;\n    this.key = 0;\n    this.showNavigator = false;\n    this.getRating(this.topic);\n    if (this.lessonDescription != null) {\n      this.lessonDescription.getRatings(this.gotRatings.bind(this));\n    }\n  }\n\n  fillRatings() {\n    const { lessonDescription } = this;\n    if (lessonDescription != null) {\n      const ratings = {};\n      Object.keys(lessonDescription.topics).forEach((topicName) => {\n        const topic = lessonDescription.topics[topicName];\n        if (!(topicName in ratings)) {\n          ratings[topicName] = {};\n        }\n        Object.keys(topic).forEach((versionUID) => {\n          const version = topic[versionUID];\n          ratings[topicName][versionUID] = {\n            aveRating: version.aveRating,\n            numRatings: version.numRatings,\n            numHighRatings: version.numHighRatings,\n            userRating: version.userRating,\n          };\n        });\n      });\n      return ratings;\n    }\n    return {};\n  }\n\n  gotRatings() {\n    this.setState({ ratings: this.fillRatings() });\n  }\n\n  getRating(topic: string) {\n    // const lessonUid = this.lessonDetails.details.uid;\n    // const versionUid = this.versionDetails.details.uid;\n    const link = `/rating/${this.lessonUID}/${topic}/${this.versionUID}`;\n    fetchPolyfill(link, { credentials: 'same-origin' })\n      .then((response) => {\n        if (!response.ok) {\n          throw Error(response.statusText);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        if (data.status === 'ok') {\n          if (data.userRating\n            && data.userRating !== 'not rated'\n            && data.userRating !== 'not logged in'\n          ) {\n            // this.setUserRating(data.userRating);\n            this.setState({ userRating: data.userRating });\n          }\n        }\n      })\n      .catch(() => {});\n  }\n\n  setUserRating(rating: number) {\n    const { cookie } = document;\n    if (cookie != null) {\n      const username = cookie.match(/username=[^;]*;/);\n      if (username != null) {\n        if (username[0].split('=')[1].slice(0, -1) === '') {\n          return;\n        }\n      }\n    }\n    const page = parseInt(getCookie('page'), 10) - 1 || 0;\n\n    const link = `/rate/${this.lessonUID}/${this.topic}/${this.versionUID}/${rating}?page=${page + 1};pages=${this.lesson.content.sections.length}`;\n    fetchPolyfill(link, { credentials: 'same-origin' })\n      .then((response) => {\n        if (!response.ok) {\n          throw Error(response.statusText);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        if (data.status === 'done') {\n          this.setState({ userRating: rating });\n        } else {\n          // console.log('failed to set rating:', data.message);\n        }\n      })\n      .catch(() => {});\n  }\n\n  renderTitle(title: string) {\n    this.key += 1;\n    return <div className='lesson__title' key={this.key}>\n        {title}\n      </div>;\n  }\n\n  titleAsTile() {\n    return <div id=\"id_lesson__title_tile\" className=\"lesson__title_tile\">\n      <img src={'/static/'} className=\"navigator__lesson_tile_image\" />\n      <div className=\"lesson__title_tile_containter lesson__title_tile_shadow\">\n        <div className=\"lesson__title_tile_title\">\n          {this.lesson.content.title}\n        </div>\n      </div>\n    </div>;\n  }\n\n  calcTitleHeight() {\n    const { lessonDescription } = this;\n    let count = 0;\n    if (lessonDescription != null) {\n      // count = lessonDescription.paths.length;\n      count = 9;\n    }\n    if (count === 1) {\n      return ' lesson__title_bar_force_low';\n    }\n    if (count > 8) {\n      return ' lesson__title_bar_force_high';\n    }\n    return '';\n  }\n\n  getTopics() {\n    const topics = {};\n    // const [currentTopic, currentVersion] = window.location.href.split('/').slice(-2);\n\n    const { lessonDescription } = this;\n    if (lessonDescription != null) {\n      Object.keys(this.state.ratings).forEach((topicName) => {\n        const topic = this.state.ratings[topicName];\n        Object.keys(topic).forEach((versionUID) => {\n          const version = lessonDescription.topics[topicName][versionUID];\n          const label = version.title;\n          let link = `${lessonDescription.path}/${lessonDescription.uid}/${topicName}/${versionUID}`;\n          if (topicName === 'dev') {\n            link = `/dev${lessonDescription.path}/${lessonDescription.uid}/quickReference/${versionUID}`;\n          }\n          // const { description } = version;\n          const { fullLesson } = version;\n          const { type } = version;\n          const rating = this.state.ratings[topicName][versionUID];\n          let { userRating } = rating;\n\n          if (!(topicName in topics)) {\n            topics[topicName] = {};\n          }\n          let active = false;\n          // console.log(currentExplanation, version, topic)\n          if (this.versionUID === versionUID\n            && this.topic === topicName) {\n            active = true;\n            ({ userRating } = this.state);\n          }\n          topics[topicName][versionUID] = {\n            label,\n            link,\n            userRating,\n            rating: rating.aveRating,\n            numReviews: rating.numRatings,\n            numHighRatings: rating.numHighRatings,\n            description: '',\n            active,\n            fullLesson,\n            type,\n          };\n        });\n      });\n    }\n    return topics;\n  }\n\n  addTopics() {\n    const output = [];\n    const topics = this.getTopics();\n    const topicNames = [\n      'summary', 'explanation', 'implications', 'history',\n      'references', 'quiz',\n    ];\n    Object.keys(topics).forEach((topicName) => {\n      if (topicNames.indexOf(topicName) === -1) {\n        topicNames.push(topicName);\n      }\n    });\n    // const currentTopic = window.location.href.split('/').slice(-2, -1)[0];\n    topicNames.forEach((name) => {\n      if (topics[name] != null && name !== 'quickReference') {\n        const topic = topics[name];\n        // $FlowFixMe - onPath is there and boolean\n        const fullLessonCount = Object.keys(topic).filter(ver => topic[ver].fullLesson).length;\n        // $FlowFixMe - onPath is there and boolean\n        const partialLessonCount = Object.keys(topic).filter(ver => !topic[ver].fullLesson).length;\n        let selected = false;\n        if (this.topic === name) {\n          selected = true;\n        }\n        let vUIDs = Object.keys(topic);\n        vUIDs = vUIDs.sort((aKey, bKey) => {\n          const a = topic[aKey];\n          const b = topic[bKey];\n          if (a.rating < b.rating) { return 1; }\n          if (a.rating > b.rating) { return -1; }\n          if (a.numReviews < b.numReviews) { return 1; }\n          if (a.numReviews > b.numReviews) { return -1; }\n          const labelA = a.label.toUpperCase();\n          const labelB = b.label.toUpperCase();\n          if (labelA > labelB) { return 1; }\n          if (labelA < labelB) { return -1; }\n          return 0;\n        });\n        vUIDs = vUIDs.sort((aKey, bKey) => {\n          const a = topic[aKey];\n          const b = topic[bKey];\n          if (a.fullLesson === true && b.fullLesson === false) { return -1; }\n          if (a.fullLesson === false && b.fullLesson === true) { return 1; }\n          return 0;\n        });\n        const listItems = [];\n        vUIDs.forEach((vUID) => {\n          listItems.push(topic[vUID]);\n          if (name === 'quickReference') {\n            listItems.slice(-1)[0].label = vUID;\n          }\n        });\n        this.key += 1;\n        if (partialLessonCount > 0 && name === 'explanation') {\n          listItems.splice(fullLessonCount, 0, {\n            label: <div className=\"topic_button__portion_separator\">\n              <div className=\"topic_button__portion_separator_label\">\n                {'Portion of Lesson'}\n              </div>\n            </div>,\n            separator: true,\n          });\n          listItems.splice(0, 0, {\n            label: <div className=\"topic_button__portion_separator\">\n              <div className=\"topic_button__portion_separator_label\">\n                {'Full Lesson'}\n              </div>\n            </div>,\n            separator: true,\n          });\n        }\n        if (listItems.length === 1) {\n          let singleItemClass = 'dropdown_button_container';\n          if (selected) {\n            singleItemClass = `${singleItemClass} dropdown_button_selected`;\n          }\n          output.push(\n            <div className=\"lesson__path_tile\" key={this.key}>\n              <div className={singleItemClass}>\n                <a href={listItems[0].link || '/'}\n                  className = \"topic_button__single_item_label\">\n                  {name.charAt(0).toUpperCase() + name.slice(1)}\n                </a>\n              </div>\n            </div>,\n          );\n        } else {\n          output.push(\n            <div className=\"lesson__path_tile\" key={this.key}>\n              <TopicButton\n                id={`id__lesson__topic_button_${name}`}\n                label={name.charAt(0).toUpperCase() + name.slice(1)}\n                direction=\"down\"\n                xAlign=\"left\"\n                selected={selected}\n                list={listItems}/>\n            </div>,\n          );\n        }\n      }\n    });\n    return output;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getTopic() {\n    // const topicName = window.location.href.split('/').slice(-2, -1)[0];\n    return this.topic.charAt(0).toUpperCase() + this.topic.slice(1);\n  }\n\n  renderLesson() {\n    if (this.lesson.type === 'presentation') {\n      return <PresentationLessonComponent\n        lesson={this.lesson}\n      />;\n    }\n    if (this.lesson.type === 'singlePage') {\n      return <SinglePageLessonComponent\n        lesson={this.lesson}\n      />;\n    }\n    if (this.lesson.type === 'links') {\n      return <LinksLessonComponent\n        lesson={this.lesson}\n        isLoggedIn={this.props.isLoggedIn}\n      />;\n    }\n    return <SimpleLessonComponent\n      lesson={this.lesson}\n    />;\n  }\n\n  ratingLabel() {\n    const topicName = this.topic.charAt(0).toUpperCase() + this.topic.slice(1);\n    if (this.props.isLoggedIn) {\n      if (this.lesson.type === 'links') {\n        return 'Are these links helpful?';\n      }\n      return `Is this ${topicName} helpful?`;\n    }\n    return <div>\n      <span className=\"rating__login\" onClick={login}>Login</span> to rate {topicName}:\n    </div>;\n  }\n\n  render() {\n    // console.log(`${window.location.pathname}/tile.svg`)\n    let path = window.location.pathname.replace(/\\/$/, '').split('/').slice(0, -2);\n    if (path[1] === 'dev') {\n      path = ['', ...window.location.pathname.replace(/\\/$/, '').split('/').slice(2, -2)];\n    }\n    const imgLink = `/static/dist${path.join('/')}/tile.svg`;\n    return <div>\n      <div className={`lesson__title_bar${this.calcTitleHeight()}`}>\n        <LessonTitle\n          // imgLink={`${this.lesson.content.iconLinkGrey}`}\n          imgLink={imgLink}\n          // imgLink={`${window.location.pathname}/tile.svg`}\n          // imgLink={`${this.lesson.lessonDetails.imgLink}`}\n          key='1'\n          label={this.lesson.content.title}\n          />\n        <div className=\"lesson__path_container\">\n          <div className=\"lesson__path_mid_tiles\">\n            {this.addTopics()}\n          </div>\n        </div>\n        <Rating\n          topic={this.topic}\n          rating={this.state.userRating}\n          ratingCallback={this.setUserRating.bind(this)}\n          isLoggedIn={this.props.isLoggedIn}\n          label={this.ratingLabel()}\n        />\n      </div>\n      {this.renderLesson()}\n      <div className='lesson__white_spacer'/>\n      <LessonNavigator\n          selected={this.lesson.content.title}\n          learningPath={'Geometry_1'}\n          ref={(lessonNavigator) => { this.lessonNavigator = lessonNavigator; }}\n        />\n      <div className='lesson__white_spacer'/>\n    </div>;\n  }\n}\n","// @flow\nimport * as React from 'react';\nimport Fig from 'figureone';\n// import '../../css/style.scss';\nimport LessonTile from './lessonTile';\nimport LessonDescription from '../Lesson/lessonDescription';\nimport makeLessonTree from '../Lesson/lessonTree';\n\nconst { Point, Rect } = Fig;\nconst { getDefinedCSSVariables } = Fig.tools.css;\n\ntype Props = {\n  learningPath: string;\n  selected?: ?string;\n};\n\nexport default class LessonNavigator extends React.Component\n                                    <Props> {\n  selected: string;\n  lessonIndex: Array<Array<LessonDescription>>;\n  lessonTrees: Object;\n  key: number;\n  selectedLesson: LessonDescription;\n  lessonArray: Array<LessonDescription>;\n  asTitle: boolean\n  lessonTilesBounds: Rect;\n  tileWidth: number;\n  tileHeight: number;\n  tileVSpace: number;\n  tileHSpace: number;\n  learningPath: string;\n  learningPathPath: string;\n  learningPathName: string;\n\n  constructor(props: Props) {\n    super(props);\n    this.lessonTrees = makeLessonTree();\n    this.lessonIndex = this.lessonTrees[props.learningPath].tree;\n    this.learningPathPath = this.lessonTrees[props.learningPath].path;\n    this.learningPathName = this.lessonTrees[props.learningPath].name;\n    this.getVariables();\n    this.layoutLessonTiles();\n    this.key = 0;\n    this.selected = props.selected || '';\n    this.asTitle = false;\n    if (this.selected !== '') {\n      this.asTitle = true;\n    }\n    this.learningPath = props.learningPath;\n  }\n\n  getVariables() {\n    const { body } = document;\n    if (body) {\n      const vars: Object = getDefinedCSSVariables(\n        body,\n        [\n          '--navigator__tile_width',\n          '--navigator__tile_height',\n          '--navigator__tile_vSpace',\n          '--navigator__tile_hSpace',\n        ],\n        '--navigator__',\n      );\n      this.tileWidth = vars.tileWidth;\n      this.tileHeight = vars.tileHeight;\n      this.tileVSpace = vars.tileVSpace;\n      this.tileHSpace = vars.tileHSpace;\n    }\n  }\n\n  layoutLessonTiles() {\n    this.lessonArray = [];\n    // const y = this.tileHeight * 2 + vSpace * 2;\n    const width = this.tileWidth;\n    const height = this.tileHeight;\n    const vSpace = this.tileVSpace;\n    const hSpace = this.tileHSpace;\n    let x = hSpace;\n    this.lessonArray = [];\n    let maxParallel = 1;\n    this.lessonIndex.forEach((lesson) => {\n      if (Array.isArray(lesson)) {\n        if (lesson.length > maxParallel) {\n          maxParallel = lesson.length;\n        }\n      }\n    });\n    const yMiddle = (maxParallel * this.tileHeight\n                    + (maxParallel - 1) * vSpace\n                    + vSpace * 2) / 2;\n\n    this.lessonIndex.forEach((lesson) => {\n      if (Array.isArray(lesson)) {\n        const len = lesson.length;\n        const totalHeight = len * height + (len - 1) * vSpace;\n        let yStart = yMiddle - totalHeight / 2 + height / 2;\n        if (yStart < yMiddle - 2 * height - 2 * vSpace) {\n          yStart = yMiddle - 2 * height - 2 * vSpace;\n        }\n        lesson.forEach((parallelLesson, index) => {\n          const yLocation = yStart + index * (height + vSpace);\n          // eslint-disable-next-line no-param-reassign\n          parallelLesson.location = new Point(x, yLocation - this.tileHeight / 2);\n          this.lessonArray.push(parallelLesson);\n        });\n      } else {\n        // eslint-disable-next-line no-param-reassign\n        lesson.location = new Point(x, yMiddle - this.tileHeight / 2);\n        this.lessonArray.push(lesson);\n      }\n      x += width + hSpace;\n    });\n\n    this.getLessonTilesBounds();\n  }\n\n  createLessonJsx(lesson: LessonDescription) {\n    this.key += 1;\n    let state = '';\n    const { x, y } = lesson.location;\n    if (lesson.title === this.selected) {\n      state = 'selected';\n      this.selectedLesson = lesson;\n    }\n    let { title } = lesson;\n    if (lesson.enabled === false) {\n      state = 'disabled';\n      title = `${title}`;\n    }\n\n    let linkToUse = '';\n    const topicsOrder = ['explanation', 'summary', 'examples', 'links'];\n    const versionsOrder = ['base', 'static'];\n    const getVersion = (topic) => {\n      const versions = lesson.topics[topic];\n      for (let i = 0; i < versionsOrder.length; i += 1) {\n        const version = versionsOrder[i];\n        if (version in versions) {\n          linkToUse = `${lesson.path}/${lesson.uid}/${topic}/${version}`;\n          return;\n        }\n      }\n      if (linkToUse === '' && Object.keys(versions).length > 0) {\n        linkToUse = `${lesson.path}/${lesson.uid}/${topic}/${Object.keys(versions)[0]}`;\n      }\n    };\n\n    for (let t = 0; t < topicsOrder.length; t += 1) {\n      const topic = topicsOrder[t];\n      if (topic in lesson.topics) {\n        getVersion(topic);\n        if (linkToUse !== '') {\n          break;\n        }\n      }\n    }\n\n    if (linkToUse === '' && Object.keys(lesson.topics).length > 0) {\n      getVersion(Object.keys(lesson.topics)[0]);\n    }\n\n    if (linkToUse === '') {\n      state = 'disabled';\n    }\n\n    return <LessonTile\n              id={lesson.id}\n              link={linkToUse}\n              imgLink={lesson.imgLink}\n              imgLinkSelected={lesson.imgLinkSelected}\n              imgLinkDisabled={lesson.imgLinkDisabled}\n              key={this.key}\n              label={title}\n              state={state}\n              left={`${x}px`}\n              top={`${y}px`}\n              title={false}\n            />;\n  }\n\n  lessons() {\n    const lessons = [];\n    this.lessonIndex.forEach((lesson) => {\n      if (Array.isArray(lesson)) {\n        lesson.forEach((parallelLesson) => {\n          lessons.push(this.createLessonJsx(parallelLesson));\n        });\n      } else {\n        lessons.push(this.createLessonJsx(lesson));\n      }\n    });\n    return lessons;\n  }\n\n  componentDidMount() {\n    this.centerLessons();\n    // window.addEventListener('resize', this.centerLessons.bind(this));\n    this.scrollToSelected();\n  }\n\n  scrollToSelected() {\n    const navScroll = document\n      .getElementById(`id_navigator__scroll_container_${this.learningPath}`);\n    const navigatorContainer = document\n      .getElementById(`id_navigator__container_${this.learningPath}`);\n    if (navScroll != null && navigatorContainer != null) {\n      const navRect = navigatorContainer.getBoundingClientRect();\n      const xMargin = Math.min(\n        this.tileWidth,\n        navRect.width / 2 - this.tileWidth / 2,\n      );\n      const yMargin = (navRect.height - this.lessonTilesBounds.height) / 2;\n      if (this.selected !== '') {\n        navScroll.scrollLeft = this.selectedLesson.location.x + xMargin\n                               - navScroll.clientWidth / 2 + this.tileWidth / 2;\n        navScroll.scrollTop = this.selectedLesson.location.y + yMargin\n                               - navScroll.clientHeight / 2 + this.tileHeight / 2;\n      } else {\n        navScroll.scrollLeft = this.lessonArray[0].location.x + xMargin\n                               - navScroll.clientWidth / 2 + this.tileWidth / 2;\n        navScroll.scrollTop = this.lessonArray[0].location.y + yMargin\n                               - navScroll.clientHeight / 2 + this.tileHeight / 2;\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  centerLessons() {\n    const navigatorContainer = document\n      .getElementById(`id_navigator__container_${this.learningPath}`);\n    const lessonsContainer =\n      document.getElementById(`id_navigator__lessons_positions_container_${this.learningPath}`);\n    if (lessonsContainer != null && navigatorContainer != null) {\n      const navRect = navigatorContainer.getBoundingClientRect();\n      const navHeight = navRect.height;\n      // const xMargin = navRect.width / 2 - this.tileWidth / 2;\n      const xMargin = Math.min(this.tileWidth, navRect.width / 2 - this.tileWidth / 2);\n      lessonsContainer.style.left = `${xMargin}px`;\n      lessonsContainer.style.top = `${(navHeight - this.lessonTilesBounds.height) / 2}px`;\n      lessonsContainer.style.width = `${this.lessonTilesBounds.width + xMargin}px`;\n      lessonsContainer.style.height = `${this.lessonTilesBounds.height}px`;\n    }\n  }\n\n  getLessonTilesBounds() {\n    let xMax = 0;\n    let yMax = 0;\n    let yMin = 0;\n    let xMin = 0;\n    let firstElement = true;\n    this.lessonArray.forEach((lesson) => {\n      if (firstElement) {\n        xMin = lesson.location.x;\n        xMax = lesson.location.x + this.tileWidth;\n        yMin = lesson.location.y;\n        yMax = lesson.location.y + this.tileHeight;\n        firstElement = false;\n      } else {\n        if (lesson.location.x + this.tileWidth > xMax) {\n          xMax = lesson.location.x + this.tileWidth;\n        }\n        if (lesson.location.y + this.tileHeight > yMax) {\n          yMax = lesson.location.y + this.tileHeight;\n        }\n        if (lesson.location.y < yMin) {\n          yMin = lesson.location.y;\n        }\n      }\n    });\n    yMin -= this.tileVSpace;\n    yMax += this.tileVSpace;\n    xMin -= this.tileHSpace;\n    xMax += this.tileHSpace;\n    this.lessonTilesBounds = new Rect(xMin, yMin, xMax - xMin, yMax - yMin);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  render() {\n    const classStr = 'naviagator__container navigator__container_with_shadow';\n    return <div>\n        <div className='navigator__topic_title_subtext'>\n                {'Learning path'}\n        </div>\n        <div className=\"navigator__topic_title_container\">\n          <img src={`/static/dist/${this.learningPathPath}/topic.png`}\n               className=\"navigator__topic_title_img\"\n               alt={`Icon for ${this.learningPathName}`}/>\n          <div className='navigator__topic_title'>\n            <div className='navigator__topic_title_text'>\n              {this.learningPathName}\n            </div>\n          </div>\n        </div>\n        <div id={`id_navigator__container_${this.learningPath}`} className={classStr}>\n        <div className=\"navigator__left_side\" />\n        <div className=\"navigator__right_side\" />\n        <div id={`id_navigator__scroll_container_${this.learningPath}`} className=\"navigator__scroll_container\">\n          <div id={`id_navigator__lessons_positions_container_${this.learningPath}`} className=\"navigator__lessons_positions_container\">\n              {this.lessons()}\n          </div>\n        </div>\n      </div>\n    </div>;\n  }\n}\n","// @flow\n\nimport * as React from 'react';\n// import '../../css/style.scss';\n// import img from '../../tile.png';\n\ntype Props = {\n  label: ?string,\n  id: ?string,\n  left?: ?string,\n  top?: ?string,\n  link: ?string,\n  imgLink: ?string,\n  imgLinkSelected: ?string,\n  imgLinkDisabled: ?string,\n  state: '' | 'disabled' | 'selected',\n  title: ?boolean,\n};\n\nexport default class LessonTile extends React.Component\n                                    <Props> {\n  render() {\n    const { props } = this;\n    let isTitle = false;\n    if (props.title != null) {\n      isTitle = props.title;\n    }\n\n    // const Tag = props.href ? 'a' : 'button';\n    const label = props.label || '';\n    const id = props.id || '';\n    let style = {};\n    if (props.left != null || props.top != null) {\n      const left = props.left || 0;\n      const top = props.top || 0;\n      style = {\n        left,\n        top,\n      };\n    }\n\n    const link = props.link || '/';\n    let classText = 'navigator__lesson_tile_containter navigator__lesson_shadow';\n    if (isTitle) {\n      classText = 'navigator__lesson_tile_containter navigator__lesson_tile_containter_title';\n    }\n    let imgLink = '/static/assets/defaultTile.png';\n    if (props.imgLink != null) {\n      imgLink = `${'/static/dist'}${props.imgLink}`;\n    }\n    if (props.state === 'disabled') {\n      classText = `${classText} navigator__lesson_tile_disabled`;\n      if (props.imgLinkDisabled != null) {\n        imgLink = `${'/static/dist'}${props.imgLinkDisabled}`;\n      }\n    }\n    if (props.state === 'selected') {\n      classText = `${classText} navigator__lesson_tile_selected`;\n      if (props.imgLinkSelected != null) {\n        imgLink = `${'/static/dist'}${props.imgLinkSelected}`;\n      }\n    }\n\n    const content = <div className={classText}>\n        <img src={imgLink} className=\"navigator__lesson_tile_image\" alt={`Icon for ${label}`}/>\n        <div className=\"navigator__lesson_tile_title_container\">\n          <div className=\"navigator__lesson_tile_title\">\n            {label}\n          </div>\n        </div>\n      </div>;\n\n    if (isTitle || props.state === 'disabled') {\n      return <div\n        id={id}\n        style={style}\n        className=\"navigator__lesson_tile\">\n        {content}\n    </div>;\n    }\n    return <a\n        href={link}\n        id={id}\n        style={style}\n        className=\"navigator__lesson_tile\">\n      {content}\n    </a>;\n  }\n}\n","// @flow\n\nimport * as React from 'react';\n// import '../../css/style.scss';\n// import img from '../../tile.png';\n\ntype Props = {\n  label: ?string,\n  imgLink: ?string,\n};\n\nexport default class LessonTitle extends React.Component\n                                    <Props> {\n  render() {\n    // const props = Object.assign({}, this.props);\n    // let isTitle = false;\n    // if (props.title != null) {\n    //   isTitle = props.title;\n    // }\n\n    // const Tag = props.href ? 'a' : 'button';\n    const label = this.props.label || '';\n\n    // const link = props.link || '/';\n    // let classText = 'lesson__title_container';\n    // if (isTitle) {\n    //   classText = 'navigator__lesson_tile_containter navigator__lesson_tile_containter_title';\n    // }\n    // if (props.state === 'disabled') {\n    //   classText = `${classText} navigator__lesson_tile_disabled`;\n    // }\n    // if (props.state === 'selected') {\n    //   classText = `${classText} navigator__lesson_tile_selected`;\n    // }\n    let imgLink = '/static/assets/defaultTile.png';\n    if (this.props.imgLink != null) {\n      imgLink = `${this.props.imgLink}`;\n    }\n    // const content = <div className={classText}>\n    //     <img src={imgLink} className=\"navigator__lesson_tile_image\" />\n    //     <div className=\"navigator__lesson_tile_title_container\">\n    //       <div className=\"navigator__lesson_tile_title\">\n    //         {label}\n    //       </div>\n    //     </div>\n    //   </div>;\n\n    return <div className='lesson__title_container'>\n      <div className='lesson__title_centering_container'>\n        <div className='lesson__title_img_container'>\n          <img src={imgLink} className=\"lesson__title_image\"\n            alt=\"Icon for lesson title\"/>\n        </div>\n        <div className='lesson__title_text_container'>\n          <div className='lesson__title_text'>\n            <h1>\n              {label}\n            </h1>\n          </div>\n        </div>\n      </div>\n    </div>;\n  }\n}\n","// @flow\n\nimport * as React from 'react';\nimport SimpleLesson from '../Lesson/SimpleLesson';\nimport LinksTable from './linksTable';\n\ntype Props = {\n  lesson: SimpleLesson;\n  isLoggedIn: boolean;\n};\n\nexport default class LinksLessonComponent extends React.Component\n                                    <Props> {\n  lesson: SimpleLesson;\n  key: number;\n\n  constructor(props: Props) {\n    super(props);\n    this.lesson = props.lesson;\n    this.key = 0;\n  }\n\n  componentDidMount() {\n    // Instantiate diagram now that the canvas elements have been\n    // created.\n    this.lesson.initialize();\n  }\n\n  renderSections() {\n    const sections = [];\n    this.lesson.content.sections.forEach((section, index) => {\n      if (section.links != null) {\n        sections.push(\n          <div key={index}>\n            <LinksTable links={section.links} isLoggedIn={this.props.isLoggedIn} />\n          </div>,\n        );\n      } else {\n        sections.push(\n          <div key={index}>\n            {section}\n          </div>,\n        );\n      }\n    });\n    return sections;\n  }\n\n  render() {\n    return <div id={this.lesson.content.htmlId} className=\"simple_lesson__container\">\n      {this.renderSections()}\n    </div>;\n  }\n\n  // render() {\n  //   return <div id={this.lesson.content.htmlId}>\n  //     <div key={0} className=\"simple_lesson__container\">\n  //       <LinksTable links={version.links} />\n  //     </div>,\n  //     {this.lesson.content.sections[0]}\n  //   </div>;\n  // }\n}\n","// @flow\n\nimport * as React from 'react';\nimport { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\nimport Rating from './rating';\nimport { login } from '../tools/misc';\n// import { getCookie } from '../tools/misc';\n// import '../../css/style.scss';\n// import img from '../../tile.png';\n\ntype TypeLinkIn = {\n  url: string;\n  hash: string;\n  uid?: string;\n  topic?: string,\n  type?: 'presentation' | 'generic' | 'video',\n  author?: string;\n  publisher?: string;\n  description?: string;\n};\n\ntype TypeLink = {\n  url: string;\n  hash: string;\n  type: 'presentation' | 'generic' | 'video',\n  description: string;\n  title: string;\n  numHighRatings: ?number;\n  userRating: ?number;\n  userRatingIsHigh: boolean;\n};\n\ntype Props = {\n  links: Array<TypeLinkIn>,\n  isLoggedIn: boolean;\n};\n\ntype State = {\n  ratings: Array<{\n      userRating: ?number;\n      numHighRatings: ?number;\n  }>,\n};\n\nexport default class LinksTable extends React.Component\n                                    <Props, State> {\n  lessonUID: string;\n  versionUID: string;\n  topic: string;\n  callbackCount: number;\n  numLinks: number;\n  links: Array<TypeLink>;\n  hasDescription: boolean;\n\n  constructor(props: Props) {\n    super(props);\n    const path = window.location.pathname.replace(/\\/$/, '').split('/');\n    this.links = [];\n    props.links.forEach((link) => {\n      this.links.push({\n        url: link.url,\n        hash: link.hash,\n        type: link.type || 'generic',\n        title: link.author || link.publisher || '',\n        description: link.description || '',\n        numHighRatings: null,\n        userRating: 0,\n        userRatingIsHigh: false,\n      });\n    });\n    this.hasDescription = false;\n    this.links.forEach((link) => {\n      if (link.description) {\n        this.hasDescription = true;\n      }\n    });\n    /* eslint-disable prefer-destructuring */\n    this.lessonUID = path.slice(-3, -2)[0];\n    this.versionUID = path.slice(-1)[0];\n    this.topic = path.slice(-2, -1)[0];\n    // /* eslint-enable */\n    // this.lessonDescription = getLessonDescription(this.lessonUID);\n    this.state = {\n      ratings: this.fillRatings(),\n    };\n    // // this.versionDetails = props.versionDetails;\n    // // const [topic] = window.location.pathname.split('/').slice(-2, -1);\n    // // this.topic = topic;\n    // this.key = 0;\n    // this.showNavigator = false;\n    // this.getRating(this.topic);\n    this.getLinkRatings(this.gotLinkRatings.bind(this));\n    // if (this.lessonDescription != null) {\n    //   this.lessonDescription.getRatings(this.gotRatings.bind(this));\n    // }\n  }\n\n  fillRatings() {\n    const ratings = [];\n    this.links.forEach((link) => {\n      ratings.push({\n        userRating: link.userRating,\n        numHighRatings: link.numHighRatings,\n      });\n    });\n    return ratings;\n  }\n\n  gotLinkRatings() {\n    this.setState({ ratings: this.fillRatings() });\n  }\n\n  waitThenCallback(callback: Function) {\n    this.callbackCount += 1;\n    if (this.callbackCount === this.props.links.length) {\n      callback();\n    }\n  }\n\n  getLinkRatings(callback: Function) {\n    this.callbackCount = 0;\n    this.numLinks = 0;\n    this.links.forEach((link) => {\n      const endpoint = `/linkrating/${this.lessonUID}/${this.topic}/${this.versionUID}/${link.hash}`;\n      fetchPolyfill(endpoint, { credentials: 'same-origin' })\n        .then((response) => {\n          if (!response.ok) {\n            this.waitThenCallback(callback);\n            throw Error(response.statusText);\n          }\n          return response.json();\n        })\n        .then((data: {\n          status: 'ok' | 'fail',\n          message?: string,\n          userRating?: number,\n          aveRating?: number,\n          numRatings?: number,\n          numHighRatings: number,\n        }) => {\n          let userRatingIsHigh = false;\n          if (data.userRating != null && data.userRating > 3) {\n            userRatingIsHigh = true;\n          }\n          if (data.status === 'ok') {\n            /* eslint-disable no-param-reassign */\n            link.numHighRatings = data.numHighRatings;\n            link.userRating = data.userRating || 0;\n            link.userRatingIsHigh = userRatingIsHigh;\n            /* eslint-enable */\n          }\n          this.waitThenCallback(callback);\n        })\n        .catch(() => {\n          this.waitThenCallback(callback);\n        });\n    });\n  }\n\n  setUserRating(rating: number, index: number) {\n    const { cookie } = document;\n    if (cookie != null) {\n      const username = cookie.match(/username=[^;]*;/);\n      if (username != null) {\n        if (username[0].split('=')[1].slice(0, -1) === '') {\n          return;\n        }\n      }\n    }\n    // const page = parseInt(getCookie('page'), 10) - 1 || 0;\n    this.links[index].userRating = rating;\n    const endpoint = `/ratelink/${this.lessonUID}/${this.topic}/${this.versionUID}/${this.links[index].hash}/${rating}`;\n\n    let updateState = false;\n    if (this.links[index].userRatingIsHigh && rating < 4) {\n      if (this.links[index].numHighRatings != null) {\n        this.links[index].numHighRatings -= 1;\n      }\n      this.links[index].userRatingIsHigh = false;\n      updateState = true;\n    }\n    if (this.links[index].userRatingIsHigh === false && rating > 3) {\n      if (this.links[index].numHighRatings != null) {\n        this.links[index].numHighRatings += 1;\n      } else {\n        this.links[index].numHighRatings = 1;\n      }\n      this.links[index].userRatingIsHigh = true;\n      updateState = true;\n    }\n    if (updateState) {\n      this.setState({ ratings: this.fillRatings() });\n    }\n    fetchPolyfill(endpoint, { credentials: 'same-origin' })\n      .then((response) => {\n        if (!response.ok) {\n          throw Error(response.statusText);\n        }\n        return response.json();\n      })\n      .then((data) => {\n        if (data.status === 'done') {\n          this.setState({ ratings: this.fillRatings() });\n        } else {\n          // console.log('failed to set rating:', data.message);\n        }\n      })\n      .catch(() => {});\n  }\n\n  renderLinks() {\n    const links = [];\n    let key = 0;\n    this.links.forEach((link, index) => {\n      // let rating = <div className=\"lesson__links_table__disabled\">{'-'}</div>;\n      // if (this.props.isLoggedIn) {\n      let userRatingValue = this.state.ratings[index].userRating;\n      if (typeof userRatingValue !== 'number') {\n        userRatingValue = 0;\n      }\n      const rating = <Rating\n        topic={this.topic}\n        rating={userRatingValue}\n        ratingCallback={(r, i) => { this.setUserRating(r, i); }}\n        isLoggedIn={this.props.isLoggedIn}\n        index={index}\n      />;\n      // }\n      let numHighRatings = <div className=\"lesson__links_table__disabled\">\n        {'-'}\n      </div>;\n      if (this.state.ratings[index].numHighRatings) {\n        ({ numHighRatings } = this.state.ratings[index]);\n      }\n      const title = <a\n          className=\"lesson__links_table__title_text\"\n          href={link.url}\n          rel='noreferrer noopener'\n          target=\"_blank\"\n        >\n        {link.title}\n      </a>;\n      let typeClass = 'lesson__links_table__icon lesson__links_table__icon_generic';\n      const { type } = link;\n      if (type === 'presentation') {\n        typeClass = 'lesson__links_table__icon lesson__links_table__icon_presentation';\n      } else if (type === 'singlePage') {\n        typeClass = 'lesson__links_table__icon lesson__links_table__icon_single_page';\n      } else if (type === 'video') {\n        typeClass = 'lesson__links_table__icon lesson__links_table__icon_video';\n      }\n\n      let description = null;\n      if (this.hasDescription) {\n        description = <td className=\"lesson__links_table__description\">{link.description}</td>;\n      }\n      links.push(<tr key={key} className=\"lesson__links_table__large_screen\">\n        <td className=\"lesson__links_table__type\">\n          <a\n            className={typeClass}\n            href={link.url}\n            rel='noreferrer noopener'\n            target=\"_blank\"\n            aria-label={link.title}\n          >\n          </a>\n        </td>\n        <td className=\"lesson__links_table__title\">{title}</td>\n        {description}\n        <td className=\"lesson__links_table__your_rating\">{rating}</td>\n        <td className=\"lesson__links_table__total_rating\">{numHighRatings}</td>\n      </tr>);\n      key += 1;\n\n      // if (!this.props.isLoggedIn) {\n      //   rating = <span className=\"rating__login\" onClick={login}>{'Login'}</span>\n      // }\n      links.push(<tr key={key} className=\"lesson__links_table__small_screen\">\n        <td className=\"lesson__links_table__small_screen__content\">\n          <table><tbody>\n            <tr>\n              <td>\n                <div className=\"lesson__links_table__small_screen__type_container\">\n                  <div className=\"lesson__links_table__small_screen__type\">\n                    <a\n                      className={typeClass}\n                      href={link.url}\n                      rel='noreferrer noopener'\n                      target=\"_blank\"\n                      aria-label={link.title}\n                    >\n                    </a>\n                  </div>\n                </div>\n                <div className=\"lesson__links_table__small_screen__link_container\">\n                  <div className=\"lesson__links_table__small_screen__link\">\n                    {title}\n                  </div>\n                </div>\n              </td>\n            </tr>\n            <tr>\n              {description}\n            </tr>\n            <tr>\n              <td className=\"lesson__links_table__total_rating\">\n                <div className=\"lesson__links_table__small_screen__title\">\n                    {'Total Ratings ≥4:'}\n                </div>\n                <div className=\"lesson__links_table__small_screen__value\">\n                  {numHighRatings}\n                </div>\n              </td>\n            </tr>\n            <tr>\n              <td>\n                <div className=\"lesson__links_table__small_screen__title\">\n                  {this.yourRatingTitle(true)}\n                </div>\n                {rating}\n              </td>\n            </tr>\n          </tbody></table>\n        </td>\n        </tr>);\n      key += 1;\n    });\n    return links;\n  }\n\n  yourRatingTitle(useColon: boolean = false) {\n    let colon = '';\n    if (useColon) {\n      colon = ':';\n    }\n    let title = <div>\n      <span className=\"rating__login\" onClick={login}>{'Login'}</span>\n      {` to rate${colon}`}\n    </div>;\n    if (this.props.isLoggedIn) {\n      title = 'Your\\nRating';\n    }\n    return title;\n  }\n\n  render() {\n    let description = null;\n    if (this.hasDescription) {\n      description = <td className=\"lesson__links_table__description lesson__links_table__description_title\">Description</td>;\n    }\n    // const props = Object.assign({}, this.props);\n    return <table className=\"lesson__links_table\">\n      <tbody>\n        <tr className=\"lesson__links_table__title_row lesson__links_table__large_screen\">\n        <td className=\"lesson__links_table__type_title lesson__links_table__type\"></td>\n        <td className=\"lesson__links_table__title_title lesson__links_table__title\">Link</td>\n        {description}\n        <td className=\"lesson__links_table__your_rating_title lesson__links_table__your_rating\">{this.yourRatingTitle()}</td>\n        <td className=\"lesson__links_table__total_rating_title lesson__links_table__total_rating\">Total Ratings ≥4</td>\n        </tr>\n        {this.renderLinks()}\n      </tbody>\n    </table>;\n  }\n}\n","// @flow\n\nimport * as React from 'react';\nimport { login, logout } from '../tools/misc';\nimport DropDownButton from './dropDownButton';\n// import { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n\n\ntype Props = {\n  active?: string;\n  isLoggedIn: boolean;\n  username: string;\n  includeHome: boolean;\n};\n\n// type State = {\n//   loginLink: string;\n//   loginText: string;\n// };\n\nexport default class Navbar extends React.Component\n                                    <Props> {\n  // state: State;\n\n  // constructor(props: Props) {\n  //   super(props);\n  //   this.state = {\n  //     // isLoggedIn: false,\n  //     loginText: 'Login',\n  //     loginLink: '/login',\n  //   };\n  // }\n\n  // componentDidMount() {\n  //   const handleVisibilityChange = () => {\n  //     this.checkIsLoggedIn();\n  //   };\n  //   window.addEventListener('focus', handleVisibilityChange);\n  //   this.checkIsLoggedIn();\n  //   // this.checkIsLoggedIn();\n  //   // this.checkLoggedInFromPage();\n  // }\n\n  // checkIsLoggedIn() {\n  //   // // console.log('checking1')\n  //   // fetchPolyfill('/isloggedin', { credentials: 'same-origin' })\n  //   //   .then((response) => {\n  //   //     if (!response.ok) {\n  //   //       throw Error(response.statusText);\n  //   //     }\n  //   //     // console.log(response, response.json());\n  //   //     return response.json();\n  //   //   })\n  //   //   .then(data => this.setLogin(data.username))\n  //   //   .catch(() => {});\n  //   // console.log(document.cookie)\n  //   const { cookie } = document;\n  //   if (cookie != null) {\n  //     // $FlowFixMe\n  //     let username = cookie.match(/username=[^;]*/);\n  //     // console.log(username)\n  //     if (username != null) {\n  //       username = username[0].trim();\n  //       if (username.slice(-1).charAt(0) === ';') {\n  //         username = username.slice(0, -1);\n  //       }\n\n  //       this.setLogin(username.split('=')[1]);\n  //     }\n  //   }\n  // }\n\n  // // checkLoggedInFromPage() {\n  // //   if (document.getElementById('logged_in')) {\n  // //     this.setLogin(null);\n  // //     this.checkIsLoggedIn();\n  // //   } else {\n  // //     this.setLogin('');\n  // //   }\n  // // }\n\n  // setLogin(username: string | null) {\n  //   if (username === '') {\n  //     this.setState({\n  //       loginText: 'Login',\n  //       loginLink: '/login',\n  //     });\n  //   } else if (username !== null) {\n  //     this.setState({\n  //       loginText: `Logout ${username}`,\n  //       loginLink: '/logout',\n  //     });\n  //   } else {\n  //     this.setState({\n  //       loginText: 'Logout',\n  //       loginLink: '/logout',\n  //     });\n  //   }\n  // }\n\n  loginout() {\n    if (this.props.isLoggedIn) {\n      logout();\n    } else {\n      login();\n    }\n  }\n\n  // getLoginLink() {\n  //   let page = getCookie('page');\n  //   if (page === '') {\n  //     page = '0';\n  //   }\n  //   const next = `?next=${window.location.pathname}&page=${page}`;\n  //   if (this.props.isLoggedIn) {\n  //     return `/logout${next}`;\n  //   }\n  //   return `/login${next}`;\n  // }\n\n  getLoginLabel() {\n    if (this.props.isLoggedIn) {\n      if (this.props.username !== '') {\n        return <div>\n          Logged in as <span className=\"navbar_login__loggedin_label_username\">{this.props.username}\n          </span>\n        </div>;\n      }\n      return 'Logout';\n    }\n    return 'Login';\n  }\n\n  getLoginButton() {\n    if (this.props.isLoggedIn) {\n      return <div className=\"navbar-button navbar-right navbar_login\">\n        <DropDownButton\n          label={this.getLoginLabel()}\n          id=\"id_navbar_loginout\"\n          direction='down'\n          xAlign='right'\n          list={[{\n            label: 'Logout',\n            link: this.loginout.bind(this),\n            active: false,\n          }]}\n          selected={false}\n        />\n      </div>;\n    }\n    return <div className=\"navbar-text navbar-right login_button\">\n        <div\n          onClick={this.loginout.bind(this)}\n          className=\"navbar_login\"\n          id=\"id_navbar_loginout\"\n        >\n          {this.getLoginLabel()}\n        </div>\n      </div>;\n  }\n\n  renderHomeButton() {\n    if (this.props.includeHome) {\n      return <a className=\"navbar-icon-container\"\n         href=\"/\">\n        <img className=\"navbar-icon\"\n             src=\"/static/assets/logo20.svg\"\n             alt=\"navbar home icon\"/>\n      </a>;\n    }\n    return '';\n  }\n\n  render() {\n    // const props = Object.assign({}, this.props);\n    // delete props.active;\n\n    const body =\n    <div>\n      <div className=\"navbar-container\">\n        {this.renderHomeButton()}\n        {this.getLoginButton()}\n        { /*\n        <div className=\"navbar-text navbar-right login_button\">\n          <div onClick={this.loginout.bind(this)} className=\"navbar_login\">\n            {this.getLoginLabel()}\n          </div>\n        </div>\n        <div className=\"navbar-button navbar-right navbar_login\">\n          <DropDownButton\n            label={this.getLoginLabel()}\n            id=\"id_navbar_loginout\"\n            direction='down'\n            xAlign='right'\n            list={[{\n              label: 'logout',\n              link: this.loginout.bind(this),\n              active: false,\n            }]}\n            selected={false}\n          />\n        </div>\n        */ }\n        {/*\n        <div className=\"navbar-text navbar-left\">\n          Plus\n        </div>\n        <div className=\"navbar-text navbar-left\">\n         <DropDownButton\n          className=\"navbar_lessons_dropdown\"\n          label=\"lessons\"\n          direction=\"down\"\n          xAlign=\"left\"\n          list={[\n            { label: 'item 1', link: '/' },\n            { label: 'item 2', link: '/' },\n            { label: 'item 3', link: '/' },\n          ]}/>\n        </div>\n      */}\n      </div>\n    </div>;\n    return <div>\n      {body}\n    </div>;\n  }\n}\n","import * as React from 'react';\n\nexport default class NavbarSpacer extends React.Component\n                                    <> {\n  // eslint-disable-next-line class-methods-use-this\n  render() {\n    return <div className=\"navbar__spacer\">\n    <div className=\"navigator__left_side\"/>\n    <div className=\"navigator__right_side\"/>\n    </div>;\n  }\n}\n","// @flow\n// import Fig from 'figureone';\nimport * as React from 'react';\nimport PresentationLesson from '../Lesson/PresentationLesson';\nimport Button from './button';\nimport DropDownButton from './dropDownButton';\nimport { getCookie, createCookie } from '../tools/misc';\nimport PresentationQR from './presentationQR';\nimport StaticQR from './staticQR';\n// import '../../css/presentationLesson.scss';\n\n// const { DiagramElementCollection } = Fig;\n\ntype Props = {\n  lesson: PresentationLesson;\n};\n\ntype State = {\n  htmlText: string,\n  numPages: number,\n  page: number,\n  listOfSections: Array<{\n    label: string | React.Element<'div'>;\n    link?: Function | string;\n    active?: boolean;\n  }>;\n  qr: React.Element<'div'> | React.Element<typeof StaticQR>,\n  presQR: {\n    title: string;\n    link: string;\n  },\n};\n\nexport default class PresentationLessonComponent extends React.Component\n                                    <Props, State> {\n  lesson: PresentationLesson;\n  key: number;\n  state: State;\n  componentUpdateCallback: ?() => void;\n  centerLessonFlag: boolean;\n  topic: string;\n  firstPage: number;\n  // refreshCallback: ?() => void;\n\n  constructor(props: Props) {\n    super(props);\n    this.firstPage = parseInt(getCookie('page'), 10) - 1 || 0;\n    if (this.firstPage === -1) {\n      this.firstPage = 0;\n    }\n    this.lesson = props.lesson;\n    this.state = {\n      htmlText: '',\n      numPages: 0,\n      page: 0,\n      listOfSections: [],\n      qr: <StaticQR content=\"Loading Reference\" link=\"\" title=\"\"/>,\n      presQR: {\n        title: '',\n        link: '',\n      },\n    };\n    this.key = 0;\n    this.lesson.refresh = this.refreshText.bind(this);\n    this.componentUpdateCallback = null;\n    this.centerLessonFlag = false;\n    // this.refreshCallback = null;\n  }\n\n  componentDidUpdate() {\n    if (this.componentUpdateCallback) {\n      const callback = this.componentUpdateCallback;\n      this.componentUpdateCallback = null;\n      callback();\n    } else {\n      this.lesson.setOnclicks();\n    }\n    // if (this.refreshCallback != null) {\n    //   this.refreshCallback();\n    // }\n    this.lesson.content.diagram.updateHTMLElementTie();\n  }\n\n  refreshText(htmlText: string, page: number, callback: ?() => void = null) {\n    this.updateGoToButtonListHighlight();\n    if (htmlText !== this.state.htmlText || page !== this.state.page) {\n      this.componentUpdateCallback = callback;\n      this.setState({ htmlText, page });\n      createCookie('page', `${page + 1}`, 30, window.location.pathname.replace(/\\/$/, ''));\n    } else if (callback) {\n      callback();\n    }\n    const nextButton = document.getElementById('lesson__button-next');\n    if (nextButton) {\n      if (this.lesson.currentSectionIndex ===\n        this.lesson.content.sections.length - 1) {\n        nextButton.classList.add('lesson__button-next-disabled');\n      } else {\n        nextButton.classList.remove('lesson__button-next-disabled');\n      }\n    }\n    const prevButton = document.getElementById('lesson__button-previous');\n    if (prevButton) {\n      if (this.lesson.currentSectionIndex === 0) {\n        prevButton.classList.add('lesson__button-prev-disabled');\n      } else {\n        prevButton.classList.remove('lesson__button-prev-disabled');\n      }\n    }\n  }\n\n  goToNext() {\n    this.lesson.nextSection();\n  }\n\n  goToPrevious() {\n    this.lesson.prevSection();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  resize() {\n    const style = window.getComputedStyle(document.documentElement);\n    if (style) {\n      const docElem = document.documentElement;\n      if (docElem) {\n        // docElem.style.setProperty('--pres__vw', `${window.innerWidth}px`);\n        docElem.style.setProperty('--pres__vw1', `${window.innerWidth}`);\n        // docElem.style.setProperty('--pres__vh', `${window.innerHeight}px`);\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  setCSSVariables(elementId: string) {\n    const container = document.getElementById('lesson__content_diagram');\n    if (container != null) {\n      const containerRect = container.getBoundingClientRect();\n      const width = Math.min(containerRect.width * 0.7, 600);\n      const doc = document.documentElement;\n      if (doc != null) {\n        doc.style.setProperty('--lesson__qr__content_width', `${width}px`);\n        doc.style.setProperty('--lesson__qr__content_height', `calc(${width / 1.5}px)`);\n      }\n    }\n\n    const diagramHTML = document.getElementById('id_diagram__html');\n    const element = document.getElementById(elementId);\n    if (diagramHTML != null && element != null) {\n      const diagramFontSize = parseFloat(diagramHTML.style.fontSize);\n      const bodyFontSize = parseFloat(window.getComputedStyle(document.body).fontSize);\n      element.style.fontSize = `${Math.min(diagramFontSize, bodyFontSize)}px`;\n    }\n  }\n\n  showStaticQR(id: string, parameters: string) {\n    const presQR = document.getElementById('id_lesson__qr__pres_container');\n    if (presQR != null) {\n      presQR.classList.add('lesson__hide');\n    }\n    this.setState({ qr: window.quickReference[parameters] });\n    this.setCSSVariables('id_lesson__qr__static_container');\n    const element = document.getElementById('id_lesson__qr__static_container');\n    if (element != null) {\n      element.classList.remove('lesson__hide');\n    }\n  }\n\n  showPresQR(id: string, parameters: string) {\n    const staticQR = document.getElementById('id_lesson__qr__static_container');\n    if (staticQR != null) {\n      staticQR.classList.add('lesson__hide');\n    }\n    this.setCSSVariables('id_lesson__qr__pres_container');\n    const path = parameters.split('/').slice(0, -1).join('/');\n    const qrid = parameters.split('/').slice(-1)[0];\n    this.lesson.content.showQR(path, qrid);\n    const element = document.getElementById('id_lesson__qr__pres_container');\n    if (element != null) {\n      element.classList.remove('lesson__hide');\n    }\n    this.lesson.content.qrDiagram.resize();\n    this.lesson.content.qrDiagram.animateNextFrame();\n  }\n\n  componentDidMount() {\n    this.resize();\n    window.addEventListener('resize', this.resize.bind(this));\n    // Instantiate diagram now that the canvas elements have been\n    // created.\n    window.lessonFunctions = {\n      qr: (id, parameters) => {\n        if (React.isValidElement(window.quickReference[parameters])) {\n          this.showStaticQR(id, parameters);\n        } else {\n          this.showPresQR(id, parameters);\n        }\n      },\n    };\n    this.lesson.initialize();\n    this.lesson.content.diagram.resize();\n    this.setState({\n      listOfSections: this.addListOfSections(),\n      numPages: this.lesson.content.sections.length,\n    });\n\n    if (this.firstPage != null && this.firstPage < this.lesson.content.sections.length) {\n      this.lesson.goToSection(this.firstPage);\n    } else {\n      this.lesson.goToSection(0);\n    }\n\n    const nextButton = document.getElementById('lesson__button-next');\n    if (nextButton instanceof HTMLElement) {\n      nextButton.onclick = this.goToNext.bind(this);\n    }\n    const prevButton = document.getElementById('lesson__button-previous');\n    if (prevButton instanceof HTMLElement) {\n      prevButton.onclick = this.goToPrevious.bind(this);\n    }\n\n    const infoButton = document.getElementById('id_lesson__info_button');\n    if (infoButton instanceof HTMLElement) {\n      infoButton.onclick = this.lesson.content.toggleInfo.bind(this.lesson.content);\n    }\n\n    // window.addEventListener('resize', this.centerLesson.bind(this));\n    // window.addEventListener('orientationchange', this.orientationChange.bind(this));\n\n    // uncomment this if the lesson should be centered on going to it\n    // this.orientationChange();\n    // this.centerLessonFlag = !this.centerLessonFlag;\n    // this.centerLesson();\n  }\n\n  orientationChange() {\n    const doc = document.documentElement;\n    if (doc) {\n      // if currently in portrait, then want to center.\n      if (doc.clientHeight > doc.clientWidth) {\n        this.centerLessonFlag = true;\n      }\n    }\n  }\n\n  centerLesson() {\n    // console.log(\"Asdf1\");\n    if (this.centerLessonFlag) {\n      const lesson = document.getElementById('lesson__container_name');\n      if (lesson) {\n        const y = this.centerLessonPosition(lesson);\n        // setTimeout(function center() { window.scroll(0, a); }, 500);\n        setTimeout(() => window.scroll(0, y), 500);\n      }\n    }\n    this.centerLessonFlag = false;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  centerLessonPosition(element: HTMLElement) {\n    const doc = document.documentElement;\n    if (element != null && doc != null) {\n      const r = element.getBoundingClientRect();\n      const top = r.top + window.pageYOffset;\n      const { height } = r;\n      const windowHeight = doc.clientHeight;\n      if (windowHeight >= height) {\n        return top - (windowHeight - height) / 2;\n      }\n      return top;\n    }\n    return 0;\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('orientationchange', this.centerLesson.bind(this));\n  }\n\n  renderContent(content: string) {\n    this.key += 1;\n    return <div key={this.key} className='lesson__diagram_text' id='id_lesson__diagram_text'\n      dangerouslySetInnerHTML={ {\n        __html: content.slice(0, content.length - 1),\n      } }\n      />;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addPrevButton() {\n    return <Button label=\"\" id=\"lesson__button-previous\" className=\" lesson__np_button lesson__button-prev-enabled\"\n    aria-label=\"Previous slide\"/>;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addNextButton() {\n    return <Button label=\"\" id=\"lesson__button-next\" className=\" lesson__np_button lesson__button-next-enabled\" aria-label=\"Next slide\"/>;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addInfoButton() {\n    return <div id=\"id_lesson__info_button\" className=\"lesson__info_button lesson__info_hide\">\n      <div className=\"lesson__info_button_label_container\">\n        <div className=\"lesson__info_button_label\">\n          <div className=\"lesson__info_button_label_text\">\n            i\n          </div>\n        </div>\n      </div>\n    </div>;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addInteractiveElementButton() {\n    return <div id=\"id_lesson__interactive_element_button__container\"\n      className=\"lesson__interactive_element_button__container\">\n        <div\n          id=\"id_lesson__interactive_element_button\"\n          className=\"lesson__interactive_element_button lesson__interactive_element_button__hide\"\n          onClick={this.lesson.highlightNextInteractiveItem.bind(this.lesson)}\n          />\n      </div>;\n  }\n\n  addGoToButton() {\n    if (this.state.listOfSections.length > 0) {\n      return <div\n        className=\"lesson__button-goto_container\"\n        id=\"id__lesson__button-goto_container\">\n        <DropDownButton\n          id=\"id__lesson__goto_button\"\n          label={\n            <div className=\"pres__goto_button_label\">\n              <div className=\"pres__goto_button_label_page\">{`${this.state.page + 1} `}</div>\n              <div className=\"pres__goto_button_label_num_pages\">\n                {`of ${this.state.numPages}`}\n              </div>\n            </div>\n          }\n          direction=\"up\"\n          xAlign=\"right\"\n          list={this.state.listOfSections}/>\n      </div>;\n    }\n    return '';\n  }\n\n  belongsTo(index: number) {\n    let i = index;\n    while (i > 0) {\n      const { title } = this.lesson.content.sections[i];\n      if (title) {\n        break;\n      }\n      i -= 1;\n    }\n    return i;\n  }\n\n  clickList(index: number) {\n    this.lesson.goToSection(index);\n  }\n\n  updateGoToButtonListHighlight() {\n    const button = document.getElementById('id__lesson__button-goto_container');\n    if (button != null) {\n      const activeItems = button.getElementsByClassName('dropdown_button_list_item_active');\n      [].forEach.call(activeItems, item => item.classList.remove('dropdown_button_list_item_active'));\n      const listItems = document.getElementById('id__lesson__goto_button_list');\n      const activeSection = this.belongsTo(this.lesson.currentSectionIndex);\n      const titleIndeces = this.lesson.content.sections.map((section, index) => {\n        if (section.title) {\n          return index;\n        }\n        return -1;\n      }).filter(index => index !== -1);\n      const listIndex = titleIndeces.indexOf(activeSection);\n\n      if (listItems) {\n        const { children } = listItems;\n        if (children.length > 0) {\n          children[listIndex].classList.add('dropdown_button_list_item_active');\n        }\n      }\n    }\n  }\n\n  addListOfSections() {\n    const output = [];\n    const activeSection = this.belongsTo(this.lesson.currentSectionIndex);\n    this.lesson.content.sections.forEach((section, index) => {\n      if (section.title) {\n        let isActive = false;\n        if (index === activeSection) {\n          isActive = true;\n        }\n        this.key += 1;\n        output.push({\n          label: section.title,\n          link: this.clickList.bind(this, index),\n          active: isActive,\n        });\n      }\n    });\n    return output;\n  }\n\n\n  render() {\n    return <div>\n      <main>\n      <div className=\"lesson__widescreen_backdrop\" id={this.lesson.content.htmlId}>\n        <div id=\"lesson__container_name\" className=\"lesson__container\">\n              {this.addPrevButton()}\n              <div id={this.lesson.content.diagramHtmlId} className=\"diagram__container lesson__diagram\">\n                <canvas id=\"id_diagram__gl__low\" className='diagram__gl'>\n                </canvas>\n                <canvas id=\"id_diagram__text__low\" className='diagram__text'>\n                </canvas>\n                <div id=\"id_diagram__html\" className='diagram__html'>\n                  {this.renderContent(this.state.htmlText)}\n                  <div className=\"diagram__text_measure\" id={`${this.lesson.content.diagramHtmlId}_measure`}>\n                    {'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'}\n                  </div>\n                </div>\n                <div id=\"id_lesson__qr__static_container\" className=\"lesson__qr__container lesson__hide\">\n                  {this.state.qr}\n                </div>\n                <div id=\"id_lesson__qr__pres_container\" className=\"lesson__qr__container lesson__hide\">\n                  <PresentationQR\n                    id=\"id_lesson__qr__content_pres__overlay\"\n                    onClose={this.lesson.content.prepareToHideQR.bind(this.lesson.content)}\n                  />\n                </div>\n              </div>\n              {this.addGoToButton()}\n              {this.addNextButton()}\n              {this.addInfoButton()}\n              {this.addInteractiveElementButton()}\n        </div>\n      </div>\n      </main>\n    </div>;\n  }\n}\n","// @flow\nimport * as React from 'react';\nimport QuickReferencePopup from './quickReferencePopup';\n\ntype Props = {\n  id: string;\n  onClose?: () => void;\n  // title: string;\n  // link: string;\n};\n\nexport default class PresentationQR extends React.Component\n                                    <Props> {\n  renderContent() {\n    return <div id={this.props.id} className=\"lesson__presentation_qr__container\">\n        <div id=\"id_qr_diagram\" className=\"diagram__container lesson__diagram\">\n          <canvas id=\"id_qr_diagram__text\" className='diagram__text'>\n          </canvas>\n          <canvas id=\"id_qr_diagram__gl\" className='diagram__gl'>\n          </canvas>\n          <div id=\"id_qr_diagram__html\" className='diagram__html'>\n            <div id=\"id_lesson__qr_diagram_container\">\n            </div>\n            <div id=\"id_lesson__qr_description_container\" className=\"lesson__qr_description_container\">\n              <div className=\"lesson__qr_description_table_cell\">\n                <div className=\"lesson__qr_description_relative\">\n                  <div className=\"lesson__qr_description_text\" id=\"id_lesson__qr_description\">\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"diagram__text_measure\" id={`${this.props.id}_measure`}>\n              {'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'}\n            </div>\n          </div>\n        </div>\n    </div>;\n  }\n\n  render() {\n    const title = <div id=\"id_lesson__qr__title_text__pres\"></div>;\n    const link = <a\n        className=\"lesson__qr__link_link\"\n        id=\"id_lesson__qr__link_link__pres\"\n        href={''}\n        rel='noreferrer noopener'\n        target=\"_blank\"\n      >\n        Go to lesson to see why\n    </a>;\n    return <QuickReferencePopup\n      id=\"id_lesson__qr__content_pres\"\n      content={this.renderContent()}\n      title={title}\n      link={link}\n      closeId=\"id_lesson__qr__pres_container\"\n      onClose={this.props.onClose}\n    />;\n  }\n}\n","// @flow\nimport * as React from 'react';\n// import { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n\ntype Props={\n  content: string | React.Element<'div'>;\n  title: string | React.Element<'div'>;\n  link: string | React.Element<'a'>;\n  id: string;\n  closeId: string;\n  onClose?: () => void;\n};\n\nexport default class QuickReferencePopup extends React.Component\n                                    <Props> {\n  // id: string;\n\n  renderContent() {\n    if (typeof this.props.content === 'string') {\n      return <div\n        className=\"lesson__qr__content\"\n        dangerouslySetInnerHTML={ { __html: this.props.content } }>\n      </div>;\n    }\n    return <div\n      className=\"lesson__qr__content\">\n      {this.props.content}\n    </div>;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  close() {\n    if (this.props.onClose != null) {\n      this.props.onClose();\n    }\n    const element = document.getElementById(this.props.closeId);\n    if (element != null) {\n      element.classList.add('lesson__hide');\n    }\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.close.bind(this));\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.close.bind(this));\n  }\n\n  render() {\n    let link = '';\n    if (typeof this.props.link === 'string') {\n      link = <a\n        className=\"lesson__qr__link_link\"\n        id=\"id_lesson__qr__link_link\"\n        href={`${window.location.origin}/Lessons/${this.props.link}`}\n        rel='noreferrer noopener'\n        target=\"_blank\"\n      >\n        Go to lesson to see why\n      </a>;\n    }\n\n    if (React.isValidElement(this.props.link)) {\n      ({ link } = this.props);\n    }\n\n    return <div\n      id={this.props.id}\n      className=\"lesson__qr\"\n      >\n      <div className=\"lesson__qr__title\">\n        <div\n          className=\"lesson__qr__title_text\"\n          // id=\"id_lesson__qr__title_text\"\n        >\n          {this.props.title}\n        </div>\n        <div className=\"lesson__qr__title_close__container\">\n          <div className=\"lesson__qr__title_close__cell\">\n            <div\n              className=\"lesson__qr__title_close\"\n              onClick={this.close.bind(this)}\n            >\n              X\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"lesson__qr__content_container\">\n        {this.renderContent()}\n      </div>\n      <div className=\"lesson__qr__link_container\">\n        {link}\n      </div>\n    </div>;\n  }\n}\n\n","// @flow\nimport * as React from 'react';\nimport Star from './star';\n// import { getCookie } from '../tools/misc';\n// import { login } from '../tools/misc';\n\ntype Props = {\n  topic: string,\n  rating: number,\n  // versionId: string,\n  // lessonId: string,\n  ratingCallback: Function,\n  isLoggedIn: boolean,\n  index?: number,\n  label?: string | React.Element<'div'>,\n};\n\nexport default class Rating extends React.Component\n                                    <Props> {\n  stars() {\n    const stars = [];\n    // const link = `/rate/${this.props.lessonId}/${this.props.topic}/${this.props.versionId}`;\n    for (let i = 0; i < this.props.rating; i += 1) {\n      stars.push(<Star isFull={true}\n        key={i}\n        callback={this.props.ratingCallback}\n        index={this.props.index || 0}\n        num={i + 1}\n        isLoggedIn={this.props.isLoggedIn}\n      />);\n    }\n    for (let i = this.props.rating; i < 5; i += 1) {\n      stars.push(<Star isFull={false}\n        num={i + 1}\n        key={i}\n        callback={this.props.ratingCallback}\n        index={this.props.index || 0}\n        isLoggedIn={this.props.isLoggedIn}\n      />);\n    }\n    return stars;\n  }\n\n  // getRatingLabel() {\n  //   const topic = this.props.topic.charAt(0).toUpperCase() + this.props.topic.slice(1);\n  //   // let page = getCookie('page');\n  //   // if (page === '') {\n  //   //   page = '0';\n  //   // }\n\n  //   if (this.props.isLoggedIn) {\n  //     return `Is this ${topic} helpful?`;\n  //   }\n  //   // const link = `/login?next=${window.location.pathname}&page=${page}`;\n  //   // <a href={link}>Login</a> to rate {topic}:\n  //   return <div>\n  //     <span className=\"rating__login\" onClick={login}>Login</span> to rate {topic}:\n  //   </div>;\n  // }\n\n  render() {\n    return <div className=\"rating__container\">\n      <div className=\"rating__label\">\n        {this.props.label || ''}\n      </div>\n      <div className=\"rating__stars\">\n        <div className=\"rating__stars_table\">\n            {this.stars()}\n        </div>\n      </div>\n    </div>;\n  }\n}\n","// @flow\n\nimport * as React from 'react';\nimport SimpleLesson from '../Lesson/SimpleLesson';\nimport StaticQR from './staticQR';\nimport PresentationQR from './presentationQR';\n// import '../../css/simpleLesson.scss';\n\ntype Props = {\n  lesson: SimpleLesson;\n};\n\ntype State = {\n  qr: React.Element<'div'> | React.Element<typeof StaticQR>,\n};\n\nfunction align(elementId: string, containerId: string, linkId: string) {\n  const element = document.getElementById(elementId);\n  const container = document.getElementById(containerId);\n  const link = document.getElementById(linkId);\n  if (element == null || container == null || link == null) {\n    return;\n  }\n  // element.classList.remove('lesson__hide');\n  const containerRect = container.getBoundingClientRect();\n  const linkRect = link.getBoundingClientRect();\n  const windowWidth = window.innerWidth;\n  if (windowWidth < containerRect.width) {\n    element.style.left = '20px';\n    return;\n  }\n  const linkLeft = linkRect.left - containerRect.left;\n  element.style.left = '0';\n  const newRect = element.getBoundingClientRect();\n  const proposedLeft = linkLeft + linkRect.width / 2 - newRect.width / 2;\n  const overFlow = containerRect.width - (proposedLeft + newRect.width);\n  element.style.float = '';\n  if (proposedLeft <= 20) {\n    element.style.left = '20px';\n  } else if (overFlow > 20) {\n    element.style.left = `${proposedLeft}px`;\n  } else {\n    element.style.left = '';\n    element.style.right = '20px';\n  }\n  const windowHeight = window.innerheight;\n  if (windowHeight < containerRect.height) {\n    element.style.top = '10px';\n    return;\n  }\n  const linkTop = linkRect.top - containerRect.top;\n  element.style.top = '0';\n  const proposedTop = linkTop + linkRect.height;\n  element.style.top = `${proposedTop}px`;\n}\n\nexport default class SimpleLessonComponent extends React.Component\n                                    <Props, State> {\n  lesson: SimpleLesson;\n  key: number;\n  afterUpdate: ?() => void;\n\n  constructor(props: Props) {\n    super(props);\n    this.lesson = props.lesson;\n    this.key = 0;\n    this.state = { qr: <StaticQR content=\"Loading Reference\" link=\"\" title=\"\"/> };\n    this.afterUpdate = null;\n  }\n\n  showStaticQR(id: string, parameters: string) {\n    this.setState({ qr: window.quickReference[parameters] });\n    const presQR = document.getElementById('id_lesson__qr__pres_container');\n    if (presQR != null) {\n      presQR.classList.add('lesson__hide');\n    }\n    const element = document.getElementById('id_lesson__qr__static_container');\n    if (element != null) {\n      element.classList.remove('lesson__hide');\n    }\n    align('id_lesson__qr__static_container', 'lesson__content', id);\n    this.afterUpdate = () => {\n      align('id_lesson__qr__static_container', 'lesson__content', id);\n    };\n  }\n\n  showPresQR(id: string, parameters: string) {\n    const container = document.getElementById('lesson__content');\n    if (container != null) {\n      const containerRect = container.getBoundingClientRect();\n      const width = Math.min(containerRect.width - 40, 600);\n      const doc = document.documentElement;\n      if (doc != null) {\n        doc.style.setProperty('--lesson__qr__content_width', `calc(${width}px - 1em)`);\n        doc.style.setProperty('--lesson__qr__content_height', `calc((${width}px - 1em) / 1.5)`);\n      }\n    }\n    const staticQR = document.getElementById('id_lesson__qr__static_container');\n    if (staticQR != null) {\n      staticQR.classList.add('lesson__hide');\n    }\n    const element = document.getElementById('id_lesson__qr__pres_container');\n    if (element != null) {\n      element.classList.remove('lesson__hide');\n    }\n    const path = parameters.split('/').slice(0, -1).join('/');\n    const qrid = parameters.split('/').slice(-1)[0];\n    this.lesson.content.showQR(path, qrid);\n    align('id_lesson__qr__pres_container', 'lesson__content', id);\n    this.lesson.content.qrDiagram.resize();\n    this.lesson.content.qrDiagram.animateNextFrame();\n  }\n\n  componentDidUpdate() {\n    if (this.afterUpdate != null) {\n      this.afterUpdate();\n      this.afterUpdate = null;\n    }\n  }\n\n  componentDidMount() {\n    window.lessonFunctions = {\n      qr: (id, parameters) => {\n        if (React.isValidElement(window.quickReference[parameters])) {\n          this.showStaticQR(id, parameters);\n        } else {\n          this.showPresQR(id, parameters);\n        }\n      },\n    };\n    this.lesson.initialize();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  close() {\n    let element = document.getElementById('id_lesson__qr__static_container');\n    if (element != null) {\n      element.classList.add('lesson__hide');\n    }\n    element = document.getElementById('id_lesson__qr__pres_container');\n    if (element != null) {\n      element.classList.add('lesson__hide');\n    }\n  }\n\n  render() {\n    return <div\n      id={this.lesson.content.htmlId}\n      className=\"simple_lesson__container\"\n      // onClick={this.close.bind(this)}\n    >\n      {this.lesson.content.sections}\n      <div id=\"id_lesson__qr__static_container\" className=\"lesson__qr__container lesson__hide\">\n        {this.state.qr}\n      </div>\n      <div id=\"id_lesson__qr__pres_container\" className=\"lesson__qr__container lesson__hide\">\n        <PresentationQR id=\"id_lesson__qr__content_pres__overlay\"/>\n      </div>\n    </div>;\n  }\n}\n","// @flow\nimport Fig from 'figureone';\nimport * as React from 'react';\nimport SimpleLesson from '../Lesson/SimpleLesson';\n// import '../../css/singlePageLesson.scss';\nimport StaticQR from './staticQR';\nimport PresentationQR from './presentationQR';\n\ntype Props = {\n  lesson: SimpleLesson;\n};\n\ntype State = {\n  content: Array<string | React.Element<'div'>>,\n  qr: React.Element<'div'> | React.Element<typeof StaticQR>,\n};\n\nfunction align(elementId: string, containerId: string, linkId: string) {\n  const element = document.getElementById(elementId);\n  const container = document.getElementById(containerId);\n  const link = document.getElementById(linkId);\n  if (element == null || container == null || link == null) {\n    return;\n  }\n  // element.classList.remove('lesson__hide');\n  const containerRect = container.getBoundingClientRect();\n  const linkRect = link.getBoundingClientRect();\n  const windowWidth = window.innerWidth;\n  if (windowWidth < containerRect.width) {\n    element.style.left = '20px';\n    return;\n  }\n  const linkLeft = linkRect.left - containerRect.left;\n  element.style.left = '0';\n  const newRect = element.getBoundingClientRect();\n  const proposedLeft = linkLeft + linkRect.width / 2 - newRect.width / 2;\n  const overFlow = containerRect.width - (proposedLeft + newRect.width);\n  element.style.float = '';\n  if (proposedLeft <= 20) {\n    element.style.left = '20px';\n  } else if (overFlow > 20) {\n    element.style.left = `${proposedLeft}px`;\n  } else {\n    element.style.left = '';\n    element.style.right = '20px';\n  }\n  const windowHeight = window.innerheight;\n  if (windowHeight < containerRect.height) {\n    element.style.top = '10px';\n    return;\n  }\n  const linkTop = linkRect.top - containerRect.top;\n  element.style.top = '0';\n  const proposedTop = linkTop + linkRect.height;\n  element.style.top = `${proposedTop}px`;\n}\n\n// let updates = 0;\n\n// const { DrawContext2D, Point, Rect } = Fig;\n\nconst { applyModifiers, setOnClicks } = Fig.tools.html;\n\nconst applyMDModifiers = (inputText: string, modifiers: Object) => {\n  let outputText = '';\n\n  if (inputText.trim().startsWith('##')) {\n    outputText = `<div class=\"single_page_lesson__header2\">${inputText.slice(2)}</div>`;\n  } else if (inputText.trim().startsWith('#')) {\n    outputText = `<div class=\"single_page_lesson__header1\">${inputText.slice(1)}</div>`;\n  } else {\n    outputText = `<p class=\"single_page_lesson__text\">${applyModifiers(inputText, modifiers)}</p>`;\n  }\n  return outputText;\n};\n\nexport default class SinglePageLessonComponent extends React.Component\n                                    <Props, State> {\n  lesson: SimpleLesson;\n  key: number;\n  contentChange: boolean;\n  afterUpdate: ?() => void;\n\n  constructor(props: Props) {\n    super(props);\n    this.lesson = props.lesson;\n    this.key = 10;\n    this.contentChange = false;\n    this.state = {\n      content: [],\n      qr: <StaticQR content=\"Loading Reference\" link=\"\" title=\"\"/>,\n    };\n    this.afterUpdate = null;\n  }\n\n  showStaticQR(id: string, parameters: string) {\n    this.setState({ qr: window.quickReference[parameters] });\n    const presQR = document.getElementById('id_lesson__qr__pres_container');\n    if (presQR != null) {\n      presQR.classList.add('lesson__hide');\n    }\n    const element = document.getElementById('id_lesson__qr__static_container');\n    if (element != null) {\n      element.classList.remove('lesson__hide');\n    }\n\n    align('id_lesson__qr__static_container', 'id_single_page_lesson__text_container', id);\n    this.afterUpdate = () => {\n      align('id_lesson__qr__static_container', 'lesson__content', id);\n    };\n  }\n\n  showPresQR(id: string, parameters: string) {\n    const container = document.getElementById('id_single_page_lesson__text_container');\n    if (container != null) {\n      const containerRect = container.getBoundingClientRect();\n      const width = Math.min(containerRect.width - 40, 600);\n      const doc = document.documentElement;\n      if (doc != null) {\n        doc.style.setProperty('--lesson__qr__content_width', `calc(${width}px - 1em)`);\n        doc.style.setProperty('--lesson__qr__content_height', `calc((${width}px - 1em) / 1.5)`);\n      }\n    }\n    const staticQR = document.getElementById('id_lesson__qr__static_container');\n    if (staticQR != null) {\n      staticQR.classList.add('lesson__hide');\n    }\n    const element = document.getElementById('id_lesson__qr__pres_container');\n    if (element != null) {\n      element.classList.remove('lesson__hide');\n    }\n    const path = parameters.split('/').slice(0, -1).join('/');\n    const qrid = parameters.split('/').slice(-1)[0];\n    this.lesson.content.showQR(path, qrid);\n    align('id_lesson__qr__pres_container', 'id_single_page_lesson__text_container', id);\n    this.lesson.content.qrDiagram.resize();\n    this.lesson.content.qrDiagram.animateNextFrame();\n  }\n\n  // shouldComponentUpdate() {\n  //   // if (updates > 5) {\n  //   //   return false;\n  //   // }\n  //   // updates += 1\n  //   return true;\n  // }\n  // componentWillMount() {\n  //   // Instantiate diagram now that the canvas elements have been\n  //   // created.\n  // }\n  // resizer() {\n  //   console.log('resiser')\n  //   // this.lesson.content.diagram.renderAllElementsToTiedCanvases(true);\n  //   // console.log(this.lesson.content.diagram.webglLow)\n  // }\n\n  componentDidMount() {\n    window.lessonFunctions = {\n      qr: (id, parameters) => {\n        if (React.isValidElement(window.quickReference[parameters])) {\n          this.showStaticQR(id, parameters);\n        } else {\n          this.showPresQR(id, parameters);\n        }\n      },\n    };\n    this.lesson.initialize();\n    // this.lesson.content.setDiagram(this.lesson.content.diagramHtmlId);\n    // this.lesson.content.diagram.resize();\n    this.contentChange = true;\n    this.setState({\n      content: this.lesson.content.sections[0],\n    });\n    this.lesson.content.diagram.enableScrolling();\n    // window.addEventListener('resize', this.resizer.bind(this));\n    // window.addEventListener('scroll', this.handleScroll.bind(this));\n  }\n\n  // componentWillUnmount() {\n  //   window.removeEventListener('scroll', this.handleScroll.bind(this));\n  // }\n\n  // handleScroll() {\n  //   this.lesson.content.diagram.updateHTMLElementTie();\n  //   this.lesson.content.diagram.animateNextFrame();\n  // }\n\n  // eslint-disable-next-line class-methods-use-this\n  close() {\n    let element = document.getElementById('id_lesson__qr__content_static');\n    if (element != null) {\n      element.classList.add('lesson__hide');\n    }\n    element = document.getElementById('id_lesson__qr__content_pres');\n    if (element != null) {\n      element.classList.add('lesson__hide');\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.afterUpdate != null) {\n      this.afterUpdate();\n      this.afterUpdate = null;\n    }\n    setOnClicks(this.lesson.content.modifiers);\n    const d = this.lesson.content.diagram;\n\n    if (this.contentChange) {\n      this.lesson.content.diagram.resize();\n      d.renderAllElementsToTiedCanvases();\n      const loadingElements = d.elements.getLoadingElements();\n      for (let i = 0; i < loadingElements.length; i += 1) {\n        const element = loadingElements[i];\n        if (element.drawingObject.state === 'loading') {\n          element.drawingObject.onLoad = () => {\n            element.unrender();\n            d.renderAllElementsToTiedCanvases();\n            this.lesson.content.diagram.setFirstTransform();\n          };\n        }\n      }\n      this.contentChange = false;\n      // this.lesson.content.diagram.resize();\n    }\n    // console.log(this.lesson.content.diagram.elements)\n    // console.log('1')\n    this.lesson.content.diagram.setFirstTransform();\n    this.lesson.content.diagram.updateHTMLElementTie();\n    // console.log('2')\n    d.animateNextFrame();\n    // this.lesson.content.diagram.updateHTMLElementTie();\n\n    // d.renderElementToTiedCanvas('fig1');\n    // d.renderElementToTiedCanvas('fig2');\n    // d.renderElementToTiedCanvas('fig4');\n    // d.renderElementToTiedCanvas('fig5');\n    // d.renderElementToTiedCanvas('fig6');\n    // d.renderElementToTiedCanvas('fig7');\n    // d.renderElementToTiedCanvas('fig8');\n\n    // fig1.hide()\n    // fig2.hide()\n    // fig3.hide();\n\n    // d.drawQueued = true;\n    // fig2.show()\n    // oldPos = fig2.getPosition();\n    // fig2.setPosition(0, 0);\n    // d.renderToCanvas(document.getElementById('id_figure2_asdf'));\n    // fig2.hide()\n    // fig2.setPosition(oldPos);\n\n    // d.drawQueued = true;\n    // fig1.show()\n    // oldPos = fig1.getPosition();\n    // fig1.setPosition(0, 0);\n    // d.renderToCanvas(document.getElementById('id_figure1_asdf'));\n    // fig1.hide()\n    // fig1.setPosition(oldPos);\n\n    // fig2.show()\n    // fig3.show()\n\n    // d.draw(-1);\n    // console.log(d.elements)\n    // fig3.setScale(oldScale);\n    // d._fig2.hide();\n    // d._fig3.hide();\n    // d._fig4.hide();\n    // d._fig5.hide();\n    // d._fig6.hide();\n    // d._fig7.hide();\n    // d._fig8.hide();\n    // const canvas2 = document.getElementById('id_figure2_asdf');\n    // console.log(canvas2)\n    // const draw2D2 = new DrawContext2D(canvas2)\n    // console.log(draw2D2)\n\n    // const dim2 = this.lesson.content.diagram.elements._fig2._dimensions;\n    // const d = this.lesson.content.diagram.elements._fig2._dimensions._d;\n    // const c = this.lesson.content.diagram.elements._fig2._dimensions._c;\n    // dim2.updateContext(draw2D);\n    // d.setScale(10, -80)\n    // c.setScale(10, 80)\n\n\n    // const dim4 = this.lesson.content.diagram.elements._fig4._dimensions;\n    // const d4 = this.lesson.content.diagram.elements._fig4._dimensions._d;\n    // const c4 = this.lesson.content.diagram.elements._fig4._dimensions._c;\n    // dim4.updateContext(draw2D);\n    // d4.setScale(10, -80)\n    // c4.setScale(10, 80)\n    // console.log(this.lesson.content.diagram.elements._fig3._dimensions._eqn.getCurrentForm())\n    // this.lesson.content.diagram.elements._fig3._dimensions._eqn.getCurrentForm().arrange(\n    //   1,\n    //   'left',\n    //   'baseline',\n    // );\n    // this.lesson.content.diagram.elements.resize();\n    // this.lesson.content.diagram.elements._fig3._dimensions._eqn.getCurrentForm().arrange(\n    //   1,\n    //   'left',\n    //   'baseline',\n    // );\n    // console.log(this.lesson.content.diagram.elements._fig3._dimensions._eqn)\n    // this.lesson.content.diagram.elements._fig3._dimensions._eqn.showForm('0');\n  }\n\n\n  renderContent() {\n    let output = '';\n    this.state.content.forEach((element) => {\n      // if (typeof element === 'string' && element.charAt(0) === '<') {\n      //   output += element.slice();\n      //   // output.push(<div key={this.key}\n      //   //   dangerouslySetInnerHTML={ {\n      //   //     __html: element.slice(0, element.length - 1),\n      //   //   } }>\n      //   //   </div>);\n      // } else if (typeof element === 'string') {\n      //   output += applyMDModifiers(element, this.lesson.content.modifiers);\n      //   // output.push(<div key={this.key}\n      //   //   dangerouslySetInnerHTML={ {\n      //   //     __html: applyMDModifiers(element, this.lesson.content.modifiers),\n      //   //   } }>\n      //   // </div>);\n      // }\n\n      if (typeof element === 'string') {\n        output += applyMDModifiers(element, this.lesson.content.modifiers);\n      }\n    });\n    return <div\n        id=\"id_single_page_lesson__text_container\"\n        className=\"single_page_lesson__text_container\"\n      >\n        <div\n          className=\"single_page_lesson__text_container_text\"\n          dangerouslySetInnerHTML={ { __html: output } }\n        />\n        <div id=\"id_lesson__qr__static_container\" className=\"lesson__qr__container lesson__hide\">\n                  {this.state.qr}\n        </div>\n        <div id=\"id_lesson__qr__pres_container\" className=\"lesson__qr__container lesson__hide\">\n          <PresentationQR id=\"id_lesson__qr__content_pres__overlay\"/>\n        </div>\n    </div>;\n  }\n\n  render() {\n    return <div id={this.lesson.content.htmlId} className=\"single_page_lesson__container\">\n      {this.renderContent()}\n      <canvas id=\"hidden_offscreen\"></canvas>\n      <div id={this.lesson.content.diagramHtmlId} className=\"diagram__container lesson__diagram single_page_lesson__diagram_container\">\n        <canvas id=\"id_diagram__gl__offscreen\" className=\"diagram__gl__offscreen\">\n        </canvas>\n        <canvas id=\"id_diagram__text__offscreen\" className=\"diagram__text__offscreen\">\n        </canvas>\n        <canvas id=\"id_diagram__gl__low\" className='diagram__gl'>\n        </canvas>\n        <canvas id=\"id_diagram__text__low\" className='diagram__text'>\n        </canvas>\n        <div id=\"id_diagram__html\" className='diagram__html'>\n        </div>\n      </div>\n    </div>;\n  }\n}\n","// @flow\nimport * as React from 'react';\n// import { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n\ntype Props={\n  isFull: boolean;\n  num: number;\n  callback: Function;\n  isLoggedIn: boolean;\n  index: number;\n};\n\nexport default class Star extends React.Component\n                                    <Props> {\n  // postRating() {\n  //   this.props.callback()\n  //   fetchPolyfill(this.props.link, { credentials: 'same-origin' })\n  //     .then((response) => {\n  //       if (!response.ok) {\n  //         throw Error(response.statusText);\n  //       }\n  //     })\n  //     .catch(() => {});\n  // }\n\n  setRating() {\n    this.props.callback(this.props.num, this.props.index);\n  }\n\n  star() {\n    if (this.props.isFull) {\n      return <div className=\"rating__stars_full\">\n      </div>;\n    }\n\n    return <div className=\"rating__stars_empty\">\n    </div>;\n  }\n\n  render() {\n    let link = <div></div>;\n    const keydown = (event: KeyboardEvent) => {\n      if (event.keyCode === 13 || event.keyCode === 32) {\n        this.setRating();\n      }\n    };\n    if (this.props.isLoggedIn) {\n      link = <div\n        className=\"rating__stars_link rating__stars_star_active\"\n        onClick={this.setRating.bind(this)}\n        tabIndex={0}\n        role=\"button\"\n        onKeyDown={keydown}\n        aria-label={`Rate as ${this.props.index} star`}\n      />;\n    }\n\n    return <div className=\"rating__stars_star\">\n      {this.star()}\n      {link}\n    </div>;\n  }\n}\n\n","// @flow\nimport * as React from 'react';\nimport QuickReferencePopup from './quickReferencePopup';\n// import { fetch as fetchPolyfill } from 'whatwg-fetch';    // Fetch polyfill\n\ntype Props={\n  content: string | React.Element<'div'>;\n  title: string;\n  link: string;\n};\n\nexport default class StaticQR extends React.Component\n                                    <Props> {\n  id: string;\n\n  render() {\n    return <QuickReferencePopup\n      id=\"id_lesson__qr__content_static\"\n      content={this.props.content}\n      title={this.props.title}\n      link={this.props.link}\n      closeId=\"id_lesson__qr__static_container\"\n    />;\n  }\n}\n","// @flow\n// import Fig from 'figureone';\nimport * as React from 'react';\nimport DropDownButtonBase from './dropDownButtonBase';\n\n// const { round } = Fig.tools.math;\n\nexport type TypeTopicButtonListItem = {\n  label: string | React.Element<'div'>;\n  userRating?: number;\n  rating?: number;\n  numReviews?: number;\n  numHighRatings?: number;\n  description?: string;\n  link?: Function | string;\n  active?: boolean;\n  separator?: boolean;\n  type?: 'presentation' | 'singlePage' | 'generic' | 'video';\n};\n\ntype Props = {\n  label?: string;\n  id?: string;\n  direction?: 'up' | 'down';\n  xAlign?: 'left' | 'right' | 'center';\n  list?: Array<TypeTopicButtonListItem>;\n  selected?: boolean;\n};\n\nexport default class TopicButton extends React.Component <Props> {\n  // eslint-disable-next-line class-methods-use-this\n  renderListLabel(listItem: TypeTopicButtonListItem) {\n    if (listItem.separator === true) {\n      return listItem.label;\n    }\n    let numReviews = listItem.numReviews || 0;\n    // let rating = listItem.rating || 0;\n    let numHighRatings = listItem.numHighRatings || 0;\n    let userRating = '';\n    if (numReviews > 0) {\n      // rating = '\\u2605'.repeat(Math.round(listItem.rating || 0));\n      // if (rating === '') {\n      //   rating = '-';\n      // }\n      // rating = (rating).toLocaleString('en');\n      numReviews = `${(numReviews).toLocaleString('en')}`;\n      // numHighRatings = `${round(parseInt(numHighRatings, 10)\n      // / parseInt(numReviews, 10) * 100, 0)}%`;\n    }\n    if (listItem.userRating != null && listItem.userRating > 0) {\n      for (let i = 0; i < listItem.userRating; i += 1) {\n        userRating = `${userRating}\\u2605`;\n      }\n    }\n    if (numReviews === 0) {\n      numReviews = '';\n      // rating = '';\n      numHighRatings = '';\n      // highRatingsSubText = '';\n    }\n    let label = '';\n    let description = '';\n    if (listItem.label != null) {\n      ({ label } = listItem);\n    }\n    if (listItem.description != null) {\n      ({ description } = listItem);\n    }\n    let typeClass = 'topic_button__type_icon_generic';\n    const { type } = listItem;\n    if (type === 'presentation') {\n      typeClass = 'topic_button__type_icon_presentation';\n    } else if (type === 'singlePage') {\n      typeClass = 'topic_button__type_icon_singlePage';\n    }\n\n    return <table className=\"topic_button__listItem\">\n      <tbody>\n      <tr>\n        <td className=\"topic_button__type\">\n          <div className={typeClass}>\n          </div>\n        </td>\n        <td className=\"topic_button__label\">\n          <div className=\"topic_button__label_text\">\n            {label}\n          </div>\n          <div className=\"topic_button__label_description\">\n            {description}\n          </div>\n        </td>\n        <td className=\"topic_button__rating\">\n          <div className=\"topic_button__rating_value\">\n            {userRating || '-'}\n          </div>\n        </td>\n        <td className=\"topic_button__rating\">\n          <div className=\"topic_button__rating_value\">\n            {numHighRatings || '-'}\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  renderTitle() {\n    return <table className=\"topic_button__listItem topic_button_listItem_title\">\n      <tbody>\n      <tr>\n        <td className=\"topic_button__label\" colSpan=\"2\">\n          <div className=\"topic_button__label_title\">\n            Version\n          </div>\n        </td>\n        <td className=\"topic_button__rating\">\n          <div className=\"topic_button__rating_num_reviews\">\n            Your\n          </div>\n          <div className=\"topic_button__rating_num_reviews\">\n            Rating\n          </div>\n        </td>\n        <td className=\"topic_button__rating\">\n          <div className=\"topic_button__rating_num_reviews\">\n            {'Total'}\n          </div>\n          <div className=\"topic_button__rating_num_reviews\">\n            {\n            //  '\\u2605\\u2605\\u2605\\u2605'\n            'Ratings ≥4'\n            }\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>;\n  }\n\n  render() {\n    // const props = Object.assign({}, this.props);\n    const { props } = this;\n    const listItems = [];\n    // let addTitle = true;\n    // props.list.forEach((listElement) => {\n    //   if (listElement.numReviews != null && listElement.numReviews > 0) {\n    //     addTitle = true;\n    //   }\n    // });\n    // if (addTitle) {\n    listItems.push({ label: this.renderTitle() });\n    // }\n    if (props.list != null) {\n      props.list.forEach((listElement) => {\n        listItems.push({\n          label: this.renderListLabel(listElement),\n          link: listElement.link,\n          active: listElement.active,\n          separator: listElement.separator == null ? false : listElement.separator,\n        });\n      });\n    }\n    return <DropDownButtonBase\n      label={props.label}\n      id={props.id}\n      direction={props.direction}\n      xAlign={props.xAlign}\n      list={listItems}\n      selected={props.selected}\n      classes='topic_button'\n    />;\n  }\n}\n","// @flow\n\n// This is a React Higher order component pattern where a component can be\n// wrapped by another component that will look after login state and send\n// through the state information as props to the wrapped component.\n\nimport * as React from 'react';\nimport NavbarSpacer from './navbarSpacer';\nimport Navbar from './navbar';\nimport Footer from './footer';\n\ntype Props = {\n  [propName: string]: any;\n};\n\ntype WrappedComponentProps = {\n  username: string;\n  isLoggedIn: boolean;\n  [propName: string]: any;\n};\n\ntype State = {\n  isLoggedIn: boolean;\n  username: string;\n};\n\nconst withLoginManager = function loginManager(\n  WrappedComponent: React.ComponentType<WrappedComponentProps>,\n  includeHome: boolean = true,\n) {\n  return class ViewBase extends React.Component<Props, State> {\n    constructor(props: Props) {\n      super(props);\n      this.state = {\n        isLoggedIn: false,\n        username: '',\n      };\n    }\n\n    componentWillMount() {\n      const handleVisibilityChange = () => {\n        this.checkIsLoggedInFromCookie();\n      };\n      window.addEventListener('focus', handleVisibilityChange);\n      this.checkIsLoggedInFromCookie();\n    }\n\n    // function checkIsLoggedInCookie() {\n    //   const { cookie } = document;\n    //   if (cookie != null) {\n    //     // $FlowFixMe\n    //     const username = cookie.match(/username=[^;]*;/);\n    //     if (username != null) {\n    //       this.setLogin(username[0]\n    //         .split('=')[1]\n    //         .slice(0, -1));\n    //     }\n    //   }\n    // }\n\n    checkIsLoggedInFromCookie() {\n      const { cookie } = document;\n      if (cookie != null) {\n        // $FlowFixMe\n        let username = cookie.match(/username=[^;]*/);\n        // console.log(username)\n        if (username != null) {\n          username = username[0].trim();\n          if (username.slice(-1).charAt(0) === ';') {\n            username = username.slice(0, -1);\n          }\n\n          this.setLogin(username.split('=')[1]);\n        }\n      }\n    }\n\n    setLogin(username: string | null) {\n      if (username === '') {\n        this.setState({\n          isLoggedIn: false,\n          username: '',\n        });\n      } else if (username !== null) {\n        this.setState({\n          isLoggedIn: true,\n          username,\n        });\n      } else {\n        this.setState({\n          isLoggedIn: true,\n          username: '',\n        });\n      }\n    }\n\n    render() {\n      return (\n        <div>\n          <Navbar\n              active='Single Page Lesson'\n              isLoggedIn={this.state.isLoggedIn}\n              username={this.state.username}\n              includeHome={includeHome}\n            />\n          <NavbarSpacer/>\n          <WrappedComponent\n            {...this.props}\n            username={this.state.username}\n            isLoggedIn={this.state.isLoggedIn}\n          />\n          <Footer/>\n        </div>\n      );\n    }\n  };\n};\n\nexport default withLoginManager;\n","// @flow\n\nimport * as React from 'react';\nimport LessonComponent from './lesson';\n// import { LessonContent } from '../Lesson/LessonContent';\n// import Lesson from '../Lesson/Lesson';\n\ntype Props = {\n  lesson: Object,\n  // lessonUID: string,\n  // topicName: string,\n  // versionUID: string,\n  // lessonDetails: {\n  //   uid: string,\n  //   title: string,\n  //   dependencies: Array<string>,\n  //   enabled?: boolean,\n  // },\n  // versionDetails: {\n  //   uid: string,\n  //   topic: string,\n  //   title: string,\n  //   description: string,\n  //   fullLesson: boolean,\n  //   type: 'presentation' | 'singlePage' | 'generic',\n  // },\n  isLoggedIn: boolean,\n  username: string,\n};\n\nexport default class ViewLesson extends React.Component\n                                    <Props> {\n  lesson: Object;\n\n  // constructor(props: Props) {\n  //   super(props);\n  //   this.lesson = new Lesson(this.props.lesson);\n  // }\n\n  render() {\n    // const props = Object.assign({}, this.props);\n    // delete props.active;\n    return <LessonComponent\n        lesson={this.props.lesson}\n        // lessonUID={this.props.lessonUID}\n        // topicName={this.props.topicName}\n        // versionUID={this.props.versionUID}\n        // lessonDetails={this.props.lessonDetails}\n        // versionDetails={this.props.versionDetails}\n        isLoggedIn={this.props.isLoggedIn}\n      />;\n  }\n}\n","// @flow\nimport Fig from 'figureone';\n\nconst { Point } = Fig;\nconst { joinObjects } = Fig.tools.misc;\n\nconst classify = (key: string, value: string) => {\n  const nonEmpty = value || key;\n  const withKey = nonEmpty[0] === '-' || nonEmpty.startsWith(`${key}-`)\n    ? `${key} ${nonEmpty}` : nonEmpty;\n  const joinStr = ` ${key}-`;\n  return `${withKey.split(' -').join(joinStr)}`;\n};\n\n\nfunction loadRemote(\n  scriptId: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(scriptId);\n  if (!existingScript) {\n    const script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = url;\n    script.id = scriptId; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(script);\n    }\n    script.onload = () => {\n      if (callback != null) {\n        callback(scriptId, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(scriptId, url);\n  }\n}\n\nfunction loadRemoteCSS(\n  id: string,\n  url: string,\n  callback: null | (string, string) => void = null,\n) {\n  const existingScript = document.getElementById(id);\n  if (!existingScript) {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.type = 'text/css';\n    link.href = url;\n    link.id = id; // e.g., googleMaps or stripe\n    if (document.body) {\n      document.body.appendChild(link);\n    }\n    link.onload = () => {\n      if (callback != null) {\n        callback(id, url);\n      }\n    };\n  } else if (callback != null) {\n    callback(id, url);\n  }\n}\n\nfunction getCookie(key: string) {\n  const { cookie } = document;\n  if (cookie != null) {\n    const re = RegExp(`${key}=[^;]*`);\n    // $FlowFixMe\n    let keyValue = cookie.match(re);\n    // console.log(username)\n    if (keyValue != null) {\n      keyValue = keyValue[0].trim();\n      if (keyValue.slice(-1).charAt(0) === ';') {\n        keyValue = keyValue.slice(0, -1);\n      }\n\n      return keyValue.split('=')[1];\n    }\n  }\n  return '';\n}\n\nfunction createCookie(\n  name: string,\n  value: string | number,\n  minutes: number = 0,\n  path: string = '/',\n) {\n  let expires = '';\n  if (minutes) {\n    const date = new Date();\n    date.setTime(date.getTime() + (minutes * 60 * 1000));\n    expires = `; expires=${date.toUTCString()}`;\n  }\n  document.cookie = `${name}=${value}${expires}; path=${path}`;\n}\n\nfunction logInOut(isLoggedIn: boolean) {\n  // let page = getCookie('page');\n  // if (page === '') {\n  //   page = '0';\n  // }\n  let logText = '/logout';\n  if (isLoggedIn === false) {\n    logText = '/login';\n  }\n  const next = `?next=${window.location.pathname.replace(/\\/$/, '')}`;\n  window.location = `${logText}${next}`;\n}\nfunction login() {\n  logInOut(false);\n}\n\nfunction logout() {\n  logInOut(true);\n}\n\nfunction activator(\n  width: number | Object,\n  height?: number | Object,\n  ...inputOptions: Array<Object>\n  // color: [number, number, number, number] = [0, 0, 0, 0],\n) {\n  const defaultOptions = {\n    color: [0, 0, 0, 0],\n    position: new Point(0, 0),\n    width: 1,\n    height: 1,\n    interactiveLocation: new Point(0, 0),\n  };\n  let options = joinObjects({}, defaultOptions);\n  if (typeof width === 'number') {\n    options.width = width;\n  } else {\n    options = joinObjects({}, options, width);\n  }\n  if (height) {\n    if (typeof height === 'number') {\n      options.height = height;\n    } else {\n      options = joinObjects({}, options, height);\n    }\n  }\n  if (inputOptions != null && inputOptions.length > 0) {\n    options = joinObjects({}, options, ...inputOptions);\n  }\n\n  const points: Array<Point> = [\n    new Point(-options.width / 2, -options.height / 2),\n    new Point(-options.width / 2, options.height / 2),\n    new Point(options.width / 2, options.height / 2),\n    new Point(options.width / 2, -options.height / 2),\n  ].map(p => p.add(options.position));\n\n  return {\n    name: 'activator',\n    method: 'polyLine',\n    options: {\n      points,\n      color: options.color,\n      close: true,\n    },\n    mods: {\n      isTouchable: true,\n      touchInBoundingRect: true,\n      interactiveLocation: options.interactiveLocation,\n    },\n  };\n}\n\nfunction attachQuickReference(\n  lessonPath: string,\n  lessonUID: string,\n  versionUID: string,\n  qrs: {\n    [name: string]: Object,\n  },\n) {\n  // if (window.quickReference == null) {\n  //   window.quickReference = {};\n  // }\n  // if (window.quickReference[lessonUID] == null) {\n  //   window.quickReference[lessonUID] = {};\n  // }\n  // window.quickReference[lessonUID][versionUID] = qrs;\n  if (window.quickReference == null) {\n    window.quickReference = {};\n  }\n  Object.keys(qrs).forEach((name) => {\n    window.quickReference[`${lessonPath}/${lessonUID}/${versionUID}/${name}`] = qrs[name];\n  });\n}\n\n// function attachStaticQuickReference(\n//   lessonPath: string,\n//   lessonUID: string,\n//   versionUID: string,\n//   qrs: {\n//     [name: string]: Object,\n//   },\n// ) {\n//   if (window.quickReference == null) {\n//     window.quickReference = {};\n//   }\n//   Object.keys(qrs).forEach((name) => {\n//     window.quickReference[`${lessonPath}/${lessonUID}/${versionUID}/${name}`] = qrs[name];\n//   });\n// }\n\nexport {\n  classify, loadRemote, loadRemoteCSS, getCookie, login, logout, logInOut,\n  createCookie, activator, attachQuickReference,\n};\n\n"],"sourceRoot":""}